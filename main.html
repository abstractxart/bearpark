<!doctype html>
<html lang="en" id="top" class="no-js">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>BEAR Park ‚Äî BEARcade</title>
  <meta name="description" content="Welcome to BEAR Park ‚Äî play BEARcade games, explore the lore of Bearableguy123, view BEAR NFTs, watch the live stream, and join the $BEAR community." />
  <meta name="theme-color" content="#edb723" />
  <meta name="color-scheme" content="dark light" />
  <link rel="canonical" href="https://bearpark.xyz/" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="BEAR Park ‚Äî BEARcade" />
  <meta property="og:description" content="Defend the castle. Play BEARcade. Join the $BEAR fam." />
  <meta property="og:image" content="https://files.catbox.moe/qnd2tx.png" />
  <meta property="og:url" content="https://bearpark.xyz/" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="BEAR Park ‚Äî BEARcade" />
  <meta name="twitter:description" content="Defend the castle. Play BEARcade. Join the $BEAR fam." />
  <meta name="twitter:image" content="https://files.catbox.moe/qnd2tx.png" />

  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/favicon-16x16.png" sizes="16x16" type="image/png">
  <link rel="icon" href="/favicon-32x32.png" sizes="32x32" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="icon" href="/android-chrome-192x192.png" sizes="192x192" type="image/png">
  <link rel="icon" href="/android-chrome-512x512.png" sizes="512x512" type="image/png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- Performance: preconnects + hero preload -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preload" as="image" href="https://files.catbox.moe/qnd2tx.png" fetchpriority="high" />
  <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet" />

  <!-- XRPL Library -->
  <script src="https://unpkg.com/xrpl@3.0.0/build/xrpl-latest-min.js"></script>

  <style>
  /* ==== THEME =========================================================== */
  :root{
    --gold:#edb723;
    --gold-ink:#231b04;
    --charcoal:#141619;
    --card:#1e2226;
    --ink:#0b0d0e;
    --accent:#d75c46;
    --honey:#ffefb3;
    --elev: 0 0.8px 1.6px rgba(0,0,0,.18), 0 5px 18px rgba(0,0,0,.28);
    --elev-strong: 0 10px 28px rgba(0,0,0,.45), 0 1px 0 rgba(255,255,255,.03) inset;
    --ease-spring:cubic-bezier(.18,.9,.2,1);
    --ring: 0 0 0 4px #000, 0 0 0 6px rgba(237,183,35,.66);
    accent-color: var(--gold);
    --stripe-purple: #680cd9;
    --stripe-yellow: #feb501;
    --stripe-green: #07ae08;
    --tri-gradient: linear-gradient(to right, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
  }

  /* ==== BASE ============================================================ */
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--charcoal);color:#fff}
  body{padding-bottom:calc(160px + env(safe-area-inset-bottom))}

  /* Tri-color border utility for rounded elements */
  .tri-border-rounded {
    position: relative;
    border: none;
  }
  .tri-border-rounded::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 6px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: -1;
  }
  html{scroll-behavior:smooth}
  img{max-width:100%;height:auto;display:block}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1100px;margin:0 auto;padding:52px 20px}
  .center{display:flex;justify-content:center;align-items:center}

  /* Global font */
  body, p, .tile .lbl, button, a, small {
    font-family:"Luckiest Guy","Arial Black",Impact,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    text-rendering:optimizeLegibility;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* Decorative grain + aurora */
  body::before{
    content:"";
    position:fixed; inset:-20vmax; pointer-events:none; z-index:-2;
    background:
      radial-gradient(100vmax 60vmax at 10% -10%, rgba(237,183,35,.055), transparent 60%),
      radial-gradient(80vmax 60vmax at 100% 10%, rgba(215,92,70,.055), transparent 60%),
      radial-gradient(80vmax 60vmax at 50% 110%, rgba(118,174,255,.045), transparent 60%);
    filter:blur(24px) saturate(1.05);
  }
  body::after{
    content:"";
    position:fixed; inset:0; pointer-events:none; z-index:-1;
    background-image:
      radial-gradient(rgba(255,255,255,.05), transparent 40%),
      repeating-linear-gradient(0deg, rgba(255,255,255,.02) 0 2px, transparent 2px 4px);
    mix-blend-mode:overlay; opacity:.18;
  }

  /* Skip link */
  .skip-link{position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden}
  .skip-link:focus{left:12px;top:12px;width:auto;height:auto;z-index:1000;background:#000;color:#fff;border:3px solid var(--gold);border-radius:10px;padding:10px 14px}

  /* Sticky nav + scroll progress */
  .site-nav{position:sticky;top:0;z-index:50;background:linear-gradient(180deg, #0f1114, rgba(15,17,20,.8));backdrop-filter:saturate(1.05) blur(6px);border-bottom:4px solid transparent; border-image: var(--tri-gradient) 1}
  .site-nav .bar{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:14px;padding:10px 20px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:900}
  .brand img{width:36px;height:36px}
  .links{display:flex;gap:10px;flex-wrap:wrap}
  .links a{font-weight:900;padding:8px 12px;border-radius:12px}
  .links a[aria-current="true"], .links a:hover{background:#1c1f23}
  .nav-cta{margin-left:auto}
  .progress{position:absolute;inset-inline:0;top:0;height:4px;background:linear-gradient(90deg,var(--gold),#ffe280);transform-origin:left center;transform:scaleX(0)}

  /* Headings */
  .h1,.h2,.h3{font-weight:900; letter-spacing:.5px; text-align:center; line-height:1.05; margin:0 0 14px; color:#fff; text-shadow:0 4px 0 rgba(0,0,0,.35), 0 1px 0 rgba(0,0,0,.25)}
  .h1{font-size:clamp(44px,7vw,96px)}
  .h2{font-size:clamp(38px,5.5vw,72px)}
  .h3{font-size:clamp(28px,3.5vw,44px)}
  p{margin:0 0 14px;font-weight:600;font-size:18px;line-height:1.35}
  .on-dark{color:var(--gold)!important}

  /* Sections */
  section{
    position:relative;
    border-top: 6px solid;
    border-bottom: 6px solid;
    border-image: linear-gradient(to right, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%) 1;
  }
  section.alt{background:var(--gold);color:var(--gold-ink)}
  section.dark{background:linear-gradient(180deg,#141619 0%, #101215 100%);color:#fff}
  .spacer{height:12px}

  /* Buttons */
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:.6rem;font:900 clamp(18px,2.5vw,24px)/1 "Luckiest Guy","Arial Black",Impact,system-ui,sans-serif;border-radius:26px;padding:1.1rem 1.6rem;color:#fff;background:var(--accent);border:none; box-shadow:0 10px 0 #7b2a20, 0 18px 24px rgba(0,0,0,.35);transition:transform .12s var(--ease-spring), box-shadow .12s var(--ease-spring), filter .2s ease;white-space:nowrap; position:relative; will-change:transform}
  .btn::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 26px;
    padding: 6px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: -1;
  }
  .btn{transition:all 0.2s ease;}
  .btn:hover{filter:brightness(1.12); transform:translateY(-2px);}
  .btn:active{transform:translateY(4px); box-shadow:0 6px 0 #7b2a20, 0 10px 16px rgba(0,0,0,.35)}
  .btn.ghost{background:#1c1f23;color:#fff;box-shadow:0 10px 0 #000,0 18px 24px rgba(0,0,0,.35)}
  .btn.gold{background:var(--gold);color:#000;box-shadow:0 10px 0 #9b7a0d,0 18px 24px rgba(0,0,0,.35)}
  .btn.gold:hover{box-shadow:0 12px 0 #9b7a0d,0 22px 28px rgba(0,0,0,.4); filter:brightness(1.15);}
  .btn:focus-visible{outline:none; box-shadow:var(--ring)}

  /* Input Styles */
  input[type="text"]:focus{
    border-color:var(--gold) !important;
    box-shadow:0 0 0 3px rgba(237,183,35,0.2);
    outline:none;
  }

  /* Cards */
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)) padding-box,
               linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,0)) border-box;
    border:4px solid rgba(255,255,255,.08);
    border-radius:20px;
    padding:22px;
    box-shadow:var(--elev-strong);
    overflow:hidden;
    -webkit-overflow-scrolling:auto;
    background-clip:padding-box;
    backdrop-filter:saturate(1.1) blur(2px);
    transform-style:preserve-3d;
    will-change:transform;
    transition:transform .4s var(--ease-spring), box-shadow .4s var(--ease-spring)
  }
  .card:hover{ transform:translateY(-4px); box-shadow:0 18px 40px rgba(0,0,0,.5) }
  .card:focus-within{ box-shadow:var(--ring), var(--elev-strong) }

  /* Hero */
  .hero{--hero-bg:url("https://files.catbox.moe/qnd2tx.png"); background:radial-gradient(1200px 500px at 50% -10%, rgba(255,255,255,.065), transparent 60%) , var(--hero-bg) center/cover no-repeat; min-height:56vh; display:flex; align-items:center; position:relative; border-bottom:6px solid transparent; border-image: var(--tri-gradient) 1; overflow:hidden}
  .hero .plate{background:var(--gold); color:var(--ink); border:6px solid transparent; border-image: var(--tri-gradient) 1; border-radius:22px; box-shadow:0 22px 48px rgba(0,0,0,.45), 0 2px 0 rgba(255,255,255,.25) inset; padding:20px 28px; display:inline-block; margin:0 auto; position:relative; transform:perspective(800px) rotateX(0) rotateY(0) translateZ(0); transition:transform .6s var(--ease-spring), box-shadow .4s var(--ease-spring); will-change:transform}
  .hero .logo{position:absolute; left:-72px; top:-40px; width:120px; transform:rotate(-4deg); filter:drop-shadow(0 8px 0 rgba(0,0,0,.4))}
  .hero .subtitle{font:800 clamp(16px,2.4vw,22px)/1.2 "Luckiest Guy"; margin-top:-6px; color:var(--ink)}

  /* Side honey rails */
  .rails::before,.rails::after{content:"";position:fixed;top:0;bottom:0;width:18px;z-index:1;pointer-events:none;opacity:.65}
  .rails::before{left:6px;background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0)), repeating-linear-gradient(180deg, rgba(0,0,0,.8) 0 3px, rgba(0,0,0,0) 3px 6px), linear-gradient(180deg, var(--gold) 0%, #946e00 100%);border:3px solid transparent;border-image: var(--tri-gradient) 1;border-radius:999px}
  .rails::after{right:6px;background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0)), repeating-linear-gradient(180deg, rgba(0,0,0,.8) 0 3px, rgba(0,0,0,0) 3px 6px), linear-gradient(180deg, var(--gold) 0%, #946e00 100%);border:3px solid transparent;border-image: var(--tri-gradient) 1;border-radius:999px}

  /* Arcade image */
  .arcade{position:relative;width:100%;max-width:1100px;margin:0 auto}
  .arcade img{width:100%;height:auto;display:block;border:4px solid transparent;border-image: var(--tri-gradient) 1;border-radius:20px;box-shadow:0 18px 40px rgba(0,0,0,.45)}
  .arcade a.hotspot{position:absolute;display:block;border-radius:16px;text-indent:-9999px;overflow:hidden;outline:none;background:transparent;transition: box-shadow .25s var(--ease-spring), transform .25s var(--ease-spring)}
  .arcade a.hotspot:focus-visible{outline:6px solid rgba(237,183,35,.7)}
  .arcade a.hotspot:hover, .arcade a.hotspot:focus-visible{ box-shadow: 0 0 0 6px rgba(237,183,35,.35), 0 0 0 10px rgba(0,0,0,.6); }
  .arcade a.hotspot::after{
    content:"";
    position:absolute; left:50%; top:0; width:20px; height:0; transform:translate(-50%,0);
    background: linear-gradient(180deg, #fff6c7 0%, #ffe280 40%, #edb723 70%, #9b7a0d 100%);
  border:3px solid transparent; border-top:none; border-radius:0 0 16px 16px; border-image: var(--tri-gradient) 1; box-shadow:0 6px 0 #946e00, 0 12px 20px rgba(0,0,0,.4);
    transition:height .35s var(--ease-spring), opacity .25s ease; opacity:0;
  }
  .arcade a.hotspot:hover::after, .arcade a.hotspot:focus-visible::after{ height:36px; opacity:1 }

  /* Grid & tiles */
  .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:22px}
  @media (max-width:820px){.grid-2{grid-template-columns:1fr}}
  .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:22px}
  @media (max-width:1024px){.grid-3{grid-template-columns:1fr}}
  .tile{text-decoration:none;display:flex;flex-direction:column;align-items:center;gap:14px}
  .tile .face{width:100%;min-height:140px;padding:22px;background:var(--card);border:4px solid transparent;border-image: var(--tri-gradient) 1;border-radius:18px;box-shadow:0 12px 0 #000,0 18px 28px rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;transition:transform .35s var(--ease-spring), box-shadow .35s var(--ease-spring);transform-style:preserve-3d; will-change:transform}
  .tile:hover .face{ transform:translateY(-4px); box-shadow:0 16px 0 #000,0 26px 40px rgba(0,0,0,.45) }
  .tile img{max-width:220px;max-height:64px;object-fit:contain;filter:drop-shadow(0 2px 0 rgba(0,0,0,.4))}
  .tile .lbl{font-weight:800;font-size:18px;line-height:1.2;color:var(--ink);opacity:.9}
  .dark .tile .lbl{color:var(--gold)}

  /* NFTs */
  #nfts .card{padding:26px}
  #nfts .card{background:linear-gradient(180deg,#141619 0%, #101215 100%) !important; border:4px solid transparent !important; border-image: var(--tri-gradient) 1 !important}
  .nft-media{display:block;border:6px solid transparent;border-image: var(--tri-gradient) 1;border-radius:16px;overflow:hidden}
  .nft-media img,.nft-media video{display:block;width:100%;height:auto}
  #nfts .card h3,#nfts .card p{color:var(--gold)!important}

  /* Leaderboards */
  .leaderboard-card{
    position:relative;
    background:radial-gradient(500px 200px at 50% -20%, rgba(118,174,255,.12), transparent 60%), var(--ink);
    border-radius:28px;
    padding:32px 24px;
    isolation:isolate;
  }
  .leaderboard-card::before{
    content:'';
    position:absolute;
    inset:0;
    border-radius:28px;
    padding:4px;
    background:var(--tri-gradient);
    -webkit-mask:linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite:xor;
    mask:linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite:exclude;
    pointer-events:none;
    z-index:0;
    opacity:1;
  }
  .leaderboard-list{display:flex;flex-direction:column;gap:12px}
  .leaderboard-entry{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:16px;
    border-radius:12px;
    background:linear-gradient(135deg, rgba(104, 12, 217, 0.15) 0%, rgba(7, 174, 8, 0.15) 100%);
    border-left:4px solid var(--gold);
    transition:all 0.2s ease;
  }
  .leaderboard-entry:hover{transform:translateX(8px);background:linear-gradient(135deg, rgba(104, 12, 217, 0.25) 0%, rgba(7, 174, 8, 0.25) 100%)}
  .leaderboard-entry.rank-1{background:linear-gradient(135deg, rgba(237, 183, 35, 0.3) 0%, rgba(255, 215, 0, 0.2) 100%);border-left-color:#FFD700;border-left-width:6px}
  .leaderboard-entry.rank-2{background:linear-gradient(135deg, rgba(192, 192, 192, 0.2) 0%, rgba(169, 169, 169, 0.15) 100%);border-left-color:#C0C0C0;border-left-width:5px}
  .leaderboard-entry.rank-3{background:linear-gradient(135deg, rgba(205, 127, 50, 0.2) 0%, rgba(184, 115, 51, 0.15) 100%);border-left-color:#CD7F32;border-left-width:5px}
  .leaderboard-rank{font-size:24px;color:var(--gold);text-shadow:2px 2px 0px #000;min-width:50px;font-family:'Luckiest Guy',cursive}
  .leaderboard-name{font-size:18px;color:#fff;text-shadow:2px 2px 0px #000;flex:1;margin:0 16px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
  .leaderboard-score{font-size:22px;color:var(--stripe-yellow);text-shadow:2px 2px 0px #000;font-weight:800}
  .leaderboard-wallet{font-size:11px;color:#888;font-family:monospace;margin-top:4px}
  .loading{text-align:center;padding:32px;color:#888;font-size:16px}

  /* Community banner */
  .community-banner{position:relative;overflow:hidden;border-radius:22px;border:6px solid transparent;border-image: var(--tri-gradient) 1;background:#000;box-shadow:0 20px 40px rgba(0,0,0,.45)}
  .community-banner img.bg{width:100%;opacity:.45;filter:saturate(1.05) contrast(1.02)}
  .community-banner .overlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;padding:24px}
  .pair{display:flex;gap:16px;flex-wrap:wrap;justify-content:center}

  /* Kick stream (true 16:9) */
  .square{position:relative;width:100%;max-width:900px;margin:0 auto;aspect-ratio:16/9;border-radius:16px;overflow:hidden}
  .square iframe,.square .placeholder{position:absolute;inset:0;width:100%;height:100%;border:0;border-radius:16px}
  .square .placeholder{display:grid;place-items:center;background:#0b0d0e;border:0}

  /* Carousel */
  .carousel{position:relative;overflow:visible;border:6px solid transparent;border-image: var(--tri-gradient) 1;border-radius:16px}
  .carousel .viewport{position:relative;width:100%;aspect-ratio:16/9;overflow:hidden;touch-action:none;cursor:grab;background:#0b0d0e}
  .carousel .viewport.grabbing{cursor:grabbing}
  .slides{display:flex;will-change:transform;transition:transform .7s var(--ease-spring)}
  .slides img{width:100%;height:100%;flex:0 0 100%;object-fit:contain; user-select:none;-webkit-user-drag:none;pointer-events:none;background:#0b0d0e; transform-origin:center center}
  .dots{display:flex;gap:8px;justify-content:center;margin-top:12px}
  .dot{width:10px;height:10px;border-radius:50%;background:#333;border:2px solid transparent;border-image: var(--tri-gradient) 1;opacity:.5;transition:transform .25s var(--ease-spring)}
  .dot.active{background:var(--gold);opacity:1; transform:scale(1.2)}
  footer{border-top:6px solid transparent; border-image: var(--tri-gradient) 1}

  /* Scroll reveal */
  .reveal{opacity:0; transform:translateY(18px) scale(.98); filter:blur(.5px)}
  .reveal.in{opacity:1; transform:translateY(0) scale(1); filter:blur(0); transition:opacity .6s var(--ease-spring), transform .6s var(--ease-spring), filter .6s var(--ease-spring)}

  /* Reduced motion */
  @media (prefers-reduced-motion:reduce){
    html{scroll-behavior:auto}
    .reveal{opacity:1; transform:none; filter:none}
    .slides{transition:none}
    .btn, .card, .tile .face{transition:none}
  }

  /* Buy drawer + FAB base styles used by JS */
  .fab-buy{
    position:fixed; right:20px; bottom:calc(20px + env(safe-area-inset-bottom)); z-index:60;
    display:inline-flex; align-items:center; justify-content:center; gap:.6rem;
    font:900 20px/1 "Luckiest Guy","Arial Black",Impact,system-ui,sans-serif;
    padding:16px 24px; border-radius:999px; color:#000; background:var(--gold);
    border:none; box-shadow:0 10px 0 #9b7a0d, 0 18px 24px rgba(0,0,0,.35), 0 0 0 4px var(--stripe-purple), 0 0 0 4px var(--stripe-yellow), 0 0 0 4px var(--stripe-green);
    background-image: linear-gradient(var(--gold), var(--gold)), var(--tri-gradient);
    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
    border: 4px solid transparent;
    transition:transform .12s var(--ease-spring), filter .15s ease;
  }
  .fab-buy:hover{filter:brightness(1.05)}
  .fab-buy:active{transform:translateY(2px)}

  .fab-logout{
    position:fixed; left:20px; bottom:calc(20px + env(safe-area-inset-bottom)); z-index:60;
    display:inline-flex; align-items:center; justify-content:center; gap:.6rem;
    font:900 18px/1 "Luckiest Guy","Arial Black",Impact,system-ui,sans-serif;
    padding:14px 20px; border-radius:999px; color:#fff; background:var(--accent);
    border:none; box-shadow:0 8px 0 #7b2a20, 0 14px 20px rgba(0,0,0,.35), 0 0 0 4px var(--stripe-purple), 0 0 0 4px var(--stripe-yellow), 0 0 0 4px var(--stripe-green);
    background-image: linear-gradient(var(--accent), var(--accent)), var(--tri-gradient);
    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
    border: 4px solid transparent;
    transition:transform .12s var(--ease-spring), filter .15s ease;
  }
  .fab-logout:hover{filter:brightness(1.05)}
  .fab-logout:active{transform:translateY(2px)}

  .drawer{
    position:fixed; top:0; right:0; bottom:0;
    width:min(420px, calc(100% - 72px));
    background:linear-gradient(180deg,#141619 0%, #0e1013 100%);
    border-left:6px solid;
    border-image: linear-gradient(to bottom, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%) 1;
    z-index:70;
    transform:translateX(102%); transition:transform .38s var(--ease-spring);
    box-shadow:-24px 0 40px rgba(0,0,0,.55);
    display:flex; flex-direction:column;
  }
  .drawer.open{ transform:translateX(0) }
  .drawer-scrim{ position:fixed; inset:0; background:rgba(0,0,0,.55); backdrop-filter:blur(2px); z-index:65 }
  .drawer-head{ flex-shrink:0; display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 18px; padding-top:calc(88px + env(safe-area-inset-top)); border-bottom:4px solid; border-image: linear-gradient(to right, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%) 1; background:linear-gradient(180deg, rgba(237,183,35,0.12) 0%, #1a1d22 100%); z-index:71 }
  .drawer-body{ flex:1; padding:20px; padding-bottom:calc(220px + env(safe-area-inset-bottom)); overflow:auto; display:flex; flex-direction:column; gap:20px }

  .drawer-close-btn{
    position:relative;
    width:48px;
    height:48px;
    border-radius:50%;
    background:linear-gradient(135deg, var(--gold) 0%, #d4a617 100%);
    color:#000;
    border:3px solid rgba(255,255,255,.5);
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 4px 16px rgba(237,183,35,.5), 0 0 0 2px rgba(0,0,0,.3), inset 0 1px 0 rgba(255,255,255,.3);
    transition:all .25s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight:900;
    font-size:26px;
    flex-shrink:0;
  }
  .drawer-close-btn:hover{
    background:linear-gradient(135deg, #ffd700 0%, var(--gold) 100%);
    border-color:rgba(255,255,255,.7);
    transform:scale(1.1) rotate(90deg);
    box-shadow:0 6px 20px rgba(237,183,35,.7), 0 0 0 3px rgba(237,183,35,.2), inset 0 1px 0 rgba(255,255,255,.4);
  }
  .drawer-close-btn:active{
    transform:scale(0.9) rotate(90deg);
    box-shadow:0 2px 10px rgba(237,183,35,.6), 0 0 0 2px rgba(237,183,35,.15);
  }

  .btn.sm{ font-size:26px; padding:1.2rem 1.8rem; border-radius:28px; box-shadow:0 10px 0 #000,0 16px 24px rgba(0,0,0,.35) }

  .price-card{
    position: relative;
    display:grid; gap:12px; padding:28px;
    border-radius:28px;
    background:radial-gradient(500px 200px at 50% -20%, rgba(237,183,35,.1), transparent 60%), #0b0d0e;
    box-shadow:0 12px 22px rgba(0,0,0,.35)
  }
  .price-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 16px;
    padding: 6px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: -1;
  }
  .price-card .metric{ font-size:52px; font-weight:900; display:flex; align-items:baseline; gap:10px }
  .price-card .metric small{ opacity:.8; font-size:24px }
  .price-card .sub{ opacity:.9; font-size:20px }

  /* Portfolio Card */
  .portfolio-card{
    position: relative;
    padding:32px;
    border-radius:28px;
    background:radial-gradient(500px 200px at 50% -20%, rgba(118,174,255,.12), transparent 60%), #0b0d0e;
    box-shadow:0 12px 22px rgba(0,0,0,.35);
    transition:transform 0.2s ease, box-shadow 0.2s ease;
    isolation: isolate;
  }
  .portfolio-card:hover{
    transform:translateY(-2px);
    box-shadow:0 16px 32px rgba(0,0,0,.45);
  }
  .portfolio-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 28px;
    padding: 4px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: 0;
    opacity: 1;
  }

  /* Profile Card */
  .profile-card{
    position: relative;
    padding:32px;
    border-radius:28px;
    background:radial-gradient(500px 200px at 50% -20%, rgba(237,183,35,.08), transparent 60%), #0b0d0e;
    box-shadow:0 12px 22px rgba(0,0,0,.35);
    transition:transform 0.2s ease, box-shadow 0.2s ease;
    isolation: isolate;
  }
  .profile-card:hover{
    transform:translateY(-2px);
    box-shadow:0 16px 32px rgba(0,0,0,.45);
  }
  .profile-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 28px;
    padding: 4px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: 0;
    opacity: 1;
  }

  .portfolio-stats{ display:grid; gap:12px }
  .stat-row{
    display:flex; justify-content:space-between; align-items:center;
    padding:14px 16px; background:rgba(255,255,255,.03); border-radius:12px;
    border:2px solid rgba(255,255,255,.08)
  }
  .stat-label{ font-size:22px; opacity:.85 }
  .stat-value{ font-size:32px; font-weight:900; color:var(--gold) }

  /* Points Card */
  .points-card{
    padding:28px;
  border:4px solid transparent; border-image: var(--tri-gradient) 1; border-radius:28px;
    background:radial-gradient(500px 200px at 50% -20%, rgba(237,183,35,.08), transparent 60%), #0b0d0e;
    box-shadow:0 12px 22px rgba(0,0,0,.35)
  }
  .points-card .activity-item{
    padding:16px 18px; background:rgba(255,255,255,.03); border-radius:14px;
    border-left:4px solid var(--gold); margin-bottom:10px; font-size:20px;
    display:flex; justify-content:space-between; align-items:center
  }
  .points-card .activity-item .points{ color:var(--gold); font-weight:900; font-size:24px }

  .links-grid{ display:grid; grid-template-columns:1fr 1fr; gap:14px }
  .links-grid .tile .lbl{ color:var(--gold) }
  @media (max-width:520px){ .links-grid{ grid-template-columns:1fr } }

  /* === User-requested removals === */
  .site-nav{display:none !important}
  .rails::before,.rails::after{display:none !important}

  /* ===== NEW FIXED NAVIGATION BAR ===== */
  .top-nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 9999;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  }

  /* Three-color stripe background */
  .top-nav-stripes {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    z-index: -1;
  }
  .top-nav-stripes .stripe-1 {
    flex: 1;
    background: #680cd9;
  }
  .top-nav-stripes .stripe-2 {
    flex: 1;
    background: #feb501;
  }
  .top-nav-stripes .stripe-3 {
    flex: 1;
    background: #07ae08;
  }

  /* Main nav bar */
  .top-nav-bar {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 24px;
    max-width: 1400px;
    margin: 0 auto;
  }

  /* Menu button with logo */
  .menu-btn {
    display: flex;
    align-items: center;
    position: relative;
    background: none;
    cursor: pointer;
    padding: 0;
    border-radius: 12px;
    transition: all 0.2s;
    border: 4px solid transparent;
    background-image: linear-gradient(#141619, #141619), var(--tri-gradient);
    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
    filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
  }

  .menu-btn:hover {
    transform: scale(1.05);
    filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.9));
  }

  .menu-btn img {
    width: 52px;
    height: 52px;
    display: block;
    border-radius: 8px;
  }

  /* Hamburger icon overlay */
  .menu-btn::after {
    content: '';
    position: absolute;
    bottom: -4px;
    right: -4px;
    width: 24px;
    height: 24px;
    background: #edb723;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    background-image:
      linear-gradient(#000 0%, #000 100%),
      linear-gradient(#000 0%, #000 100%),
      linear-gradient(#000 0%, #000 100%);
    background-size: 14px 2px;
    background-position: center calc(50% - 5px), center 50%, center calc(50% + 5px);
    background-repeat: no-repeat;
  }

  /* Welcome button - points + username display */
  .welcome-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: var(--gold);
    color: var(--gold-ink);
    border: 3px solid transparent; border-image: var(--tri-gradient) 1;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 900;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 0 #000, 0 4px 12px rgba(0,0,0,0.8);
    filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
  }

  .welcome-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 #000, 0 6px 18px rgba(0,0,0,0.9);
    filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.9));
  }

  .welcome-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 0 #000, 0 2px 8px rgba(0,0,0,0.6);
  }

  .welcome-points {
    color: var(--gold-ink);
    font-weight: 900;
  }

  .welcome-username {
    color: var(--gold-ink);
    font-weight: 900;
  }

  .welcome-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid transparent;
    background-image: linear-gradient(#fff, #fff), var(--tri-gradient);
    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
    margin-left: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.4);
  }

  /* Hamburger menu overlay */
  .menu-overlay {
    position: fixed;
    top: 0;
    left: -100%;
    width: 100%;
    max-width: 400px;
    height: 100vh;
    background: linear-gradient(180deg, #141619 0%, #0e1013 100%);
    box-shadow: 4px 0 24px rgba(0,0,0,0.5);
    z-index: 10000;
    transition: left 0.3s var(--ease-spring);
    overflow-y: auto;
    border-right: 6px solid;
    border-image: linear-gradient(to bottom, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%) 1;
  }

  .menu-overlay.open {
    left: 0;
  }

  .menu-overlay-header {
    padding: 20px;
    background: #0f1114;
    border-bottom: 4px solid;
    border-image: linear-gradient(to right, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%) 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .menu-overlay-header h2 {
    margin: 0;
    color: var(--gold);
    font-size: 24px;
  }

  .menu-close-btn {
    background: none;
    border: none;
    color: var(--gold);
    font-size: 32px;
    cursor: pointer;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.2s;
  }

  .menu-close-btn:hover {
    background: rgba(237,183,35,0.1);
  }

  .menu-items {
    padding: 16px;
    display: grid;
    gap: 10px;
  }

  .menu-item {
    position: relative;
    display: block;
    padding: 18px 20px;
    background: radial-gradient(500px 200px at 50% -20%, rgba(237,183,35,0.08), transparent 60%), #0b0d0e;
    border-radius: 16px;
    color: var(--gold);
    font-size: 16px;
    font-weight: 900;
    text-transform: uppercase;
    transition: all 0.2s;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.35);
    text-decoration: none;
  }
  .menu-item::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 16px;
    padding: 6px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: -1;
  }

  .menu-item:hover {
    background: radial-gradient(500px 200px at 50% -20%, rgba(237,183,35,0.15), transparent 60%), #0b0d0e;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.45);
  }

  .menu-item-icon {
    margin-right: 12px;
    font-size: 20px;
  }

  /* Scrim for menu */
  .menu-scrim {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0,0,0,0.7);
    z-index: 9998;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }

  .menu-scrim.open {
    opacity: 1;
    pointer-events: all;
  }

  /* Adjust body padding for fixed nav */
  body {
    padding-top: 72px;
  }

  @media (max-width: 768px) {
    .menu-overlay {
      max-width: 100%;
    }

    .welcome-btn {
      padding: 8px 14px;
      font-size: 12px;
      gap: 6px;
    }

    .menu-btn img {
      width: 40px;
      height: 40px;
    }

    .top-nav-bar {
      padding: 8px 16px;
    }

    .welcome-avatar {
      width: 32px;
      height: 32px;
      margin-left: 6px;
    }
  }

  /* Make the drawer full-screen on phones & foldables so width isn't the limiter */
  @media (max-width:1024px){
    #buyDrawer{
      left:0 !important; right:0 !important; top:0 !important; bottom:0 !important;
      width:100vw !important; height:100vh !important; border-left:0 !important; border-radius:0 !important;
    }
    .drawer-scrim{display:none !important;}
    #buyDrawer .drawer-head{padding-top:calc(env(safe-area-inset-top,0px) + 14px)}
    #buyDrawer .drawer-body{padding-bottom:calc(env(safe-area-inset-bottom,0px) + 140px); overscroll-behavior:contain}
  }

  /* Use dynamic viewport height where supported */
  @supports (height: 100dvh){
    #buyDrawer{height:100dvh}
  }

  /* ===== BEAR OVERVIEW SECTION (DexScreener Style) ===== */
  .dex-layout{
    display:grid;
    grid-template-columns:1fr 360px;
    gap:20px;
    margin-top:24px;
  }
  @media(max-width:1100px){
    .dex-layout{grid-template-columns:1fr;}
    .dex-stats-sidebar{order:-1;}
  }

  .dex-chart-container{
    min-height:600px;
  }

  .dex-stats-sidebar{
    display:flex;
    flex-direction:column;
  }

  /* Stats List (DexScreener style) */
  .stats-list{
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .stat-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 14px;
    background:rgba(237,183,35,0.05);
    border-radius:8px;
    border:1px solid rgba(237,183,35,0.15);
    transition:all 0.2s;
  }

  .stat-item:hover{
    background:rgba(237,183,35,0.08);
    border-color:rgba(237,183,35,0.25);
  }

  .stat-label{
    font-size:15px;
    color:#fff;
    opacity:0.7;
    text-transform:uppercase;
    letter-spacing:0.5px;
    font-weight:700;
  }

  .stat-value{
    font-size:20px;
    font-weight:900;
    color:var(--gold);
    text-align:right;
  }

  /* ===== BEAR HONEY POINTS SECTION ===== */
  .honey-points-grid{
    display:grid;
    grid-template-columns:repeat(2, 1fr);
    gap:24px;
    margin-top:24px;
    max-width:900px;
    margin-left:auto;
    margin-right:auto;
  }
  @media(max-width:768px){
    .honey-points-grid{grid-template-columns:1fr;}
  }

  .honey-card{
    position: relative;
    background:var(--card);
    border-radius:16px;
    padding:20px;
    box-shadow:var(--elev);
    margin-bottom:20px;
  }
  .honey-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 16px;
    padding: 6px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: 0;
  }

  .honey-card-title{
    margin:0 0 16px 0;
    font-size:22px;
    font-weight:900;
    color:var(--gold);
    text-transform:uppercase;
    letter-spacing:0.5px;
  }

  /* Price Stats Grid */
  .price-stats-grid{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:12px;
  }
  @media(max-width:768px){
    .price-stats-grid{grid-template-columns:repeat(2, 1fr);}
  }

  .price-stat{
    background:rgba(237,183,35,0.08);
    padding:14px;
    border-radius:10px;
    border:2px solid rgba(237,183,35,0.2);
  }

  .price-stat-label{
    font-size:12px;
    color:#fff;
    opacity:0.9;
    margin-bottom:6px;
    text-transform:uppercase;
    letter-spacing:0.5px;
  }

  .price-stat-value{
    font-size:20px;
    font-weight:900;
    color:var(--gold);
  }

  /* Chart Container */
  .chart-container{
    background:rgba(0,0,0,0.3);
    border-radius:12px;
    overflow:hidden;
    border:2px solid rgba(0,0,0,0.5);
  }

  /* Liquidity Grid */
  .liquidity-grid{
    display:grid;
    gap:12px;
  }

  .liquidity-stat{
    display:flex;
    align-items:center;
    gap:14px;
    background:rgba(237,183,35,0.08);
    padding:16px;
    border-radius:10px;
    border:2px solid rgba(237,183,35,0.2);
  }

  .liquidity-icon{
    font-size:32px;
    line-height:1;
  }

  .liquidity-label{
    font-size:12px;
    color:#fff;
    opacity:0.9;
    margin-bottom:4px;
    text-transform:uppercase;
    letter-spacing:0.5px;
  }

  .liquidity-value{
    font-size:20px;
    font-weight:900;
    color:var(--gold);
  }

  /* My Points Card */
  .my-points-card{
    background:linear-gradient(135deg, rgba(237,183,35,0.15), rgba(215,92,70,0.15));
    border:3px solid var(--gold);
  }

  .points-hero{
    text-align:center;
    padding:24px;
    background:rgba(0,0,0,0.4);
    border-radius:12px;
    margin-bottom:16px;
    border:2px solid rgba(237,183,35,0.3);
  }

  .points-hero-value{
    font-size:56px;
    font-weight:900;
    color:var(--gold);
    line-height:1;
    text-shadow:0 2px 8px rgba(237,183,35,0.5);
  }

  .points-hero-label{
    font-size:14px;
    margin-top:8px;
    opacity:0.8;
    text-transform:uppercase;
    letter-spacing:1px;
  }

  .points-rank{
    text-align:center;
    padding:12px;
    background:rgba(0,0,0,0.3);
    border-radius:8px;
    margin-bottom:12px;
    font-size:14px;
  }

  .points-rank strong{
    color:var(--gold);
    font-size:16px;
  }

  .points-twitter{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    padding:10px;
    background:rgba(29,155,240,0.1);
    border-radius:8px;
    border:2px solid rgba(29,155,240,0.3);
  }

  .points-cta{
    text-align:center;
    padding:24px;
  }

  /* Leaderboard */
  .leaderboard-card{
    max-height:600px;
    display:flex;
    flex-direction:column;
  }

  .leaderboard{
    flex:1;
    overflow-y:auto;
    margin:-8px;
    padding:8px;
  }

  .leaderboard::-webkit-scrollbar{
    width:8px;
  }

  .leaderboard::-webkit-scrollbar-track{
    background:rgba(0,0,0,0.2);
    border-radius:4px;
  }

  .leaderboard::-webkit-scrollbar-thumb{
    background:var(--gold);
    border-radius:4px;
  }

  .leaderboard-loading{
    text-align:center;
    padding:32px;
    opacity:0.6;
  }

  .leaderboard-item{
    display:flex;
    align-items:center;
    gap:12px;
    padding:12px;
    background:rgba(237,183,35,0.08);
    border-radius:10px;
    border:2px solid rgba(237,183,35,0.2);
    margin-bottom:8px;
    transition:all 0.2s var(--ease-spring);
  }

  .leaderboard-item:hover{
    background:rgba(237,183,35,0.15);
    border-color:rgba(237,183,35,0.4);
    transform:translateX(4px);
  }

  .leaderboard-rank{
    font-size:20px;
    font-weight:900;
    color:var(--gold);
    min-width:32px;
    text-align:center;
  }

  .leaderboard-rank.top-3{
    font-size:24px;
  }

  .leaderboard-user{
    flex:1;
    min-width:0;
  }

  .leaderboard-username{
    font-weight:900;
    font-size:14px;
    color:var(--gold);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .leaderboard-wallet{
    font-size:11px;
    opacity:0.6;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .leaderboard-points{
    font-size:16px;
    font-weight:900;
    color:var(--honey);
    white-space:nowrap;
  }

  /* Trophy colors for top 3 */
  .leaderboard-item.rank-1 .leaderboard-rank{color:#FFD700;}
  .leaderboard-item.rank-2 .leaderboard-rank{color:#C0C0C0;}
  .leaderboard-item.rank-3 .leaderboard-rank{color:#CD7F32;}

  .leaderboard-item.rank-1{
    background:linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,215,0,0.05));
    border-color:rgba(255,215,0,0.4);
  }

  .leaderboard-item.rank-2{
    background:linear-gradient(135deg, rgba(192,192,192,0.15), rgba(192,192,192,0.05));
    border-color:rgba(192,192,192,0.4);
  }

  .leaderboard-item.rank-3{
    background:linear-gradient(135deg, rgba(205,127,50,0.15), rgba(205,127,50,0.05));
    border-color:rgba(205,127,50,0.4);
  }

  @media(max-width:768px){
    .honey-card{
      padding:16px;
    }
    .price-stats-grid{
      grid-template-columns:1fr;
    }
    .points-hero-value{
      font-size:42px;
    }
    .chart-container iframe{
      height:400px !important;
    }
  }
  </style>
</head>
<body>
  <!-- Fixed Top Navigation -->
  <div class="top-nav">
    <div class="top-nav-stripes">
      <div class="stripe-1"></div>
      <div class="stripe-2"></div>
      <div class="stripe-3"></div>
    </div>
    <div class="top-nav-bar">
      <button class="menu-btn" onclick="toggleMenu()" aria-label="Open menu">
        <img src="https://files.catbox.moe/1z14d9.jpg" alt="BEAR Park" width="52" height="52">
      </button>
      <button class="welcome-btn" onclick="openProfileSetup()" id="welcomeBtn">
        <span class="welcome-points" id="welcomePoints">HONEY üçØ: 0 PTS</span>
        <span class="welcome-username" id="welcomeUsername">WELCOME APEX</span>
        <img class="welcome-avatar" id="welcomeAvatar" style="display: none;" alt="Profile Avatar" width="40" height="40">
      </button>
    </div>
  </div>

  <!-- Menu Overlay -->
  <div class="menu-scrim" id="menuScrim" onclick="toggleMenu()"></div>
  <div class="menu-overlay" id="menuOverlay">
    <div class="menu-overlay-header">
      <h2>üêª BEAR PARK</h2>
      <button class="menu-close-btn" onclick="toggleMenu()" aria-label="Close menu">&times;</button>
    </div>
    <div class="menu-items">
      <a href="#bear-overview" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">üìä</span>BEAR OVERVIEW
      </a>
      <a href="#honey-points" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">üçØ</span>BEAR HONEY POINTS
      </a>
      <a href="#bearcade" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">üéÆ</span>BEARCADE
      </a>
      <a href="#leaderboards" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">üèÜ</span>LEADERBOARDS
      </a>
      <a href="#bg123" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">üìñ</span>BG123 LORE
      </a>
      <a href="#nfts" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">üñºÔ∏è</span>NFT COLLECTIONS
      </a>
      <a href="#community" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">üë•</span>COMMUNITY
      </a>
      <a href="#memes" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">üé≠</span>5D MEMES
      </a>
      <a href="#network" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">üí∞</span>BUY $BEAR
      </a>
    </div>
  </div>

  <a class="skip-link" href="#bearcade">Skip to BEARcade</a>

  <!-- Sticky nav -->
  <div class="site-nav" role="navigation" aria-label="Primary">
    <div class="progress" id="progress"></div>
    <div class="bar">
      <a class="brand" href="#top" aria-label="BEAR Park Home">
        <img src="https://files.catbox.moe/25ekkd.png" width="72" height="72" alt="BEAR Park logo" loading="eager" decoding="sync" />
        <span>BEAR Park</span>
      </a>
      <nav class="links" aria-label="Sections">
        <a href="#honey-points">üçØ Honey Points</a>
        <a href="#bearcade">BEARcade</a>
        <a href="#leaderboards">üèÜ Leaderboards</a>
        <a href="#bg123">BG123</a>
        <a href="#nfts">NFTs</a>
        <a href="#community">Community</a>
        <a href="#memes">5D Memes</a>
        <a href="#network">Network</a>
      </nav>
      <div class="nav-cta">
        <a class="btn gold" href="#network">Buy $BEAR</a>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <header class="hero" role="banner">
    <div class="wrap center reveal">
      <div class="plate" id="heroPlate">
        <img class="logo" src="https://files.catbox.moe/25ekkd.png" alt="BEAR PARK sign" width="120" height="120" loading="eager" decoding="sync">
        <h1 class="h1">BEAR</h1>
        <p class="subtitle">welcome to BEAR park</p>
      </div>
    </div>
  </header>

  <!-- BEAR OVERVIEW -->
  <section class="alt" id="bear-overview">
    <div class="wrap reveal">
      <h2 class="h2" style="font-size:clamp(42px, 5vw, 64px);">üìä BEAR OVERVIEW</h2>
      <p style="text-align:center;margin:-6px 0 32px;opacity:0.9;font-size:clamp(18px, 2.5vw, 22px);font-weight:700;">Live $BEAR price, market stats, chart, and liquidity pool.</p>

      <div class="dex-layout">
        <!-- Main Chart Area -->
        <div class="dex-chart-container">
          <div class="honey-card" style="height:100%; margin-bottom:0;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
              <h3 class="honey-card-title" style="margin:0;">üìà Live Chart</h3>
              <a href="https://dexscreener.com/xrpl/4245415200000000000000000000000000000000.rbearguasyu7tuw53rufqzfdwmjhpjeqfw_xrp"
                 target="_blank"
                 rel="noopener noreferrer"
                 style="display:inline-flex; align-items:center; gap:6px; padding:8px 16px; background:var(--gold); color:#000; border-radius:8px; font-size:12px; font-weight:900; text-transform:uppercase; transition:all 0.2s; border:2px solid transparent; border-image: var(--tri-gradient) 1;"
                 onmouseover="this.style.background='#ffca3a'"
                 onmouseout="this.style.background='var(--gold)'">
                <span>üìä View Transactions</span>
              </a>
            </div>
            <div class="chart-container">
              <div id="chart-error" style="display:none;">
                <div style="padding:40px; text-align:center; color:var(--gold); background:rgba(0,0,0,0.5); border-radius:12px; height:600px; display:flex; flex-direction:column; align-items:center; justify-content:center;">
                  <div style="font-size:48px; margin-bottom:16px;">üìä</div>
                  <div style="font-size:18px; font-weight:900; margin-bottom:12px;">Chart Loading Issue</div>
                  <div style="opacity:0.8; margin-bottom:20px;">The embedded chart may be blocked by your browser settings.</div>
                  <a href="https://dexscreener.com/xrpl/4245415200000000000000000000000000000000.rbearguasyu7tuw53rufqzfdwmjhpjeqfw_xrp"
                     target="_blank"
                     rel="noopener noreferrer"
                     class="btn gold">
                    View Full Chart on DexScreener
                  </a>
                </div>
              </div>
              <iframe
                id="dexscreener-embed"
                src="https://dexscreener.com/xrpl/4245415200000000000000000000000000000000.rbearguasyu7tuw53rufqzfdwmjhpjeqfw_xrp?embed=1&theme=dark&trades=0&info=0"
                style="width:100%; height:600px; border:0; border-radius:12px; background:#000; display:block;"
                title="DexScreener Chart"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
              ></iframe>
            </div>
          </div>
        </div>

        <!-- Stats Sidebar -->
        <div class="dex-stats-sidebar">
          <!-- Price Stats -->
          <div class="honey-card" style="margin-bottom:20px;">
            <h3 class="honey-card-title">üí∞ Price & Market</h3>
            <div class="stats-list">
              <div class="stat-item">
                <div class="stat-label">$BEAR / XRP</div>
                <div class="stat-value" id="honeyPriceXrp">‚Äî</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">$BEAR / USD</div>
                <div class="stat-value" id="honeyPriceUsd">‚Äî</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">24h Change</div>
                <div class="stat-value" id="honeyChange24h">‚Äî</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">24h Volume</div>
                <div class="stat-value" id="honeyVolume">‚Äî</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">Market Cap</div>
                <div class="stat-value" id="honeyMcap">‚Äî</div>
              </div>
            </div>
          </div>

          <!-- Liquidity Pool -->
          <div class="honey-card">
            <h3 class="honey-card-title">üíß Liquidity Pool</h3>
            <div class="stats-list">
              <div class="stat-item">
                <div class="stat-label">XRP Liquidity</div>
                <div class="stat-value" id="liquidityXrp">‚Äî</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">USD Value</div>
                <div class="stat-value" id="liquidityUsd">‚Äî</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- BEAR HONEY POINTS -->
  <section class="dark" id="honey-points">
    <div class="wrap reveal">
      <h2 class="h2">üçØ BEAR HONEY POINTS</h2>
      <p style="text-align:center;margin:-6px 0 32px;opacity:0.9;">Earn honey points by playing games and compete on the leaderboard!</p>

      <div class="honey-points-grid">
        <!-- My Points Card -->
        <div class="honey-card my-points-card">
            <h3 class="honey-card-title">üçØ My Honey Points</h3>
            <div id="myPointsAuth" style="display:none;">
              <div class="points-hero">
                <div class="points-hero-value" id="myHoneyPoints">0</div>
                <div class="points-hero-label">HONEY POINTS</div>
              </div>
              <div class="points-rank">
                <span>Your Rank: <strong id="myRank">‚Äî</strong></span>
              </div>
              <div class="points-twitter">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#1DA1F2"><path d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"/></svg>
                <span id="myTwitterHandle">@username</span>
              </div>
            </div>
            <div id="myPointsGuest">
              <div class="points-cta">
                <div style="font-size:48px;margin-bottom:12px;">üçØ</div>
                <p style="margin:0 0 16px 0;opacity:0.8;">Connect your wallet and link Twitter to start earning Honey Points!</p>
                <button class="btn gold" data-open-drawer style="margin-bottom:12px;">Connect Wallet</button>

                <div style="margin-top:20px;padding:16px;background:rgba(29,155,240,0.1);border-radius:12px;border:2px solid rgba(29,155,240,0.3);">
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="#1DA1F2" style="margin:0 auto 8px;display:block;"><path d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"/></svg>
                  <div style="font-size:15px;font-weight:900;margin-bottom:8px;text-align:center;">Connect Twitter to Earn Honey Points üçØ</div>
                  <div style="font-size:12px;opacity:0.8;margin-bottom:10px;line-height:1.4;text-align:center;">
                    Link your Twitter username to track @bearxrpl activity
                  </div>
                  <div style="font-size:10px;opacity:0.6;margin-bottom:12px;padding:10px;background:rgba(255,255,255,0.05);border-radius:6px;line-height:1.5;text-align:left;">
                    <strong>What we access:</strong> Username & public @bearxrpl tweets<br>
                    <strong>What we DON'T do:</strong> Post, see DMs, or access private data
                  </div>
                  <button id="connectTwitterBtnMain" class="btn gold" style="width:100%;font-size:14px;padding:10px;">Connect Twitter Username</button>
                  <div style="margin-top:10px;font-size:11px;opacity:0.7;line-height:1.4;text-align:center;">
                    üçØ 10 honey points per @bearxrpl mention<br>
                    üçØ 20 honey points per raid participation
                  </div>
                </div>
              </div>
            </div>
          </div>

        <!-- Leaderboard -->
        <div class="honey-card leaderboard-card">
          <h3 class="honey-card-title">üèÜ Top Honey Earners</h3>
          <div class="leaderboard" id="honeyLeaderboard">
            <div class="leaderboard-loading">Loading leaderboard...</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- BEARCADE -->
  <section class="alt" id="bearcade">
    <div class="wrap reveal">
      <h2 class="h2">BEARCADE</h2>
      <p style="text-align:center;margin:-6px 0 24px;">PLAY GAMES AND EARN HONEY POINTS! PLAY ANY OF THE 3 BELOW üçØ üéÆ</p>

      <div class="arcade" role="group" aria-label="Arcade machines (3)">
        <img src="https://files.catbox.moe/llxd86.png" alt="Three retro arcade machines with honey walls and neon trim" width="1100" height="650" loading="eager" decoding="async">
        <a class="hotspot" href="/flappybear" style="left:7%; top:10%; width:27%; height:84%;" aria-label="Play Flappy BEAR">Flappy Bear</a>
        <a class="hotspot" href="https://bear-jumpventure1.vercel.app/" onclick="return openGameWithAuth(event, 'https://bear-jumpventure1.vercel.app/')" target="_blank" rel="noopener noreferrer" style="left:37%; top:10%; width:26%; height:84%;" aria-label="Open Bear Ninja in a new tab">Bear Ninja</a>
        <a class="hotspot" href="https://bear-jumpventure.vercel.app/" onclick="return openGameWithAuth(event, 'https://bear-jumpventure.vercel.app/')" target="_blank" rel="noopener noreferrer" style="left:66.5%; top:10%; width:27%; height:84%;" aria-label="Open Bear Jumpventure in a new tab">Bear Jumpventure</a>
      </div>
    </div>
  </section>

  <!-- LEADERBOARDS -->
  <section class="dark" id="leaderboards">
    <div class="wrap reveal">
      <h2 class="h2">üèÜ LEADERBOARDS üèÜ</h2>
      <p style="text-align:center;margin:-6px 0 32px;">Top players across all BEAR games ‚Äî wallet-verified high scores!</p>

      <div class="grid-3" style="gap:24px;">

        <!-- Flappy BEAR Leaderboard -->
        <div class="leaderboard-card">
          <h3 class="h3" style="text-align:center; margin-bottom:16px;">
            <span style="color:var(--gold);">FLAPPY</span> BEAR
          </h3>
          <div id="leaderboard-flappy" class="leaderboard-list">
            <div class="loading">Loading scores...</div>
          </div>
        </div>

        <!-- BEAR Slice Leaderboard -->
        <div class="leaderboard-card">
          <h3 class="h3" style="text-align:center; margin-bottom:16px;">
            BEAR <span style="color:var(--gold);">SLICE</span>
          </h3>
          <div id="leaderboard-slice" class="leaderboard-list">
            <div class="loading">Loading scores...</div>
          </div>
        </div>

        <!-- BEAR Jump Venture Leaderboard -->
        <div class="leaderboard-card">
          <h3 class="h3" style="text-align:center; margin-bottom:16px;">
            BEAR <span style="color:var(--gold);">JUMPVENTURE</span>
          </h3>
          <div id="leaderboard-jumpventure" class="leaderboard-list">
            <div class="loading">Loading scores...</div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- BEARABLEGUY123 -->
  <section class="dark" id="bg123">
    <div class="wrap reveal">
      <h2 class="h2">BEARABLEGUY123</h2>
      <p class="center on-dark" style="opacity:.9;margin:-6px 0 20px;">Since 2018, Bearableguy posted riddles in images with a red masked bear. The community uncovered hints like ‚Äú589.‚Äù</p>

      <div class="card" role="region" aria-roledescription="carousel" aria-label="Bearableguy image gallery" aria-live="polite">
        <div class="carousel" id="carousel">
          <div class="viewport" id="viewport" tabindex="0" aria-label="Carousel viewport (use left and right arrow keys)">
            <div class="slides" id="slides">
              <img src="https://files.catbox.moe/f6k3b1.jpg" alt="BG123 poster 1" width="1600" height="900" loading="lazy" decoding="async">
              <img src="https://files.catbox.moe/18vwoq.jpg" alt="BG123 poster 2" width="1600" height="900" loading="lazy" decoding="async">
              <img src="https://files.catbox.moe/ruozs3.jpg" alt="BG123 poster 3" width="1600" height="900" loading="lazy" decoding="async">
              <img src="https://files.catbox.moe/ha4uwj.jpg" alt="BG123 poster 4" width="1600" height="900" loading="lazy" decoding="async">
              <img src="https://files.catbox.moe/n0le0t.jpg" alt="BG123 poster 5" width="1600" height="900" loading="lazy" decoding="async">
              <img src="https://files.catbox.moe/wbin3t.jpg" alt="BG123 poster 6" width="1600" height="900" loading="lazy" decoding="async">
              <img src="https://files.catbox.moe/lrtbxe.png" alt="BG123 poster 7" width="1600" height="900" loading="lazy" decoding="async">
            </div>
          </div>
        </div>
        <div class="dots" id="dots" role="tablist" aria-label="Choose slide"></div>
      </div>
    </div>
  </section>

  <!-- NFTs -->
  <section class="alt" id="nfts">
    <div class="wrap reveal">
      <h2 class="h2">BEAR NFTs</h2>
      <p style="text-align:center;margin:-6px 0 24px;">The BEAR community has collectible NFTs for profile pictures ‚Äî the <strong>Ultra Rare Collection</strong> and the <strong>Pixel Collection</strong>.</p>

      <div class="grid-2">
        <div class="card">
          <h3 class="h3">ULTRA RARE BEARS</h3>
          <p style="text-align:center;opacity:.95;">The BEAR Ultra Rare collection was the first mint and consists of 667 NFTs.</p>
          <div class="spacer"></div>
          <a class="nft-media" href="https://xrp.cafe/collection/bearxrpl" target="_blank" rel="noopener">
            <img src="https://cdn.xrp.cafe/362e53289fd2-49f8-b070-4a3a6f95617272729975700c-46ba-a056-0aaf34028496f5a507b1d5a4-4adc-ad01-8d8b6ecd631d.webp" alt="Ultra Rare Bear preview" width="1200" height="1200" loading="lazy" decoding="async">
          </a>
          <div class="center" style="margin-top:16px;">
            <a class="btn gold" href="https://xrp.cafe/collection/bearxrpl" target="_blank" rel="noopener">Ultra Collection</a>
          </div>
        </div>

        <div class="card">
          <h3 class="h3">PIXEL BEARS</h3>
          <p style="text-align:center;opacity:.95;">There are 5880 Pixel BEARS to provide a profile picture for every $BEAR maxi.</p>
          <div class="spacer"></div>
          <a class="nft-media" href="https://xrp.cafe/collection/bear-pixel-collection" target="_blank" rel="noopener">
            <video src="https://files.catbox.moe/babbn1.mp4" playsinline muted autoplay loop poster="https://files.catbox.moe/babbn1.jpg"></video>
          </a>
          <div class="center" style="margin-top:16px;">
            <a class="btn gold" href="https://xrp.cafe/collection/bear-pixel-collection" target="_blank" rel="noopener">Pixel Collection</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- COMMUNITY -->
  <section class="dark" id="community">
    <div class="wrap reveal">
      <h2 class="h2">COMMUNITY</h2>

    <div class="community-banner" role="img" aria-label="$BEAR community montage with honey lighting">
        <img class="bg" src="https://files.catbox.moe/kgs8as.jpg" alt="" width="2000" height="1000" loading="lazy" decoding="async">
        <div class="overlay">
          <p class="on-dark" style="text-align:center;margin:0 0 8px;">Come meet the $BEAR fam in the official communities!</p>
          <div class="pair">
            <a class="btn gold" href="https://x.com/bearxrpl" target="_blank" rel="noopener">Join us on X</a>
            <a class="btn gold" href="https://discord.com/invite/atGTNuzqH6" target="_blank" rel="noopener">Join Discord</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 5D MEMES -->
  <section class="alt" id="memes">
    <div class="wrap reveal">
      <h2 class="h2">5D MEMES</h2>
      <p style="text-align:center;margin:-6px 0 18px;color:var(--gold-ink)">Live stream from Kick</p>

      <div class="card">
        <div class="square" id="kickWrap">
          <!-- Lazy-loaded Kick embed with placeholder -->
          <button class="placeholder btn ghost" id="kickPlaceholder" aria-label="Load live Kick stream">
            ‚ñ∂ Load live Kick stream
          </button>
        </div>
        <div class="center" style="margin-top:14px;">
          <a class="btn ghost" href="https://kick.com/bearxrpl" target="_blank" rel="noopener">Open on Kick</a>
        </div>
      </div>
    </div>
  </section>

  <!-- NETWORK -->
  <section class="dark" id="network">
    <div class="wrap reveal">
      <h2 class="h2">NETWORK</h2>
      <p class="on-dark" style="text-align:center;margin:-6px 0 24px;">Buy $BEAR here</p>

      <div class="grid-2">
        <a class="tile" href="https://firstledger.net/token/rBEARGUAsyu7tUw53rufQzFdWmJHpJEqFW/4245415200000000000000000000000000000000" target="_blank" rel="noopener">
          <div class="face"><img src="https://files.catbox.moe/du61x3.jpg" alt="First Ledger" width="300" height="64" loading="lazy" decoding="async"></div>
          <span class="lbl">First Ledger</span>
        </a>
        <a class="tile" href="https://xmagnetic.org/dex/BEAR+rBEARGUAsyu7tUw53rufQzFdWmJHpJEqFW_XRP+XRP?network=mainnet" target="_blank" rel="noopener">
          <div class="face"><img src="https://files.catbox.moe/m9ck1m.png" alt="Magnetic DEX" width="300" height="64" loading="lazy" decoding="async"></div>
          <span class="lbl">Magnetic DEX</span>
        </a>
        <a class="tile" href="https://xpmarket.com/token/BEAR-rBEARGUAsyu7tUw53rufQzFdWmJHpJEqFW" target="_blank" rel="noopener">
          <div class="face"><img src="https://files.catbox.moe/1dw0sy.png" alt="XPMarket" width="220" height="64" loading="lazy" decoding="async"></div>
          <span class="lbl">XPMarket</span>
        </a>
      </div>
    </div>
  </section>

  <footer class="dark">
    <div class="wrap center" style="gap:14px;flex-wrap:wrap;">
      <span class="on-dark" style="opacity:.9;">¬© BEAR Park ‚Äî Defend the castle üè∞</span>
      <a class="btn ghost" href="#top">Back to Top</a>
    </div>
  </footer>

  <!-- Buy Drawer -->
  <aside id="buyDrawer" class="drawer" aria-hidden="true">
    <div class="drawer-head">
      <h3 class="h3" style="margin:0;"><span style="color:var(--gold);">BEAR</span> <span style="color:#fff;">HUB</span></h3>
      <button class="drawer-close-btn" data-close-drawer aria-label="Close BEAR HUB">
        &times;
      </button>
    </div>
    <div class="drawer-body">
      <!-- MY $BEAR PORTFOLIO -->
      <div id="portfolioSection" class="portfolio-card" style="display:none;">
        <h4 style="margin:0 0 16px 0; font-size:18px; font-weight:900; color:var(--gold); text-transform:uppercase; letter-spacing:0.5px;">üíº My $BEAR Portfolio</h4>
        <div class="portfolio-stats">
          <div class="stat-row" style="margin-bottom:16px;">
            <span class="stat-label" style="font-size:15px; display:flex; align-items:center; gap:6px;">
              <img src="/favicon-32x32.png" alt="BEAR" width="20" height="20" style="display:inline-block; vertical-align:middle;"> Total $BEAR:
            </span>
            <span id="portfolioBearAmount" class="stat-value" style="font-size:24px; font-weight:900;">‚Äî</span>
          </div>
          <div class="stat-row" style="margin-bottom:12px;">
            <span class="stat-label" style="font-size:15px;">üíµ USD Value:</span>
            <span id="portfolioUsdValue" class="stat-value" style="font-size:20px; font-weight:900;">‚Äî</span>
          </div>
          <div class="stat-row">
            <span class="stat-label" style="font-size:15px;">üî∑ XRP Value:</span>
            <span id="portfolioXrpValue" class="stat-value" style="font-size:20px; font-weight:900;">‚Äî</span>
          </div>
        </div>
        <div class="wallet-address" style="margin-top:16px; padding:10px; background:rgba(0,0,0,0.4); border-radius:8px; border:1px solid rgba(237,183,35,0.2); font-size:13px; font-family:monospace; word-break:break-all; text-align:center; color:rgba(255,255,255,0.8);">
          <span id="connectedWalletAddress">‚Äî</span>
        </div>
      </div>

      <!-- USER PROFILE CUSTOMIZATION -->
      <div id="profileSection" class="profile-card" style="display:none;">
        <div id="profileSetupSection">
          <h4 style="margin:0 0 16px 0; font-size:18px; font-weight:900; color:var(--gold); text-transform:uppercase; letter-spacing:0.5px;">üë§ Your Profile</h4>

        <div style="background:rgba(0,0,0,0.3); padding:18px; border-radius:12px; border:2px solid rgba(237,183,35,0.2); margin-bottom:16px;">
          <div style="margin-bottom:16px;">
            <label style="display:block; font-size:14px; font-weight:900; margin-bottom:8px; color:var(--gold);">Display Name</label>
            <input type="text" id="profileUsername" placeholder="Enter your username" maxlength="20" style="width:100%; padding:12px; background:rgba(0,0,0,0.5); border:2px solid rgba(237,183,35,0.3); border-radius:10px; color:#fff; font-size:16px; font-family:inherit; transition:border-color 0.2s;">
          </div>

          <div>
            <label style="display:block; font-size:14px; font-weight:900; margin-bottom:8px; color:var(--gold);">Profile Avatar</label>
            <div id="profileAvatarSelector" style="background:rgba(0,0,0,0.5); padding:12px; border-radius:10px; border:2px solid rgba(237,183,35,0.3); min-height:70px; display:flex; align-items:center; justify-content:center;">
              <div style="text-align:center; opacity:0.6; font-size:13px;">Select from your NFTs below</div>
            </div>
            <input type="hidden" id="profileAvatarNFT" value="">
          </div>
        </div>

        <button id="saveProfileBtn" class="btn gold" style="width:100%; font-size:18px; padding:16px; font-weight:900; letter-spacing:0.5px;">üíæ Save Profile</button>
        </div>
      </div>

      <!-- NFT VIEWING SECTION -->
      <div id="nftSection" style="display:none; flex:1; min-height:0; display:flex; flex-direction:column;">
        <h4 style="margin:0 0 16px 0; font-size:18px; font-weight:900; color:var(--gold); text-transform:uppercase; letter-spacing:0.5px;">üñºÔ∏è Your NFTs</h4>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:18px;">
          <button id="viewPixelBearsBtn" class="btn gold" style="font-size:15px; padding:14px; font-weight:900;">üêª Pixel Bears</button>
          <button id="viewUltraRaresBtn" class="btn gold" style="font-size:15px; padding:14px; font-weight:900;">üíé Ultra Rares</button>
        </div>

        <div id="nftGrid" style="display:none; flex:1; min-height:0; overflow-y:auto; background:rgba(0,0,0,0.3); padding:10px; border-radius:10px; border:2px solid rgba(237,183,35,0.2);">
          <div id="nftGridContent" style="display:grid; grid-template-columns:repeat(2, 1fr); gap:10px;">
            <!-- NFTs will be loaded here -->
          </div>
        </div>

        <div id="nftLoading" style="display:none; text-align:center; padding:20px; opacity:0.6;">
          Loading NFTs...
        </div>

        <div id="nftEmpty" style="display:none; text-align:center; padding:20px; opacity:0.6; font-size:12px;">
          No NFTs found in your wallet
        </div>
      </div>
    </div>
  </aside>

  <!-- Structured data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "BEAR Park",
    "url": "https://bearpark.xyz/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://bearpark.xyz/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>

  <script>
  // === AUTHENTICATION CHECK - Prevent bypass ===
  (function checkAuth(){
    const isAuthenticated = sessionStorage.getItem('bearpark_auth');
    const authenticatedWallet = sessionStorage.getItem('bearpark_wallet');

    // If not authenticated, redirect to login page
    if(isAuthenticated !== 'true' || !authenticatedWallet){
      window.location.href = 'index.html';
      return;
    }

    // Optional: Display wallet address in console for debugging
    console.log('Authenticated wallet:', authenticatedWallet);

    // Add logout button
    const logoutBtn = document.createElement('button');
    logoutBtn.className = 'fab-logout';
    logoutBtn.innerHTML = '<span>Disconnect</span>';
    logoutBtn.setAttribute('aria-label', 'Disconnect wallet and logout');
    logoutBtn.addEventListener('click', function(){
      if(confirm('Are you sure you want to disconnect your wallet?')){
        sessionStorage.removeItem('bearpark_auth');
        sessionStorage.removeItem('bearpark_wallet');
        window.location.href = 'index.html';
      }
    });
    document.body.appendChild(logoutBtn);
  })();

  document.documentElement.classList.remove('no-js');

  /* Input modality hint */
  document.addEventListener('mousedown',()=>document.body.classList.add('using-mouse'));
  document.addEventListener('keydown',()=>document.body.classList.remove('using-mouse'));

  /* ===== Scroll reveal ===== */
  const io=new IntersectionObserver((entries)=>entries.forEach(e=>{
    if(e.isIntersecting){
      e.target.classList.add('in'); io.unobserve(e.target);
    }
  }),{threshold:.15});
  document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

  /* ===== Sticky nav scroll progress + scrollspy ===== */
  (function(){
    const progress = document.getElementById('progress');
    const links = Array.from(document.querySelectorAll('.links a'));
    const sections = links.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);

    function spy(){
      const de=document.documentElement;
      const scrollTop = de.scrollTop || document.body.scrollTop;
      const scrollHeight = de.scrollHeight - de.clientHeight;
      const pct = scrollHeight ? scrollTop / scrollHeight : 0;
      if(progress) progress.style.transform = `scaleX(${pct})`;

      let activeIndex = sections.findIndex((sec, i) => {
        const next = sections[i+1];
        const top = sec.offsetTop - 120;
        const bottom = next ? next.offsetTop - 120 : Infinity;
        return scrollTop >= top && scrollTop < bottom;
      });
      links.forEach((a,i)=> a.setAttribute('aria-current', i===activeIndex ? 'true' : 'false'));
    }
    document.addEventListener('scroll', spy, {passive:true});
    window.addEventListener('resize', spy);
    spy();
  })();

  /* ===== Hero parallax ===== */
  (function(){
    const plate=document.getElementById('heroPlate');
    if(!plate) return;
    if (matchMedia('(prefers-reduced-motion: reduce)').matches) return;

    function tilt(x,y){
      const rX = (y-0.5)*10;
      const rY = (x-0.5)*-10;
      plate.style.transform = `perspective(800px) rotateX(${rX}deg) rotateY(${rY}deg) translateZ(0)`;
    }
    function reset(){ plate.style.transform='perspective(800px) rotateX(0) rotateY(0)'; }

    window.addEventListener('mousemove',e=>{
      const r=plate.getBoundingClientRect();
      tilt((e.clientX-r.left)/r.width,(e.clientY-r.top)/r.height);
    });
    window.addEventListener('mouseleave',reset);
  })();

  /* ===== Magnetic buttons (skip on touch) ===== */
  (function(){
    if (matchMedia('(pointer: coarse)').matches) return;
    const strength = 14;
    const maxShift = 10;

    document.querySelectorAll('.btn').forEach(btn=>{
      let raf = null;
      function onMove(e){
        if (raf) cancelAnimationFrame(raf);
        raf = requestAnimationFrame(()=>{
          const rect = btn.getBoundingClientRect();
          const cx = rect.left + rect.width/2;
          const cy = rect.top + rect.height/2;
          const dx = Math.max(-maxShift, Math.min(maxShift, (e.clientX - cx)/strength));
          const dy = Math.max(-maxShift, Math.min(maxShift, (e.clientY - cy)/strength));
          btn.style.transform = `translate(${dx}px, ${dy}px)`;
        });
      }
      btn.addEventListener('mousemove', onMove);
      btn.addEventListener('mouseleave', ()=>{
        if (raf) cancelAnimationFrame(raf);
        btn.style.transform = 'translate(0,0)';
      });
    });
  })();

  /* ===== Carousel: a11y + keys + swipe + zoom/pan ===== */
  (function(){
    const slides = document.getElementById('slides');
    const viewport = document.getElementById('viewport');
    if(!slides || !viewport) return;

    const imgs = slides.querySelectorAll('img');
    const dotsWrap = document.getElementById('dots');

    const Z_MIN = 1, Z_MAX = 4;
    let idx=0, n=imgs.length, timer=null, userPaused=false;
    let isDrag=false, startX=0, deltaX=0, dragged=false;
    let scale=1, panX=0, panY=0, pinchStartDist=0, startScale=1, lastX=0, lastY=0;
    let zoomGesture=false;

    imgs.forEach((_,i)=>{
      const b=document.createElement('button');
      b.type='button';
      b.className='dot'+(i===0?' active':'');
      b.setAttribute('role','tab');
      b.setAttribute('aria-selected', i===0 ? 'true' : 'false');
      b.setAttribute('aria-label', `Show slide ${i+1} of ${n}`);
      b.addEventListener('click', ()=>go(i,true));
      dotsWrap.appendChild(b);
    });
    const dots=[...dotsWrap.children];

    function applyZoom(){ imgs[idx].style.transform = `translate(${panX}px, ${panY}px) scale(${scale})`; }
    function resetZoom(all=false){
      scale=1; panX=0; panY=0;
      (all?imgs:[imgs[idx]]).forEach(i=>{
        i.style.transition='transform .2s ease';
        i.style.transform='scale(1)';
        setTimeout(()=>i.style.transition='',200);
      });
    }
    function clampPan(){
      const vw=viewport.clientWidth, vh=viewport.clientHeight;
      const maxX=(vw*(scale-1))/2, maxY=(vh*(scale-1))/2;
      panX=Math.max(-maxX,Math.min(maxX,panX));
      panY=Math.max(-maxY,Math.min(maxY,panY));
    }
    function go(i, user){
      resetZoom(true);
      idx=(i+n)%n;
      slides.style.transition='transform .7s var(--ease-spring)';
      slides.style.transform=`translateX(-${idx*100}%)`;
      dots.forEach((d,k)=>{
        const active = k===idx;
        d.classList.toggle('active',active);
        d.setAttribute('aria-selected', active ? 'true' : 'false');
      });
      viewport.setAttribute('aria-label', `Carousel viewport ‚Äî slide ${idx+1} of ${n}`);
      if(user && !userPaused) restart();
    }
    function next(){ go(idx+1,false) }
    function restart(){
      clearInterval(timer);
      timer=setInterval(()=>{ if(!userPaused && scale===1) next(); },4000);
    }

    viewport.addEventListener('mousedown',e=>{
      isDrag=true; dragged=false; startX=e.clientX; lastX=e.clientX; lastY=e.clientY;
      viewport.classList.add('grabbing'); clearInterval(timer);
    });
    window.addEventListener('mousemove',e=>{
      if(!isDrag) return;
      if(scale>1){
        const dx=e.clientX-lastX, dy=e.clientY-lastY;
        lastX=e.clientX; lastY=e.clientY; panX+=dx; panY+=dy; clampPan(); applyZoom(); dragged=true; return;
      }
      deltaX=e.clientX-startX;
      slides.style.transition='none';
      slides.style.transform=`translateX(${ -idx*100 + (deltaX/viewport.clientWidth)*100 }%)`;
      if(Math.abs(deltaX)>3) dragged=true;
    });
    window.addEventListener('mouseup',()=>{
      if(!isDrag) return;
      isDrag=false; viewport.classList.remove('grabbing');
      if(scale>1){ if(!userPaused) restart(); return; }
      const threshold = viewport.clientWidth*0.12;
      if(Math.abs(deltaX)>threshold){ go(idx + (deltaX<0?1:-1), true); } else { go(idx,false); }
      if(!userPaused) restart();
    });

    viewport.addEventListener('click',()=>{
      if(dragged || scale>1 || zoomGesture) return;
      userPaused=!userPaused;
      if(userPaused) clearInterval(timer); else restart();
    });
    viewport.addEventListener('keydown',e=>{
      if(e.key==='ArrowRight'){ go(idx+1,true); }
      else if(e.key==='ArrowLeft'){ go(idx-1,true); }
      else if(e.key===' '){ userPaused=!userPaused; if(userPaused) clearInterval(timer); else restart(); e.preventDefault(); }
    });

    viewport.addEventListener('touchstart',e=>{
      if(e.touches.length===2){
        zoomGesture=true; clearInterval(timer);
        const [a,b]=e.touches; pinchStartDist=Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY); startScale=scale;
      } else if(e.touches.length===1){
        dragged=false; startX=e.touches[0].clientX; lastX=e.touches[0].clientX; lastY=e.touches[0].clientY;
      }
    },{passive:false});

    viewport.addEventListener('touchmove',e=>{
      if(zoomGesture && e.touches.length===2){
        e.preventDefault();
        const [a,b]=e.touches; const dist=Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY);
        scale=Math.max(Z_MIN,Math.min(Z_MAX, startScale * (dist/pinchStartDist)));
        clampPan(); applyZoom();
      } else if(scale>1 && e.touches.length===1){
        e.preventDefault();
        const t=e.touches[0]; const dx=t.clientX-lastX, dy=t.clientY-lastY;
        lastX=t.clientX; lastY=t.clientY; panX+=dx; panY+=dy; clampPan(); applyZoom(); dragged=true;
      } else if(scale===1 && e.touches.length===1){
        const x=e.touches[0].clientX; deltaX=x-startX;
        slides.style.transition='none';
        slides.style.transform=`translateX(${ -idx*100 + (deltaX/viewport.clientWidth)*100 }%)`;
      }
    },{passive:false});

    viewport.addEventListener('touchend',e=>{
      if(zoomGesture && e.touches.length<2){
        zoomGesture=false;
        if(scale<=1.01){ scale=1; panX=0; panY=0; applyZoom(); }
        restart(); return;
      }
      if(scale>1){ restart(); return; }
      const threshold = viewport.clientWidth*0.12;
      if(Math.abs(deltaX)>threshold){ go(idx + (deltaX<0?1:-1), true); } else { go(idx,false); }
    });

    viewport.addEventListener('wheel',e=>{
      e.preventDefault(); clearInterval(timer);
      const rect=viewport.getBoundingClientRect();
      const cx=e.clientX-rect.left - rect.width/2;
      const cy=e.clientY-rect.top - rect.height/2;
      const prevScale=scale;
      scale = Math.max(Z_MIN, Math.min(Z_MAX, scale * (e.deltaY>0 ? 0.9 : 1.1)));
      panX = (panX + cx) * (scale/prevScale) - cx;
      panY = (panY + cy) * (scale/prevScale) - cy;
      clampPan(); applyZoom();
    },{passive:false});

    go(0,false);
    restart();
    window.addEventListener('visibilitychange',()=>document.hidden?clearInterval(timer):(!userPaused&&restart()));
  })();

  /* ===== Lazy load Kick iframe ===== */
  function loadKick(){
    const wrap=document.getElementById('kickWrap');
    if(!wrap || wrap.dataset.loaded) return;
    const iframe=document.createElement('iframe');
    iframe.src='https://player.kick.com/bearxrpl?autoplay=true&muted=true';
    iframe.allow='autoplay; encrypted-media; picture-in-picture';
    iframe.title='Kick Stream';
    wrap.innerHTML='';
    wrap.appendChild(iframe);
    wrap.dataset.loaded='1';
  }
  const kickBtn=document.getElementById('kickPlaceholder');
  if(kickBtn){
    kickBtn.addEventListener('click', loadKick);
    const obs=new IntersectionObserver((es,o)=>{
      es.forEach(e=>{ if(e.isIntersecting){ loadKick(); o.disconnect(); } });
    },{rootMargin:'200px'});
    obs.observe(kickBtn);
  }

  /* ===== Ensure all imgs lazy/async if not set ===== */
  document.querySelectorAll('img:not([loading])').forEach(img=>{ img.loading='lazy'; img.decoding='async'; });

  /* ===== Drawer + Prices (consolidated) ===== */
  (function(){
    const PAIR_ID = '4245415200000000000000000000000000000000.rbearguasyu7tuw53rufqzfdwmjhpjeqfw_xrp';
    const DS_URL = `https://api.dexscreener.com/latest/dex/pairs/xrpl/${PAIR_ID}`;

    /* FAB + drawer wiring */
    const fab=document.createElement('button');
    fab.className='fab-buy';
    fab.innerHTML='<span class="txt">BEAR HUB</span>';
    fab.setAttribute('aria-controls','buyDrawer');
    fab.setAttribute('aria-expanded','false');
    fab.setAttribute('aria-label','Open BEAR HUB panel');
    document.body.appendChild(fab);

    const scrim=document.createElement('div');
    scrim.className='drawer-scrim';
    scrim.hidden=true;
    document.body.appendChild(scrim);

    const drawer=document.getElementById('buyDrawer');
    const closeBtn=drawer.querySelector('[data-close-drawer]');

    function openDrawer(){
      drawer.classList.add('open'); scrim.hidden=false;
      fab.setAttribute('aria-expanded','true'); drawer.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
      loadPortfolioData(); // Load wallet portfolio data
    }
    function closeDrawer(){
      drawer.classList.remove('open'); scrim.hidden=true;
      fab.setAttribute('aria-expanded','false'); drawer.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
    }

    fab.addEventListener('click', openDrawer);
    closeBtn.addEventListener('click', closeDrawer);
    scrim.addEventListener('click', closeDrawer);
    window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeDrawer(); });

    const navBuy=document.querySelector('.nav-cta a[href="#network"]');
    if(navBuy){
      navBuy.addEventListener('click', (e)=>{ e.preventDefault(); openDrawer(); });
    }

    /* Build big duo metric lines (XRP first) */
    const priceCard = document.querySelector('.price-card');
    const metric = priceCard?.querySelector('.metric');
    const legacyUsdEl = document.getElementById('priceUsd');
    const volUsdEl = document.getElementById('vol24');
    const mcapUsdEl = document.getElementById('mcapUsd'); // NEW

    if (metric && !document.getElementById('bearXrpBig')) {
      metric.classList.add('duo');
      if (legacyUsdEl) legacyUsdEl.style.display='none';
      const usdSmall = legacyUsdEl && legacyUsdEl.nextElementSibling?.tagName==='SMALL' ? legacyUsdEl.nextElementSibling : null;
      if (usdSmall) usdSmall.style.display='none';

      const wrap=document.createElement('div');
      wrap.innerHTML =
        `<div class="line"><span class="label">$BEAR / XRP</span><span id="bearXrpBig" class="price">‚Äî</span></div>
         <div class="line"><span class="label">$BEAR / USD</span><span id="bearUsdBig" class="price">‚Äî</span></div>`;
      metric.prepend(wrap);

      const st=document.createElement('style');
      st.textContent=
        `.price-card .metric.duo{flex-direction:column;align-items:flex-start;gap:.4rem}
         .price-card .metric .line{display:flex;align-items:baseline;gap:.6rem;flex-wrap:wrap}
         .price-card .metric .label{color:var(--gold);font-weight:900;letter-spacing:.3px}
         .price-card .metric .price{color:#fff;font-weight:900}`;
      document.head.appendChild(st);
    }

    function $id(id){ return document.getElementById(id); }
    const fmt = (n, min=2, max=8) => Number(n).toLocaleString(undefined,{minimumFractionDigits:min, maximumFractionDigits:max});
    const fmt0 = (n) => Number(n).toLocaleString(undefined,{maximumFractionDigits:0});

    async function fetchDex(){
      const r=await fetch(DS_URL,{cache:'no-store'});
      if(!r.ok) throw new Error('Price API HTTP '+r.status);
      const j=await r.json();
      const p=j?.pairs?.[0];
      if(!p) throw new Error('Pair not found');
      return {
        priceNative: Number(p.priceNative),
        priceUsd: p.priceUsd!=null?Number(p.priceUsd):NaN,
        vol24Usd: Number(p.volume?.h24 ?? p.volume24h ?? 0),
        // NEW: Prefer marketCap; fallback to fdv
        mcapUsd: Number((p.marketCap ?? p.fdv) ?? NaN),
        // Add liquidity data
        liquidityUsd: Number(p.liquidity?.usd ?? 0),
        // Add 24h price change
        priceChange24h: Number(p.priceChange?.h24 ?? 0)
      };
    }

    // Fetch XRP/USD price
    async function fetchXrpPrice(){
      try {
        const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd', {cache:'no-store'});
        if (!r.ok) return 2.5; // fallback
        const j = await r.json();
        return Number(j?.ripple?.usd ?? 2.5);
      } catch {
        return 2.5; // fallback
      }
    }

    async function updatePrices(){
      try{
        const {priceNative, priceUsd, vol24Usd, mcapUsd, liquidityUsd, priceChange24h} = await fetchDex();
        const xrpPrice = await fetchXrpPrice();
        const xrpLine = $id('bearXrpBig');
        const usdLine = $id('bearUsdBig');

        if (Number.isFinite(priceNative) && xrpLine){
          const d = priceNative >= 1 ? {min:3,max:6} : {min:4,max:8};
          xrpLine.textContent = fmt(priceNative, d.min, d.max);
        }
        const usdVal = Number.isFinite(priceUsd) ? priceUsd : NaN;
        if (Number.isFinite(usdVal) && usdLine){
          usdLine.textContent = fmt(usdVal, 5, 8);
        }
        if (volUsdEl){
          const vol = Number.isFinite(vol24Usd) ? vol24Usd : NaN;
          if (Number.isFinite(vol)) volUsdEl.textContent = '$' + fmt0(vol);
        }
        // NEW: Market Cap update
        if (mcapUsdEl && Number.isFinite(mcapUsd)){
          mcapUsdEl.textContent = '$' + fmt0(mcapUsd);
        }

        if (legacyUsdEl && legacyUsdEl.textContent.trim()==='‚Äî' && Number.isFinite(usdVal)){
          legacyUsdEl.textContent = fmt(usdVal, 5, 8);
        }

        // Update Honey Points section
        updateHoneyPrices(priceNative, priceUsd, vol24Usd, mcapUsd, liquidityUsd, priceChange24h, xrpPrice);
      }catch(err){
        console.debug('Price update failed', err);
      }
    }

    function updateHoneyPrices(priceNative, priceUsd, vol24Usd, mcapUsd, liquidityUsd, priceChange24h, xrpPrice){
      // Update price stats
      const honeyPriceXrp = $id('honeyPriceXrp');
      const honeyPriceUsd = $id('honeyPriceUsd');
      const honeyVolume = $id('honeyVolume');
      const honeyMcap = $id('honeyMcap');
      const honeyChange24h = $id('honeyChange24h');
      const liquidityXrp = $id('liquidityXrp');
      const liquidityUsdEl = $id('liquidityUsd');

      if (honeyPriceXrp && Number.isFinite(priceNative)){
        const d = priceNative >= 1 ? {min:3,max:6} : {min:4,max:8};
        honeyPriceXrp.textContent = fmt(priceNative, d.min, d.max) + ' XRP';
      }

      if (honeyPriceUsd && Number.isFinite(priceUsd)){
        honeyPriceUsd.textContent = '$' + fmt(priceUsd, 5, 8);
      }

      if (honeyVolume && Number.isFinite(vol24Usd)){
        honeyVolume.textContent = '$' + fmt0(vol24Usd);
      }

      if (honeyMcap && Number.isFinite(mcapUsd)){
        honeyMcap.textContent = '$' + fmt0(mcapUsd);
      }

      // Update 24h change with color coding
      if (honeyChange24h && Number.isFinite(priceChange24h)){
        const sign = priceChange24h >= 0 ? '+' : '';
        honeyChange24h.textContent = sign + priceChange24h.toFixed(2) + '%';
        honeyChange24h.style.color = priceChange24h >= 0 ? '#4ade80' : '#f87171';
      }

      // Calculate liquidity values
      if (liquidityUsdEl && Number.isFinite(liquidityUsd)){
        liquidityUsdEl.textContent = '$' + fmt0(liquidityUsd);
      }

      // Calculate XRP liquidity using real XRP price
      if (liquidityXrp && Number.isFinite(liquidityUsd) && Number.isFinite(xrpPrice)){
        // Assume roughly half of liquidity is in XRP
        const xrpLiq = (liquidityUsd / 2) / xrpPrice;
        liquidityXrp.textContent = fmt0(xrpLiq) + ' XRP';
      }
    }
    updatePrices();
    setInterval(updatePrices, 60000);
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) updatePrices(); });

    /* ===== Chart Loading Detection ===== */
    const chartIframe = document.getElementById('dexscreener-embed');
    const chartError = document.getElementById('chart-error');

    if (chartIframe && chartError) {
      // Check if iframe loaded after 10 seconds
      setTimeout(() => {
        try {
          // Try to access iframe - if it fails, it might be blocked
          const iframeDoc = chartIframe.contentDocument || chartIframe.contentWindow.document;
          if (!iframeDoc || iframeDoc.readyState !== 'complete') {
            console.warn('Chart iframe may not have loaded properly');
          }
        } catch (e) {
          // CORS error is expected and means it's loading from external source (good)
          // Do nothing - this is normal for cross-origin iframes
        }
      }, 10000);

      // Handle iframe errors
      chartIframe.onerror = () => {
        console.error('Chart iframe failed to load');
        chartIframe.style.display = 'none';
        chartError.style.display = 'flex';
      };
    }

    /* ===== Portfolio & Points Functions ===== */
    async function loadPortfolioData() {
      const walletAddress = sessionStorage.getItem('bearpark_wallet');
      const isAuthenticated = sessionStorage.getItem('bearpark_auth') === 'true';

      const portfolioSection = document.getElementById('portfolioSection');
      const connectedWalletAddress = document.getElementById('connectedWalletAddress');

      if (!isAuthenticated || !walletAddress) {
        portfolioSection.style.display = 'none';
        return;
      }

      // Show portfolio section
      portfolioSection.style.display = 'block';
      connectedWalletAddress.textContent = walletAddress;

      // Check if xrpl library is loaded
      if (typeof xrpl === 'undefined') {
        console.error('[Portfolio] XRPL library not loaded!');
        document.getElementById('portfolioBearAmount').textContent = 'Error: Library not loaded';
        return;
      }

      try {
        // Set loading states
        document.getElementById('portfolioBearAmount').textContent = 'Loading...';
        document.getElementById('portfolioUsdValue').textContent = 'Loading...';
        document.getElementById('portfolioXrpValue').textContent = 'Loading...';

        // Connect to XRPL with fallback nodes
        const xrplNodes = [
          'wss://xrplcluster.com',
          'wss://s1.ripple.com',
          'wss://s2.ripple.com'
        ];

        let client = null;
        let lastError = null;

        for (const node of xrplNodes) {
          try {
            client = new xrpl.Client(node);
            await client.connect();
            break;
          } catch (err) {
            lastError = err;
            if (client) {
              try { await client.disconnect(); } catch(e) {}
            }
            client = null;
          }
        }

        if (!client) {
          console.error('[Portfolio] Unable to connect to any XRPL node');
          throw new Error('Unable to connect to XRPL nodes');
        }

        // Get $BEAR balance
        const accountLines = await client.request({
          command: 'account_lines',
          account: walletAddress,
          ledger_index: 'validated'
        });

        const BEAR_ISSUER = 'rBEARGUAsyu7tUw53rufQzFdWmJHpJEqFW';
        const BEAR_CURRENCY = 'BEAR';
        const BEAR_CURRENCY_HEX = '4245415200000000000000000000000000000000'; // "BEAR" in hex

        const bearLine = accountLines.result.lines.find(line =>
          line.account === BEAR_ISSUER &&
          (line.currency === BEAR_CURRENCY || line.currency === BEAR_CURRENCY_HEX)
        );

        const bearBalance = bearLine ? parseFloat(bearLine.balance) : 0;

        // Update BEAR amount immediately
        document.getElementById('portfolioBearAmount').textContent = bearBalance.toLocaleString('en-US', { maximumFractionDigits: 2 });

        // Fetch fresh price data from API
        try {
          const {priceNative, priceUsd} = await fetchDex();

          // Calculate values
          const usdValue = bearBalance * priceUsd;
          const xrpValue = bearBalance * priceNative;

          // Update UI with calculated values
          if (priceUsd > 0) {
            document.getElementById('portfolioUsdValue').textContent = '$' + usdValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
          } else {
            document.getElementById('portfolioUsdValue').textContent = 'Loading...';
          }

          if (priceNative > 0) {
            document.getElementById('portfolioXrpValue').textContent = xrpValue.toLocaleString('en-US', { maximumFractionDigits: 4 }) + ' XRP';
          } else {
            document.getElementById('portfolioXrpValue').textContent = 'Loading...';
          }
        } catch (priceErr) {
          console.error('[Portfolio] Error fetching prices:', priceErr);
          document.getElementById('portfolioUsdValue').textContent = 'N/A';
          document.getElementById('portfolioXrpValue').textContent = 'N/A';
        }

        await client.disconnect();

      } catch (err) {
        console.error('[Portfolio] ERROR loading portfolio:', err);
        console.error('[Portfolio] Error stack:', err.stack);
        document.getElementById('portfolioBearAmount').textContent = 'Error: ' + err.message;
        document.getElementById('portfolioUsdValue').textContent = 'Error';
        document.getElementById('portfolioXrpValue').textContent = 'Error';
      }

      // Load points data (will be implemented with backend)
      loadPointsData(walletAddress);
    }

    async function loadPointsData(walletAddress) {
      try {
        const response = await fetch(`/api/points/${walletAddress}`);
        if (!response.ok) {
          console.debug('Points API not available');
          return;
        }
        const data = await response.json();

        if (data.twitter_connected) {
          // Show connected state
          document.getElementById('pointsConnected').style.display = 'block';
          document.getElementById('pointsNotConnected').style.display = 'none';
          document.getElementById('totalPoints').textContent = data.total_points;
          document.getElementById('connectedTwitter').textContent = data.twitter_username;

          // SYNC TO LOCALSTORAGE FOR GAME INTEGRATION
          if (data.twitter_username) {
            localStorage.setItem('twitter_username', data.twitter_username);
          }

          // Load activity
          const activityList = document.getElementById('activityList');
          if (data.recent_activity && data.recent_activity.length > 0) {
            activityList.innerHTML = data.recent_activity.map(activity => {
              const date = new Date(activity.created_at);
              const timeAgo = getTimeAgo(date);
              const points = activity.points_change > 0 ? `+${activity.points_change}` : activity.points_change;
              return `
                <div style="display:flex; justify-content:space-between; padding:8px; background:rgba(255,255,255,0.05); border-radius:6px; margin-bottom:6px;">
                  <span style="font-size:12px;">${activity.description || activity.transaction_type}</span>
                  <span style="color:var(--gold); font-weight:900; font-size:12px;">${points} pts</span>
                </div>
              `;
            }).join('');
          } else {
            activityList.innerHTML = '<div style="opacity:0.6; padding:12px; text-align:center;">No recent activity</div>';
          }

          // Load active raids
          loadActiveRaids();
        } else {
          // Show not connected state
          document.getElementById('pointsConnected').style.display = 'none';
          document.getElementById('pointsNotConnected').style.display = 'block';
        }
      } catch (err) {
        console.error('Error loading points:', err);
        // Show not connected state on error
        document.getElementById('pointsConnected').style.display = 'none';
        document.getElementById('pointsNotConnected').style.display = 'block';
      }
    }

    async function loadActiveRaids() {
      try {
        const response = await fetch('/api/raids/active');
        const data = await response.json();

        const activeRaidsSection = document.getElementById('activeRaids');
        const raidInfo = document.getElementById('raidInfo');
        const viewRaidBtn = document.getElementById('viewRaidBtn');

        if (data.success && data.raids && data.raids.length > 0) {
          const raid = data.raids[0]; // Show first active raid
          activeRaidsSection.style.display = 'block';

          raidInfo.innerHTML = `
            <div style="font-weight:900; margin-bottom:4px;">${raid.raid_title}</div>
            <div style="opacity:0.8; font-size:12px;">Target: ${raid.target_account}</div>
            <div style="opacity:0.8; font-size:12px;">Reward: ${raid.points_per_participation} points</div>
          `;

          viewRaidBtn.onclick = () => {
            window.open(raid.raid_url, '_blank');
          };
        } else {
          activeRaidsSection.style.display = 'none';
        }
      } catch (err) {
        console.error('Error loading raids:', err);
        document.getElementById('activeRaids').style.display = 'none';
      }
    }

    /* ===== Honey Points Section Functions ===== */
    async function loadHoneyPoints() {
      const walletAddress = sessionStorage.getItem('bearpark_wallet');
      const isAuthenticated = sessionStorage.getItem('bearpark_auth') === 'true';
      const myPointsAuth = document.getElementById('myPointsAuth');
      const myPointsGuest = document.getElementById('myPointsGuest');

      if (!isAuthenticated || !walletAddress) {
        // Show guest state
        if (myPointsAuth) myPointsAuth.style.display = 'none';
        if (myPointsGuest) myPointsGuest.style.display = 'block';
        return;
      }

      // Try to load points data
      try {
        const response = await fetch(`/api/points/${walletAddress}`);
        if (!response.ok) {
          console.debug('Points API not available');
          if (myPointsAuth) myPointsAuth.style.display = 'none';
          if (myPointsGuest) myPointsGuest.style.display = 'block';
          return;
        }
        const data = await response.json();

        if (data.twitter_connected) {
          // Show authenticated state
          myPointsAuth.style.display = 'block';
          myPointsGuest.style.display = 'none';

          // Update points display
          document.getElementById('myHoneyPoints').textContent = data.total_points.toLocaleString();
          document.getElementById('myTwitterHandle').textContent = '@' + data.twitter_username;

          // SYNC TO LOCALSTORAGE FOR GAME INTEGRATION
          if (data.twitter_username) {
            localStorage.setItem('twitter_username', data.twitter_username);
          }

          // Load leaderboard to get rank
          loadHoneyLeaderboard(walletAddress);
        } else {
          // Not connected to Twitter
          myPointsAuth.style.display = 'none';
          myPointsGuest.style.display = 'block';
        }
      } catch (err) {
        console.error('Error loading honey points:', err);
        // Show guest state on error
        myPointsAuth.style.display = 'none';
        myPointsGuest.style.display = 'block';
      }
    }

    async function loadHoneyLeaderboard(currentWallet = null) {
      const leaderboardEl = document.getElementById('honeyLeaderboard');
      if (!leaderboardEl) return;

      try {
        const response = await fetch('/api/leaderboard?limit=15');
        if (!response.ok) {
          console.debug('Leaderboard API not available');
          leaderboardEl.innerHTML = '<div class="leaderboard-empty">Leaderboard coming soon!</div>';
          return;
        }
        const data = await response.json();

        if (data.success && data.leaderboard && data.leaderboard.length > 0) {
          leaderboardEl.innerHTML = data.leaderboard.map((entry, index) => {
            const rank = index + 1;
            const isCurrentUser = currentWallet && entry.wallet_address === currentWallet;
            const rankClass = rank <= 3 ? `rank-${rank}` : '';
            const trophy = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : rank;

            // Update current user's rank if found
            if (isCurrentUser) {
              const myRankEl = document.getElementById('myRank');
              if (myRankEl) myRankEl.textContent = `#${rank}`;
            }

            // Use username fallback logic: display_name ‚Üí twitter_username ‚Üí formatted wallet
            let displayName = 'Anonymous';
            if (entry.display_name) {
              displayName = entry.display_name;
            } else if (entry.twitter_username) {
              displayName = entry.twitter_username;
            } else if (entry.wallet_address) {
              displayName = entry.wallet_address.substring(0, 4) + '...' + entry.wallet_address.substring(entry.wallet_address.length - 4);
            }

            // Show avatar if available
            const avatarHTML = entry.avatar_nft
              ? `<img src="https://nft.xrpl-labs.com/${entry.avatar_nft}"
                     style="width:40px; height:40px; border-radius:50%; border:2px solid var(--gold); object-fit:cover; margin-right:8px;"
                     alt="${displayName} avatar">`
              : '';

            return `
              <div class="leaderboard-item ${rankClass}" style="display:flex; align-items:center; gap:12px;">
                <div class="leaderboard-rank ${rank <= 3 ? 'top-3' : ''}">${trophy}</div>
                ${avatarHTML}
                <div class="leaderboard-user" style="flex:1; min-width:0;">
                  <div class="leaderboard-username">${displayName}</div>
                  <div class="leaderboard-wallet">${entry.wallet_address.substring(0, 8)}...${entry.wallet_address.substring(entry.wallet_address.length - 6)}</div>
                </div>
                <div class="leaderboard-points">${entry.total_points.toLocaleString()} üçØ</div>
              </div>
            `;
          }).join('');
        } else {
          leaderboardEl.innerHTML = '<div class="leaderboard-loading">No leaderboard data yet. Start playing to earn points!</div>';
        }
      } catch (err) {
        console.error('Error loading leaderboard:', err);
        leaderboardEl.innerHTML = '<div class="leaderboard-loading">Failed to load leaderboard</div>';
      }
    }

    // SYNC WALLET DATA TO LOCALSTORAGE FOR GAME INTEGRATION
    function syncWalletToLocalStorage() {
      const walletAddress = sessionStorage.getItem('bearpark_wallet');
      const isAuthenticated = sessionStorage.getItem('bearpark_auth') === 'true';

      if (isAuthenticated && walletAddress) {
        // Sync wallet address to localStorage for games
        localStorage.setItem('xaman_wallet_address', walletAddress);
        console.log('‚úÖ Synced wallet address to localStorage for game integration');
      }
    }

    // Sync wallet data on page load
    syncWalletToLocalStorage();

    // Function to open game with authentication data in URL
    window.openGameWithAuth = function(event, baseUrl) {
      const walletAddress = sessionStorage.getItem('bearpark_wallet');
      const isAuthenticated = sessionStorage.getItem('bearpark_auth') === 'true';

      if (isAuthenticated && walletAddress) {
        event.preventDefault();

        // Get user data from localStorage
        const displayName = localStorage.getItem('display_name') || '';
        const twitterUsername = localStorage.getItem('twitter_username') || '';

        // Build URL with parameters
        const params = new URLSearchParams();
        params.set('wallet', walletAddress);
        if (displayName) params.set('display_name', displayName);
        if (twitterUsername) params.set('twitter_username', twitterUsername);

        const gameUrl = `${baseUrl}?${params.toString()}`;
        window.open(gameUrl, '_blank', 'noopener,noreferrer');
        return false;
      }

      // If not authenticated, let the default link work
      return true;
    };

    // Initialize honey points section
    loadHoneyPoints();
    loadHoneyLeaderboard();

    // Refresh leaderboard every 30 seconds
    setInterval(() => {
      const walletAddress = sessionStorage.getItem('bearpark_wallet');
      loadHoneyLeaderboard(walletAddress);
    }, 30000);

    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      if (seconds < 60) return 'just now';
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return `${minutes}m ago`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours}h ago`;
      const days = Math.floor(hours / 24);
      return `${days}d ago`;
    }

    // Function to connect Twitter
    async function connectTwitter() {
      const walletAddress = sessionStorage.getItem('bearpark_wallet');
      if (!walletAddress) {
        alert('Please connect your wallet first!');
        return;
      }

      try {
        // Get Twitter OAuth URL from backend
        const response = await fetch(`/api/auth/twitter?wallet_address=${walletAddress}`);
        const data = await response.json();

        if (data.success && data.auth_url) {
          // Redirect to Twitter OAuth
          window.location.href = data.auth_url;
        } else {
          alert('Failed to start Twitter authentication. Please try again.');
        }
      } catch (error) {
        console.error('Error connecting Twitter:', error);
        alert('Failed to connect Twitter. Please try again.');
      }
    }

    // Wire up Twitter connect buttons (both in drawer and main page)
    document.getElementById('connectTwitterBtn')?.addEventListener('click', connectTwitter);
    document.getElementById('connectTwitterBtnMain')?.addEventListener('click', connectTwitter);

    // Wire up Twitter disconnect button
    document.getElementById('disconnectTwitterBtn')?.addEventListener('click', async () => {
      const walletAddress = sessionStorage.getItem('bearpark_wallet');
      if (!walletAddress) return;

      if (!confirm('Are you sure you want to disconnect your Twitter account? Your points will be saved.')) {
        return;
      }

      try {
        const response = await fetch('/api/auth/twitter', {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ wallet_address: walletAddress })
        });

        const data = await response.json();

        if (data.success) {
          alert(data.message);
          // Refresh the points/portfolio section to show disconnected state
          loadPortfolioData();
          loadHoneyPoints();
        } else {
          alert('Failed to disconnect Twitter: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        console.error('Error disconnecting Twitter:', error);
        alert('Failed to disconnect Twitter. Please try again.');
      }
    });

    /* ===== NFT & Profile Management ===== */
    const PIXEL_BEARS_ISSUER = 'rBEARbo4Prn33894evmvYcAf9yAQjp4VJF';
    const PIXEL_BEARS_TAXON = 1;
    const ULTRA_RARES_ISSUER = 'rBEARbo4Prn33894evmvYcAf9yAQjp4VJF';
    const ULTRA_RARES_TAXON = 2;

    // API Configuration - Change this for production
    // For local development: 'http://localhost:3000'
    // For production: '' (empty string uses same domain)
    const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
      ? 'http://localhost:3000'
      : '';

    let currentNFTs = [];
    let selectedAvatarNFT = null;
    let nftImageCache = {}; // Store NFT images and metadata

    // Helper function to convert hex string to regular string
    function hexToString(hex) {
      const hexString = hex.startsWith('0x') ? hex.slice(2) : hex;
      let str = '';
      for (let i = 0; i < hexString.length; i += 2) {
        const charCode = parseInt(hexString.substr(i, 2), 16);
        if (charCode) str += String.fromCharCode(charCode);
      }
      return str;
    }

    // Show profile and NFT sections when authenticated
    async function initializeProfileAndNFTs() {
      const walletAddress = sessionStorage.getItem('bearpark_wallet');
      const isAuthenticated = sessionStorage.getItem('bearpark_auth') === 'true';

      if (!isAuthenticated || !walletAddress) {
        document.getElementById('profileSection').style.display = 'none';
        document.getElementById('nftSection').style.display = 'none';
        return;
      }

      // Show sections
      document.getElementById('profileSection').style.display = 'block';
      document.getElementById('nftSection').style.display = 'block';

      // Load existing profile data
      try {
        const response = await fetch(`${API_BASE_URL}/api/profile/${walletAddress}`);
        if (!response.ok) {
          console.debug('Profile API not available');
          return;
        }
        const data = await response.json();

        if (data.success && data.profile) {
          document.getElementById('profileUsername').value = data.profile.display_name || '';
          if (data.profile.avatar_nft) {
            selectedAvatarNFT = data.profile.avatar_nft;
            document.getElementById('profileAvatarNFT').value = data.profile.avatar_nft;
            // Display selected avatar
            displaySelectedAvatar(data.profile.avatar_nft);
          }
        }
      } catch (err) {
        console.error('Error loading profile:', err);
      }
    }

    function displaySelectedAvatar(nftIdOrData) {
      const selector = document.getElementById('profileAvatarSelector');
      let imageData;

      // Handle both NFT ID string and JSON avatar data
      if (typeof nftIdOrData === 'string') {
        // Try to parse as JSON first (from database)
        try {
          imageData = JSON.parse(nftIdOrData);
        } catch (e) {
          // If not JSON, it's an NFT ID - look it up in cache
          imageData = nftImageCache[nftIdOrData];
        }
      } else {
        // Already an object
        imageData = nftIdOrData;
      }

      if (imageData && imageData.imageUrl) {
        // Build fallback chain: animated -> fallback image -> error placeholder
        const fallbackSrc = imageData.fallbackImageUrl || 'data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27100%27 height=%27100%27%3E%3Crect fill=%27%23333%27 width=%27100%27 height=%27100%27/%3E%3Ctext fill=%27%23edb723%27 x=%2750%25%27 y=%2750%25%27 text-anchor=%27middle%27 dy=%27.3em%27%3ENFT%3C/text%3E%3C/svg%3E';

        // Use img element for all content types
        // Browsers handle GIFs natively, and can show video thumbnails
        selector.innerHTML = `
          <img src="${imageData.imageUrl}"
               style="width:100%; max-width:120px; border-radius:8px; border:2px solid var(--gold);"
               alt="Selected avatar"
               crossorigin="anonymous"
               onerror="if(this.src!=='${fallbackSrc.replace(/'/g, "\\'")}'){console.log('[Avatar] Trying fallback image');this.src='${fallbackSrc.replace(/'/g, "\\'")}';}">
        `;
      } else {
        selector.innerHTML = `
          <div style="width:100%; max-width:120px; aspect-ratio:1; background:rgba(237,183,35,0.1); border-radius:8px; border:2px solid var(--gold); display:flex; align-items:center; justify-content:center; color:var(--gold);">
            Loading...
          </div>
        `;
      }
    }

    // Load NFTs from wallet
    async function loadNFTs(taxon, type) {
      const walletAddress = sessionStorage.getItem('bearpark_wallet');
      if (!walletAddress) return;

      const nftLoading = document.getElementById('nftLoading');
      const nftGrid = document.getElementById('nftGrid');
      const nftEmpty = document.getElementById('nftEmpty');
      const nftGridContent = document.getElementById('nftGridContent');

      // Show loading
      nftLoading.style.display = 'block';
      nftGrid.style.display = 'none';
      nftEmpty.style.display = 'none';

      try {
        // Connect to XRPL
        if (typeof xrpl === 'undefined') {
          console.error('XRPL library not loaded');
          alert('Error: XRPL library not loaded');
          nftLoading.style.display = 'none';
          return;
        }

        const client = new xrpl.Client('wss://xrplcluster.com');
        await client.connect();

        // Get ALL account NFTs with pagination
        let allNFTs = [];
        let marker = undefined;
        let pageCount = 0;
        const maxPages = 20; // Safety limit

        console.log('[NFT] Fetching all NFTs from wallet (with pagination)...');

        do {
          const nftRequest = {
            command: 'account_nfts',
            account: walletAddress,
            ledger_index: 'validated',
            limit: 400 // Maximum per page
          };

          if (marker) {
            nftRequest.marker = marker;
          }

          const nfts = await client.request(nftRequest);

          if (nfts.result.account_nfts && nfts.result.account_nfts.length > 0) {
            allNFTs = allNFTs.concat(nfts.result.account_nfts);
            console.log(`[NFT] Page ${pageCount + 1}: Found ${nfts.result.account_nfts.length} NFTs`);
          }

          marker = nfts.result.marker;
          pageCount++;

        } while (marker && pageCount < maxPages);

        console.log(`[NFT] Total NFTs found across ${pageCount} page(s):`, allNFTs.length);

        // Log each NFT for debugging
        allNFTs.forEach((nft, i) => {
          const nftTaxon = parseInt(nft.NFTokenID.substring(48, 56), 16);
          console.log(`[NFT ${i}] Issuer:`, nft.Issuer, 'Taxon:', nftTaxon, 'ID:', nft.NFTokenID);
        });

        // Filter NFTs by issuer AND URI pattern
        const targetIssuer = 'rBEARbo4Prn33894evmvYcAf9yAQjp4VJF';
        const filteredNFTs = allNFTs.filter(nft => {
          const issuerMatch = nft.Issuer === targetIssuer;
          if (!issuerMatch) return false;

          // Check URI to distinguish Pixel Bears from Ultra Rares
          if (nft.URI) {
            const uriString = hexToString(nft.URI);
            const isPixelBear = uriString.includes('Pixel BEAR') || uriString.includes('Pixel%20BEAR');

            // If looking for Pixel Bears (taxon 1), include Pixel Bears
            // If looking for Ultra Rares (taxon 2), exclude Pixel Bears
            const typeMatch = (taxon === PIXEL_BEARS_TAXON) ? isPixelBear : !isPixelBear;

            console.log('[NFT Filter]', nft.NFTokenID, 'Issuer:', issuerMatch, 'Type:', isPixelBear ? 'Pixel BEAR' : 'Ultra Rare', 'Match:', typeMatch);
            return typeMatch;
          }

          return false;
        });

        console.log('[NFT] Filtered NFTs:', filteredNFTs.length);

        currentNFTs = filteredNFTs;

        if (filteredNFTs.length === 0) {
          nftLoading.style.display = 'none';
          nftEmpty.style.display = 'block';
          nftEmpty.textContent = `No ${type} found in your wallet. Total NFTs: ${allNFTs.length}`;
          return;
        }

        // Display NFTs with loading placeholders
        nftGridContent.innerHTML = filteredNFTs.map(nft => `
          <div class="nft-item" data-nft-id="${nft.NFTokenID}"
               style="position:relative; border-radius:12px; overflow:hidden; border:3px solid rgba(237,183,35,0.3); background:linear-gradient(135deg, rgba(0,0,0,0.8), rgba(20,20,20,0.9)); transition:all 0.3s ease; box-shadow:0 4px 15px rgba(0,0,0,0.5);"
               onmouseover="this.style.transform='translateY(-5px) scale(1.02)'; this.style.borderColor='var(--gold)'; this.style.boxShadow='0 8px 25px rgba(237,183,35,0.4)';"
               onmouseout="this.style.transform=''; this.style.borderColor='rgba(237,183,35,0.3)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.5)';">
            <div style="width:100%; aspect-ratio:1; position:relative; background:rgba(237,183,35,0.05);">
              <img src="" data-nft-id="${nft.NFTokenID}" class="nft-image-loading"
                   style="width:100%; height:100%; display:block; object-fit:contain; image-rendering:pixelated;"
                   loading="lazy"
                   alt="${type} NFT">
              <a href="https://xrp.cafe/nft/${nft.NFTokenID}" target="_blank" rel="noopener noreferrer"
                 style="position:absolute; top:8px; left:8px; width:32px; height:32px; border-radius:50%; background:#fff; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 8px rgba(0,0,0,0.3); transition:all 0.2s; z-index:10; border:3px solid transparent; background-image: linear-gradient(#fff, #fff), var(--tri-gradient); background-origin: padding-box, border-box; background-clip: padding-box, border-box;"
                 onmouseover="this.style.transform='scale(1.15)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.5)';"
                 onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.3)';"
                 title="View on XRP.cafe">
                <img src="https://avatars.githubusercontent.com/u/109316848?s=280&v=4"
                     alt="XRP.cafe"
                     style="width:20px; height:20px; border-radius:50%; object-fit:cover;">
              </a>
              <div class="loading-overlay" data-nft-id="${nft.NFTokenID}" style="position:absolute; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; color:var(--gold); font-size:14px; font-weight:900; backdrop-filter:blur(4px);">
                Loading...
              </div>
            </div>
            <div class="nft-info" data-nft-id="${nft.NFTokenID}" style="padding:12px; background:rgba(0,0,0,0.6); backdrop-filter:blur(10px); display:none;">
              <div style="text-align:center; margin-bottom:8px;">
                <div style="color:var(--gold); font-weight:900; font-size:14px; margin-bottom:4px;">Loading...</div>
                <div style="color:rgba(255,255,255,0.7); font-size:11px;">Please wait...</div>
              </div>
            </div>
            <div style="padding:8px; background:rgba(0,0,0,0.8); backdrop-filter:blur(10px);">
              <button class="nft-select-btn" data-nft-id="${nft.NFTokenID}"
                      style="font-size:12px; padding:10px; background:var(--gold); color:#000; border:none; border-radius:8px; font-weight:900; cursor:pointer; width:100%; transition:all 0.2s; text-transform:uppercase; letter-spacing:1px;"
                      onmouseover="this.style.background='#ffca3a'; this.style.transform='scale(1.05)';"
                      onmouseout="this.style.background='var(--gold)'; this.style.transform='scale(1)';">
                Select Avatar
              </button>
              <button class="nft-save-btn" data-nft-id="${nft.NFTokenID}"
                      style="font-size:11px; padding:8px; background:var(--accent); color:#fff; border:none; border-radius:8px; font-weight:900; cursor:pointer; margin-top:6px; width:100%; transition:all 0.2s; text-transform:uppercase; letter-spacing:0.5px;"
                      onmouseover="this.style.background='#ff6b6b'; this.style.transform='scale(1.05)';"
                      onmouseout="this.style.background='var(--accent)'; this.style.transform='scale(1)';">
                Save Image
              </button>
            </div>
          </div>
        `).join('');

        // Disconnect client - we have all the data we need
        await client.disconnect();
        console.log('[NFT] Client disconnected');

        // Load NFT images from metadata JSON files
        const imageLoadPromises = filteredNFTs.map(async (nft) => {
          try {
            // Check if NFT has a URI field (hex-encoded)
            if (!nft.URI) {
              console.log('[NFT Image] No URI found for', nft.NFTokenID);
              return;
            }

            // Convert hex URI to string
            const uriString = hexToString(nft.URI);
            console.log('[NFT Image] NFT:', nft.NFTokenID, 'URI:', uriString);

            // Convert IPFS URI to HTTP gateway URL
            let metadataUrl = '';
            if (uriString.startsWith('ipfs://')) {
              const ipfsPath = uriString.replace('ipfs://', '');
              // Split path and encode each component to handle spaces and special chars
              const pathParts = ipfsPath.split('/');
              const encodedPath = pathParts.map(part => encodeURIComponent(part)).join('/');
              metadataUrl = `https://ipfs.io/ipfs/${encodedPath}`;
            } else if (uriString.startsWith('http')) {
              metadataUrl = uriString;
            } else if (uriString.length > 0) {
              // Might be just the IPFS hash without prefix
              const pathParts = uriString.split('/');
              const encodedPath = pathParts.map(part => encodeURIComponent(part)).join('/');
              metadataUrl = `https://ipfs.io/ipfs/${encodedPath}`;
            }

            if (!metadataUrl) {
              console.log('[NFT Image] Could not construct metadata URL for', nft.NFTokenID);
              return;
            }

            // Fetch the metadata JSON
            console.log('[NFT Image] Fetching metadata from:', metadataUrl);
            const metadataResponse = await fetch(metadataUrl);

            if (!metadataResponse.ok) {
              throw new Error(`Failed to fetch metadata: ${metadataResponse.status} ${metadataResponse.statusText}`);
            }

            const metadata = await metadataResponse.json();

            if (!metadata) {
              throw new Error('Metadata is empty or invalid');
            }

            // Extract image URL from metadata (check image, animation, or image_url fields)
            // Ultra Rare Bears use the "animation" field for their animated images
            // Store both animation and static image if available for fallback
            const isAnimated = !!metadata.animation;
            let imageUrl = metadata.animation || metadata.image || metadata.image_url || '';
            let fallbackImageUrl = null;

            // If there's an animation, also get the static image as fallback
            if (metadata.animation && metadata.image) {
              fallbackImageUrl = metadata.image;
            }

            // Helper to convert IPFS URL to HTTP gateway
            const convertIpfsUrl = (url) => {
              if (url && url.startsWith('ipfs://')) {
                const ipfsPath = url.replace('ipfs://', '');
                const pathParts = ipfsPath.split('/');
                const encodedPath = pathParts.map(part => encodeURIComponent(part)).join('/');
                return `https://ipfs.io/ipfs/${encodedPath}`;
              }
              return url;
            };

            imageUrl = convertIpfsUrl(imageUrl);
            fallbackImageUrl = convertIpfsUrl(fallbackImageUrl);

            console.log('[NFT Image]', isAnimated ? 'Animation' : 'Image', 'URL for', nft.NFTokenID, ':', imageUrl);
            if (fallbackImageUrl) {
              console.log('[NFT Image] Fallback URL:', fallbackImageUrl);
            }

            // Extract BEAR number and rarity from metadata
            const bearName = metadata.name || 'Unknown BEAR';

            // Extract bear number from name (e.g., "BEAR #36" -> 36)
            const bearNumberMatch = bearName.match(/#(\d+)/);
            const bearNumber = bearNumberMatch ? parseInt(bearNumberMatch[1]) : null;

            // Hardcoded rarity mapping for Ultra Rare Bears
            // This data is not stored in the NFT metadata
            const ultraRareRarityMap = {
              9: 10,
              12: 12,
              14: 14,
              18: 18,
              36: 37,
              451: 273
            };

            let rarityNumber = '';
            if (bearNumber && ultraRareRarityMap[bearNumber]) {
              rarityNumber = `#${ultraRareRarityMap[bearNumber]}`;
              console.log('[NFT Image] Mapped rarity for', bearName, ':', rarityNumber);
            } else {
              console.log('[NFT Image] No rarity mapping found for', bearName);
              rarityNumber = '';
            }

            console.log('[NFT Image] Extracted:', bearName, 'Rarity:', rarityNumber);

            // Store in cache
            nftImageCache[nft.NFTokenID] = {
              imageUrl,
              fallbackImageUrl,
              metadata,
              bearName,
              rarityNumber,
              isAnimated
            };

            // Update media element (use img for all content types for reliability)
            const imgElement = document.querySelector(`img.nft-image-loading[data-nft-id="${nft.NFTokenID}"]`);
            if (imgElement && imageUrl) {
              // Set up error handler to try fallback image if animated content fails
              if (fallbackImageUrl && isAnimated) {
                imgElement.onerror = function() {
                  if (this.src !== fallbackImageUrl) {
                    console.log('[NFT Image] Animated content failed, trying static fallback for', nft.NFTokenID);
                    this.src = fallbackImageUrl;
                  }
                };
              }

              imgElement.src = imageUrl;
              imgElement.classList.remove('nft-image-loading');
              console.log('[NFT Image] Successfully set image URL:', imageUrl);

              // Remove loading overlay
              const loadingOverlay = document.querySelector(`.loading-overlay[data-nft-id="${nft.NFTokenID}"]`);
              if (loadingOverlay) {
                loadingOverlay.remove();
              }

              // Update NFT info section
              const infoSection = document.querySelector(`.nft-info[data-nft-id="${nft.NFTokenID}"]`);
              if (infoSection) {
                infoSection.style.display = 'block';
                infoSection.innerHTML = `
                  <div style="text-align:center; margin-bottom:0;">
                    <div style="color:var(--gold); font-weight:900; font-size:14px; margin-bottom:2px; text-shadow:0 2px 4px rgba(0,0,0,0.5);">${bearName}</div>
                    <div style="color:rgba(255,255,255,0.8); font-size:12px; font-weight:700;">Rarity ${rarityNumber}</div>
                  </div>
                `;
              }
            }
          } catch (err) {
            console.error('[NFT Image] Failed to load image for', nft.NFTokenID, err);
            // Show error state
            const loadingOverlay = document.querySelector(`.loading-overlay[data-nft-id="${nft.NFTokenID}"]`);
            if (loadingOverlay) {
              loadingOverlay.innerHTML = '<div style="text-align:center;"><div style="font-size:20px; margin-bottom:4px;">‚ö†Ô∏è</div><div>Failed to load</div></div>';
            }
          }
        });

        // Wait for all images to load
        await Promise.all(imageLoadPromises);
        console.log('[NFT] All images loaded');

        // Wire up NFT buttons
        document.querySelectorAll('.nft-select-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const nftId = btn.getAttribute('data-nft-id');
            selectNFTAsAvatar(nftId);
          });
        });

        document.querySelectorAll('.nft-save-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const nftId = btn.getAttribute('data-nft-id');
            saveNFTImage(nftId);
          });
        });

        nftLoading.style.display = 'none';
        nftGrid.style.display = 'block';

        // Auto-scroll to NFT grid after loading
        setTimeout(() => {
          nftGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);

      } catch (err) {
        console.error('Error loading NFTs:', err);
        nftLoading.style.display = 'none';
        nftEmpty.style.display = 'block';
        nftEmpty.textContent = 'Failed to load NFTs. Please try again.';
      }
    }

    function selectNFTAsAvatar(nftId) {
      selectedAvatarNFT = nftId;
      document.getElementById('profileAvatarNFT').value = nftId;
      displaySelectedAvatar(nftId);
      // Scroll to top of drawer to see avatar
      document.querySelector('#buyDrawer .drawer-body').scrollTop = 0;
    }

    function saveNFTImage(nftId) {
      const imageData = nftImageCache[nftId];
      if (imageData && imageData.imageUrl) {
        const link = document.createElement('a');
        link.href = imageData.imageUrl;
        link.download = `${imageData.bearName || 'BEAR-NFT'}-${nftId.substring(0, 8)}.png`;
        link.target = '_blank';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } else {
        alert('Image not yet loaded. Please wait a moment and try again.');
      }
    }

    // Save profile
    document.getElementById('saveProfileBtn')?.addEventListener('click', async () => {
      const walletAddress = sessionStorage.getItem('bearpark_wallet');
      if (!walletAddress) return;

      const username = document.getElementById('profileUsername').value.trim();
      const avatarNFT = document.getElementById('profileAvatarNFT').value;

      if (!username) {
        alert('Please enter a display name');
        return;
      }

      // Get the full image data from cache
      let avatarData = null;
      if (avatarNFT && nftImageCache[avatarNFT]) {
        // Store the full image data as JSON
        avatarData = JSON.stringify({
          nftId: avatarNFT,
          imageUrl: nftImageCache[avatarNFT].imageUrl,
          fallbackImageUrl: nftImageCache[avatarNFT].fallbackImageUrl,
          bearName: nftImageCache[avatarNFT].bearName,
          isAnimated: nftImageCache[avatarNFT].isAnimated
        });
      }

      try {
        const response = await fetch(`${API_BASE_URL}/api/profile`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            wallet_address: walletAddress,
            display_name: username,
            avatar_nft: avatarData
          })
        });

        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          console.error('Profile save API error:', errorData);
          alert('Failed to save profile. Make sure the server is running (node server.js)');
          return;
        }

        const data = await response.json();

        if (data.success) {
          alert('Profile saved successfully! Your custom username and avatar will appear on the leaderboard.');

          // SYNC TO LOCALSTORAGE FOR GAME INTEGRATION
          localStorage.setItem('display_name', username);

          // Refresh leaderboard to show new profile
          loadHoneyLeaderboard(walletAddress);
          // Update top navigation avatar
          updateWelcomeButton();
        } else {
          alert('Failed to save profile: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        console.error('Error saving profile:', error);
        alert('Failed to save profile. Please try again.');
      }
    });

    // View Pixel Bears button
    document.getElementById('viewPixelBearsBtn')?.addEventListener('click', () => {
      loadNFTs(PIXEL_BEARS_TAXON, 'Pixel Bears');
    });

    // View Ultra Rares button
    document.getElementById('viewUltraRaresBtn')?.addEventListener('click', () => {
      loadNFTs(ULTRA_RARES_TAXON, 'Ultra Rares');
    });

    // Initialize on load
    initializeProfileAndNFTs();

    // ===== TOP NAVIGATION FUNCTIONS =====

    // Toggle hamburger menu
    window.toggleMenu = function() {
      const menuOverlay = document.getElementById('menuOverlay');
      const menuScrim = document.getElementById('menuScrim');

      menuOverlay.classList.toggle('open');
      menuScrim.classList.toggle('open');

      // Prevent body scroll when menu is open
      if (menuOverlay.classList.contains('open')) {
        document.body.style.overflow = 'hidden';
      } else {
        document.body.style.overflow = '';
      }
    };

    // Open profile setup - opens drawer and scrolls to profile section
    window.openProfileSetup = function() {
      const walletAddress = sessionStorage.getItem('bearpark_wallet');

      if (!walletAddress) {
        // If not authenticated, open drawer to connect wallet first
        document.getElementById('buyDrawer').style.display = 'flex';
        setTimeout(() => {
          document.getElementById('buyDrawer').classList.add('visible');
        }, 10);
        return;
      }

      // Open the drawer
      document.getElementById('buyDrawer').style.display = 'flex';
      setTimeout(() => {
        document.getElementById('buyDrawer').classList.add('visible');

        // Wait for drawer animation, then scroll to profile section
        setTimeout(() => {
          const profileSection = document.getElementById('profileSetupSection');
          if (profileSection) {
            profileSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Highlight the profile section briefly
            profileSection.style.background = 'rgba(237,183,35,0.15)';
            profileSection.style.transition = 'background 0.3s';

            setTimeout(() => {
              profileSection.style.background = '';
            }, 2000);
          }
        }, 400);
      }, 10);
    };

    // Update welcome button with points and username
    async function updateWelcomeButton() {
      const walletAddress = sessionStorage.getItem('bearpark_wallet');
      const welcomePoints = document.getElementById('welcomePoints');
      const welcomeUsername = document.getElementById('welcomeUsername');

      if (!walletAddress) {
        welcomePoints.textContent = 'HONEY üçØ: 0 PTS';
        welcomeUsername.textContent = 'WELCOME APEX';
        return;
      }

      // Load points
      try {
        const pointsResponse = await fetch(`${API_BASE_URL}/api/points/${walletAddress}`);
        if (pointsResponse.ok) {
          const pointsData = await pointsResponse.json();
          const points = pointsData.total_points || 0;
          welcomePoints.textContent = `HONEY üçØ: ${points} PTS`;
        }
      } catch (error) {
        console.log('[Welcome] Could not load points');
        welcomePoints.textContent = 'HONEY üçØ: 0 PTS';
      }

      // Load profile username and avatar
      try {
        const profileResponse = await fetch(`${API_BASE_URL}/api/profile/${walletAddress}`);
        if (profileResponse.ok) {
          const profileData = await profileResponse.json();
          if (profileData.success && profileData.profile) {
            const profile = profileData.profile;

            // Update username
            if (profile.display_name) {
              welcomeUsername.textContent = `WELCOME ${profile.display_name.toUpperCase()}`;
            } else {
              welcomeUsername.textContent = 'WELCOME APEX';
            }

            // Update avatar
            const welcomeAvatar = document.getElementById('welcomeAvatar');
            if (profile.avatar_nft) {
              try {
                const avatarData = JSON.parse(profile.avatar_nft);
                if (avatarData.imageUrl) {
                  welcomeAvatar.src = avatarData.imageUrl;
                  welcomeAvatar.style.display = 'block';

                  // Add fallback if main image fails
                  welcomeAvatar.onerror = function() {
                    if (avatarData.fallbackImageUrl && this.src !== avatarData.fallbackImageUrl) {
                      this.src = avatarData.fallbackImageUrl;
                    } else {
                      this.style.display = 'none';
                    }
                  };
                }
              } catch (e) {
                console.log('[Welcome] Could not parse avatar data');
              }
            }
          } else {
            welcomeUsername.textContent = 'WELCOME APEX';
          }
        }
      } catch (error) {
        console.log('[Welcome] Could not load profile');
        welcomeUsername.textContent = 'WELCOME APEX';
      }
    }

    // Update welcome button when profile is loaded
    updateWelcomeButton();

    // Refresh welcome button when wallet connects
    window.addEventListener('storage', (e) => {
      if (e.key === 'bearpark_wallet') {
        updateWelcomeButton();
      }
    });

    // ===== LEADERBOARDS =====
    async function loadLeaderboards() {
      const games = [
        { id: 'flappy-bear', elementId: 'leaderboard-flappy' },
        { id: 'bear-slice', elementId: 'leaderboard-slice' },
        { id: 'bear-jumpventure', elementId: 'leaderboard-jumpventure' }
      ];

      for (const game of games) {
        try {
          const response = await fetch(`${API_BASE_URL}/api/leaderboard/${game.id}?limit=10`);
          const data = await response.json();

          const container = document.getElementById(game.elementId);
          if (!container) continue;

          if (data.success && data.leaderboard && data.leaderboard.length > 0) {
            container.innerHTML = data.leaderboard.map((entry, index) => {
              const medal = index === 0 ? 'ü•á' : (index === 1 ? 'ü•à' : (index === 2 ? 'ü•â' : ''));
              const rankClass = index === 0 ? 'rank-1' : (index === 1 ? 'rank-2' : (index === 2 ? 'rank-3' : ''));

              // Use username fallback logic: display_name ‚Üí twitter_username ‚Üí formatted wallet
              let displayName = 'Anonymous';
              if (entry.display_name) {
                displayName = entry.display_name;
              } else if (entry.twitter_username) {
                displayName = entry.twitter_username;
              } else if (entry.wallet_address) {
                displayName = entry.wallet_address.substring(0, 4) + '...' + entry.wallet_address.substring(entry.wallet_address.length - 4);
              }

              // Avatar display - parse avatar_nft JSON to get imageUrl
              let avatarUrl = 'https://files.catbox.moe/25ekkd.png'; // Default to BEAR logo
              if (entry.avatar_nft) {
                try {
                  const avatarData = typeof entry.avatar_nft === 'string' ? JSON.parse(entry.avatar_nft) : entry.avatar_nft;
                  if (avatarData.imageUrl) {
                    avatarUrl = avatarData.imageUrl;
                  }
                } catch (e) {
                  // If parsing fails, use default
                  console.warn('Failed to parse avatar_nft:', e);
                }
              }

              return `
                <div class="leaderboard-entry ${rankClass}">
                  <div class="leaderboard-rank">${medal || `#${index + 1}`}</div>
                  <img src="${avatarUrl}" alt="${displayName}" class="leaderboard-avatar" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--gold);" onerror="this.src='https://files.catbox.moe/25ekkd.png'">
                  <div class="leaderboard-name">
                    ${displayName}
                    ${entry.wallet_address ? `<div class="leaderboard-wallet">${entry.wallet_address.substring(0, 8)}...</div>` : ''}
                  </div>
                  <div class="leaderboard-score">${entry.score.toLocaleString()}</div>
                </div>
              `;
            }).join('');
          } else {
            container.innerHTML = '<div class="loading">No scores yet! Be the first!</div>';
          }
        } catch (error) {
          console.error(`Error loading ${game.id} leaderboard:`, error);
          const container = document.getElementById(game.elementId);
          if (container) {
            container.innerHTML = '<div class="loading">Unable to load scores</div>';
          }
        }
      }
    }

    // Load leaderboards on page load
    loadLeaderboards();

    // Refresh leaderboards every 30 seconds
    setInterval(loadLeaderboards, 30000);

  })();
  </script>
</body>
</html>