import{r as b,g as x}from"./phaser-0YPJO2g1.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}})();var A=b();const r=x(A);class C{ws=null;serverUrl;messageHandlers=new Map;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=2e3;playerData=null;constructor(t){this.serverUrl=t}connect(){return new Promise((t,e)=>{console.log(`üîå Connecting to Pong server: ${this.serverUrl}`);try{this.ws=new WebSocket(this.serverUrl),this.ws.onopen=()=>{console.log("‚úÖ Connected to Pong server"),this.reconnectAttempts=0,t()},this.ws.onmessage=s=>{try{const o=JSON.parse(s.data);this.handleServerMessage(o)}catch(o){console.error("‚ùå Error parsing server message:",o)}},this.ws.onclose=()=>{console.log("üîå Disconnected from Pong server"),this.attemptReconnect()},this.ws.onerror=s=>{console.error("‚ùå WebSocket error:",s),e(s)}}catch(s){console.error("‚ùå Failed to create WebSocket:",s),e(s)}})}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("‚ùå Max reconnect attempts reached"),this.emit("connection_failed",null);return}this.reconnectAttempts++,console.log(`üîÑ Reconnecting... (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect().catch(()=>{})},this.reconnectDelay*this.reconnectAttempts)}handleServerMessage(t){switch(console.log("üì® Received:",t.type,t),t.type){case"queue_joined":this.emit("queue_joined",t.position);break;case"match_found":this.emit("match_found",{opponent:t.opponent,yourSide:t.yourSide});break;case"countdown":this.emit("countdown",t.count);break;case"game_state":this.emit("game_state",t.state);break;case"game_over":this.emit("game_over",{winner:t.winner,finalScore:t.finalScore});break;case"opponent_disconnected":this.emit("opponent_disconnected",null);break;case"rematch_requested":this.emit("rematch_requested",null);break;case"rematch_accepted":this.emit("rematch_accepted",null);break;case"error":this.emit("error",t.message);break;default:console.log("‚ö†Ô∏è Unknown message type:",t.type)}}on(t,e){this.messageHandlers.set(t,e)}emit(t,e){const s=this.messageHandlers.get(t);s&&s(e)}send(t){this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.error("‚ùå Cannot send message - WebSocket not connected")}joinQueue(t){console.log("üéØ Joining matchmaking queue..."),this.playerData=t,this.send({type:"join_queue",data:t})}getPlayerData(){return this.playerData}movePaddle(t){this.send({type:"paddle_move",y:t,timestamp:Date.now()})}ready(){this.send({type:"ready"})}requestRematch(){this.send({type:"rematch"})}leave(){this.send({type:"leave"})}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}}const g="https://www.bearpark.xyz/api",f="pong";class l{static getWalletAddress(){return localStorage.getItem("xaman_wallet_address")}static getDisplayName(){return localStorage.getItem("display_name")||"Anonymous"}static getAvatarUrl(){return localStorage.getItem("avatar_url")}static getCurrentUserDisplayName(){const t=localStorage.getItem("display_name");if(t&&t.trim()!=="")return t;const e=localStorage.getItem("twitter_username");if(e&&e.trim()!=="")return e;const s=this.getWalletAddress();return s?this.formatWalletAddress(s):"Anonymous"}static isAuthenticated(){return!!this.getWalletAddress()}static async submitWin(t={}){const e=this.getWalletAddress();if(!e)return console.log("‚ÑπÔ∏è Win not submitted - user not authenticated"),{success:!1,error:"Not authenticated",message:"Connect your wallet at bearpark.xyz to save stats!"};const s=this.getLocalStats();s.wins++,this.saveLocalStats(s);try{const o={wallet_address:e,game_id:f,score:s.wins,metadata:{...t,wins:s.wins,losses:s.losses,total_games:s.wins+s.losses,win_rate:s.wins/(s.wins+s.losses),timestamp:new Date().toISOString(),display_name:this.getDisplayName(),result:"win"}};console.log("üì§ Submitting win to BEAR Park API...");const a=await(await fetch(`${g}/leaderboard`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();return a.success&&console.log("‚úÖ Win submitted to BEAR Park"),a}catch(o){return console.error("‚ùå Error submitting win to BEAR Park:",o),{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}static async submitLoss(t={}){const e=this.getWalletAddress();if(!e)return console.log("‚ÑπÔ∏è Loss not submitted - user not authenticated"),{success:!1,error:"Not authenticated",message:"Connect your wallet at bearpark.xyz to save stats!"};const s=this.getLocalStats();s.losses++,this.saveLocalStats(s);try{const o={wallet_address:e,game_id:f,score:s.wins,metadata:{...t,wins:s.wins,losses:s.losses,total_games:s.wins+s.losses,win_rate:s.wins/(s.wins+s.losses),timestamp:new Date().toISOString(),display_name:this.getDisplayName(),result:"loss"}};console.log("üì§ Submitting loss to BEAR Park API...");const a=await(await fetch(`${g}/leaderboard`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();return a.success&&console.log("‚úÖ Loss submitted to BEAR Park"),a}catch(o){return console.error("‚ùå Error submitting loss to BEAR Park:",o),{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}static getLocalStats(){const t=parseInt(localStorage.getItem("pongWins")||"0"),e=parseInt(localStorage.getItem("pongLosses")||"0"),s=t+e,o=s>0?t/s:0;return{wins:t,losses:e,totalGames:s,winRate:o}}static saveLocalStats(t){localStorage.setItem("pongWins",t.wins.toString()),localStorage.setItem("pongLosses",t.losses.toString())}static async getLeaderboard(t=10){try{const e=`${g}/leaderboard/${f}?limit=${t}`;return console.log("üîç Fetching Pong leaderboard from:",e),(await(await fetch(e)).json()).leaderboard||[]}catch(e){return console.error("‚ùå Error fetching Pong leaderboard:",e),[]}}static async getMyStats(){const t=this.getWalletAddress();if(!t)return null;try{return(await(await fetch(`${g}/leaderboard/${f}/${t}`)).json()).entry||null}catch(e){return console.error("‚ùå Error fetching user stats from BEAR Park:",e),null}}static formatWalletAddress(t){return!t||t.length<8?t:`${t.substring(0,4)}...${t.substring(t.length-4)}`}static formatDisplayName(t){return t.display_name?t.display_name:t.twitter_username?t.twitter_username:t.wallet_address?this.formatWalletAddress(t.wallet_address):"Anonymous"}}class _ extends r.Scene{pongClient=null;statusText=null;queuePositionText=null;loadingDots="";loadingTimer=null;statsText=null;constructor(){super({key:"PongLobbyScene"})}create(){const{width:t,height:e}=this.cameras.main;this.add.rectangle(0,0,t,e,0).setOrigin(0),this.add.text(t/2,100,"BEAR PONG",{fontSize:"64px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5),this.add.text(t/2,180,"Multiplayer Mode",{fontSize:"24px",color:"#4a90e2"}).setOrigin(.5),this.displayPlayerStats(),this.statusText=this.add.text(t/2,400,"Searching for opponent",{fontSize:"32px",color:"#ffffff"}),this.statusText.setOrigin(.5),this.queuePositionText=this.add.text(t/2,460,"",{fontSize:"20px",color:"#aaaaaa"}),this.queuePositionText.setOrigin(.5),this.loadingTimer=this.time.addEvent({delay:500,callback:()=>{this.loadingDots=this.loadingDots.length>=3?"":this.loadingDots+".",this.statusText&&this.statusText.setText(`Searching for opponent${this.loadingDots}`)},loop:!0}),this.add.text(t/2,e-150,"Waiting for another player to join...",{fontSize:"18px",color:"#888888",align:"center"}).setOrigin(.5);const a=this.add.text(t/2,e-80,"[ ESC to Cancel ]",{fontSize:"16px",color:"#ff6b6b"});a.setOrigin(.5),a.setInteractive({useHandCursor:!0}),a.on("pointerdown",()=>{this.cancelMatchmaking()}),this.input.keyboard?.on("keydown-ESC",()=>{this.cancelMatchmaking()}),this.connectToServer()}displayPlayerStats(){const t=l.getLocalStats(),e=l.getCurrentUserDisplayName(),s=this.add.container(this.cameras.main.width/2,280),o=this.add.text(0,0,`Player: ${e}`,{fontSize:"20px",color:"#ffffff"});o.setOrigin(.5),s.add(o),this.statsText=this.add.text(0,40,`Wins: ${t.wins}  |  Losses: ${t.losses}  |  Win Rate: ${(t.winRate*100).toFixed(1)}%`,{fontSize:"16px",color:"#4a90e2"}),this.statsText.setOrigin(.5),s.add(this.statsText)}async fetchPlayerAvatar(t){try{const s=await(await fetch(`/api/profile/${t}`)).json();if(s.success&&s.profile&&s.profile.avatar_nft)try{const o=JSON.parse(s.profile.avatar_nft);return o.imageUrl||o.fallbackImageUrl||null}catch{return`https://nft.xrpl-labs.com/${s.profile.avatar_nft}`}return null}catch(e){return console.error("Failed to fetch avatar:",e),null}}async connectToServer(){const t="wss://bear-pong-production.up.railway.app";this.pongClient=new C(t);try{await this.pongClient.connect(),this.setupEventHandlers();const e=l.getWalletAddress()||"guest_"+Date.now(),s=await this.fetchPlayerAvatar(e);console.log("üñºÔ∏è Fetched avatar URL:",s);const o={wallet:e,displayName:l.getCurrentUserDisplayName(),avatarUrl:s||void 0};this.pongClient.joinQueue(o)}catch(e){console.error("Failed to connect to server:",e),this.showConnectionError()}}setupEventHandlers(){this.pongClient&&(this.pongClient.on("queue_joined",t=>{this.queuePositionText&&this.queuePositionText.setText(`Queue position: ${t}`)}),this.pongClient.on("match_found",t=>{console.log("Match found!",t),console.log("üéÆ Opponent data:",t.opponent),console.log("üñºÔ∏è Opponent avatar URL:",t.opponent?.avatarUrl),this.statusText&&this.statusText.setText("Match Found!"),this.loadingTimer&&(this.loadingTimer.destroy(),this.loadingTimer=null),this.time.delayedCall(1e3,()=>{this.startGame(t.opponent,t.yourSide)})}),this.pongClient.on("connection_failed",()=>{this.showConnectionError()}),this.pongClient.on("error",t=>{console.error("Server error:",t),this.showError(t)}))}startGame(t,e){this.scene.start("PongGameScene",{pongClient:this.pongClient,opponent:t,yourSide:e})}cancelMatchmaking(){this.pongClient&&(this.pongClient.leave(),this.pongClient.disconnect()),this.loadingTimer&&this.loadingTimer.destroy(),this.add.text(this.cameras.main.width/2,this.cameras.main.height/2,"Matchmaking Cancelled",{fontSize:"32px",color:"#ffffff"}).setOrigin(.5),this.time.delayedCall(2e3,()=>{window.location.href="/"})}showConnectionError(){this.statusText&&(this.statusText.setText("Failed to connect to server"),this.statusText.setColor("#ff6b6b")),this.queuePositionText&&this.queuePositionText.setText("Please try again later"),this.loadingTimer&&(this.loadingTimer.destroy(),this.loadingTimer=null)}showError(t){this.queuePositionText&&(this.queuePositionText.setText(`Error: ${t}`),this.queuePositionText.setColor("#ff6b6b"))}}const i={CANVAS_WIDTH:1280,CANVAS_HEIGHT:720,PADDLE_WIDTH:20,PADDLE_HEIGHT:120,BALL_SIZE:20,PADDLE_SNAP_FACTOR:.85,PADDLE_MAX_VELOCITY:25,INITIAL_BALL_SPEED:6,WINNING_SCORE:3};class m extends r.GameObjects.Container{paddleRect;glowOuter;glowMid;borderYellow;borderGreen;borderPurple;ghostY=0;visualY=0;lastVisualY=0;keyboardVelocity=0;keyboardAcceleration=0;lastPointerY=0;lastTrailTime=0;color;isLocalPlayer=!1;constructor(t,e,s,o=16777215){super(t,e,s),this.color=o,this.ghostY=s,this.visualY=s,this.lastVisualY=s,this.glowOuter=t.add.rectangle(0,0,i.PADDLE_WIDTH+20,i.PADDLE_HEIGHT+20,16777215,.15),this.add(this.glowOuter),this.glowMid=t.add.rectangle(0,0,i.PADDLE_WIDTH+12,i.PADDLE_HEIGHT+12,16777215,.3),this.add(this.glowMid),this.borderYellow=t.add.rectangle(0,0,i.PADDLE_WIDTH+8,i.PADDLE_HEIGHT+8,16692481,.9),this.add(this.borderYellow),this.borderGreen=t.add.rectangle(0,0,i.PADDLE_WIDTH+5,i.PADDLE_HEIGHT+5,503304,.9),this.add(this.borderGreen),this.borderPurple=t.add.rectangle(0,0,i.PADDLE_WIDTH+2,i.PADDLE_HEIGHT+2,6819033,.9),this.add(this.borderPurple),this.paddleRect=t.add.rectangle(0,0,i.PADDLE_WIDTH,i.PADDLE_HEIGHT,o),this.add(this.paddleRect),t.add.existing(this)}updateKeyboardInput(t,e){t?(this.keyboardVelocity>=0&&(this.keyboardVelocity=-12),this.keyboardAcceleration=-.4):e?(this.keyboardVelocity<=0&&(this.keyboardVelocity=12),this.keyboardAcceleration=.4):(this.keyboardVelocity=0,this.keyboardAcceleration=0),this.ghostY+=this.keyboardVelocity,this.keyboardVelocity+=this.keyboardAcceleration,this.keyboardVelocity=r.Math.Clamp(this.keyboardVelocity,-25,i.PADDLE_MAX_VELOCITY),this.ghostY=r.Math.Clamp(this.ghostY,i.PADDLE_HEIGHT/2,i.CANVAS_HEIGHT-i.PADDLE_HEIGHT/2)}updatePointerInput(t,e){e&&(this.ghostY=t,this.ghostY=r.Math.Clamp(this.ghostY,i.PADDLE_HEIGHT/2,i.CANVAS_HEIGHT-i.PADDLE_HEIGHT/2))}update(){const t=i.PADDLE_SNAP_FACTOR;this.visualY+=(this.ghostY-this.visualY)*t,this.setY(this.visualY),this.updateSquashStretch(),this.updateGlowFromSpeed(),this.updateMotionBlur(),this.isLocalPlayer&&this.handleWallBounce(),this.lastVisualY=this.visualY}updatePosition(t){this.ghostY=t}updateSquashStretch(){const t=this.visualY-this.lastVisualY,e=r.Math.Clamp(Math.abs(t)/10,0,.15);Math.abs(t)>1?(this.paddleRect.setScale(1-e*.5,1+e),this.borderPurple.setScale(1-e*.5,1+e),this.borderGreen.setScale(1-e*.5,1+e),this.borderYellow.setScale(1-e*.5,1+e)):(this.paddleRect.setScale(1,1),this.borderPurple.setScale(1,1),this.borderGreen.setScale(1,1),this.borderYellow.setScale(1,1))}updateGlowFromSpeed(){const t=Math.abs(this.keyboardVelocity),e=r.Math.Clamp(t/35,.15,.6);this.glowOuter.setAlpha(e),this.glowMid.setAlpha(e*1.5)}updateMotionBlur(){const t=this.scene.time.now,e=Math.abs(this.visualY-this.lastVisualY);if(e>3&&t-this.lastTrailTime>30){const s=r.Math.Clamp(e/20,0,.4),o=this.scene.add.rectangle(this.x,this.lastVisualY,i.PADDLE_WIDTH,i.PADDLE_HEIGHT,this.color,s);this.scene.tweens.add({targets:o,alpha:0,duration:100,ease:"Power2",onComplete:()=>o.destroy()}),this.lastTrailTime=t}}handleWallBounce(){const t=i.PADDLE_HEIGHT/2,e=i.CANVAS_HEIGHT-i.PADDLE_HEIGHT/2;(this.ghostY<=t||this.ghostY>=e)&&(this.ghostY=r.Math.Clamp(this.ghostY,t,e),this.keyboardVelocity*=-.3,this.scene.cameras.main.shake(50,.002),this.flashPaddle(16711680,50))}flashPaddle(t,e){const s=this.paddleRect.fillColor;this.paddleRect.setFillStyle(t),this.scene.time.delayedCall(e,()=>{this.paddleRect.setFillStyle(s)})}getTop(){return this.y-i.PADDLE_HEIGHT/2}getBottom(){return this.y+i.PADDLE_HEIGHT/2}getGhostY(){return this.ghostY}setLocalPlayer(t){this.isLocalPlayer=t}}class O extends r.GameObjects.Container{ballCore;glowOuter;glowMid;glowInner;currentSpeed=i.INITIAL_BALL_SPEED;lastX=0;lastY=0;pulseTime=0;lastTrailTime=0;COLOR_STOPS=[{speed:6,color:16777215},{speed:8,color:16775388},{speed:10,color:16692481},{speed:11,color:16753920},{speed:13,color:16747520},{speed:15,color:16729344}];constructor(t,e,s){super(t,e,s),this.lastX=e,this.lastY=s,this.glowInner=t.add.arc(0,0,i.BALL_SIZE/2+3,0,360,!1,16777215,0),this.add(this.glowInner),this.glowOuter=t.add.arc(0,0,i.BALL_SIZE/2+12,0,360,!1,16777215,.15),this.add(this.glowOuter),this.glowMid=t.add.arc(0,0,i.BALL_SIZE/2+6,0,360,!1,16777215,.3),this.add(this.glowMid),this.ballCore=t.add.arc(0,0,i.BALL_SIZE/2,0,360,!1,16777215),this.add(this.ballCore),t.add.existing(this)}updatePosition(t,e,s,o){this.setPosition(t,e),s!==void 0&&o!==void 0&&(this.currentSpeed=Math.sqrt(s*s+o*o)),this.updateVisualEvolution(),this.autoTrail(),this.lastX=t,this.lastY=e}updateVisualEvolution(){const t=this.currentSpeed,e=this.interpolateColor(t);this.ballCore.setFillStyle(e),this.glowOuter.setFillStyle(e),this.glowMid.setFillStyle(e);const s=this.getGlowIntensity(t),o=this.getPulseValue(t);if(this.glowOuter.setAlpha(s.outer+o*.1),this.glowMid.setAlpha(s.mid+o*.15),t>=13){this.glowInner.setAlpha(.7+o*.3);const n=Math.min((t-13)/2,1);this.glowOuter.setScale(1+n*.3),this.glowMid.setScale(1+n*.2)}else this.glowInner.setAlpha(0),this.glowOuter.setScale(1),this.glowMid.setScale(1);this.pulseTime+=.016}interpolateColor(t){t=Math.max(6,Math.min(15,t));let e=this.COLOR_STOPS[0],s=this.COLOR_STOPS[this.COLOR_STOPS.length-1];for(let u=0;u<this.COLOR_STOPS.length-1;u++)if(t>=this.COLOR_STOPS[u].speed&&t<=this.COLOR_STOPS[u+1].speed){e=this.COLOR_STOPS[u],s=this.COLOR_STOPS[u+1];break}const o=(t-e.speed)/(s.speed-e.speed),n=e.color>>16&255,a=e.color>>8&255,d=e.color&255,h=s.color>>16&255,y=s.color>>8&255,w=s.color&255,p=Math.round(n+(h-n)*o),P=Math.round(a+(y-a)*o),T=Math.round(d+(w-d)*o);return p<<16|P<<8|T}getGlowIntensity(t){return t<8?{outer:.15,mid:.3}:t<11?{outer:.25,mid:.45}:t<13?{outer:.5,mid:.65}:{outer:.7,mid:.85}}getPulseValue(t){const e=this.map(t,6,15,.5,3),s=this.map(t,6,15,.1,.4);return Math.sin(this.pulseTime*e*Math.PI*2)*s}autoTrail(){const t=this.scene.time.now,e=this.currentSpeed;let s=100;e>=13?s=20:e>=11?s=40:e>=8&&(s=60),t-this.lastTrailTime>s&&(this.addTrailEffect(),this.lastTrailTime=t)}addTrailEffect(){const t=this.currentSpeed,e=this.interpolateColor(t),s=this.map(t,6,15,i.BALL_SIZE/2+4,i.BALL_SIZE/2+12),o=this.map(t,6,15,.15,.5),n=this.map(t,6,15,200,100),a=this.scene.add.arc(this.x,this.y,s,0,360,!1,e,o);if(t>=13){const d=this.scene.add.arc(this.x-2,this.y,s-2,0,360,!1,16711680,o*.5),h=this.scene.add.arc(this.x+2,this.y,s-2,0,360,!1,16776960,o*.5);this.scene.tweens.add({targets:[d,h],alpha:0,duration:n*.8,ease:"Power2",onComplete:()=>{d.destroy(),h.destroy()}})}this.scene.tweens.add({targets:a,alpha:0,duration:n,ease:"Power2",onComplete:()=>{a.destroy()}})}map(t,e,s,o,n){return o+(n-o)*((t-e)/(s-e))}getCurrentSpeed(){return this.currentSpeed}}class S extends r.GameObjects.Container{bannerBackground=null;constructor(t,e,s){const o=e==="left"?i.CANVAS_WIDTH/4:i.CANVAS_WIDTH*3/4;super(t,o,80),t.add.existing(this);const a=300,d=60;this.bannerBackground=t.add.rectangle(0,0,a,d,0,.3),this.add(this.bannerBackground);const h=t.add.text(0,0,s,{fontSize:"24px",color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:3});h.setOrigin(.5),this.add(h),this.setAlpha(.85)}show(){this.setAlpha(0),this.scene.tweens.add({targets:this,alpha:.85,duration:500,ease:"Power2"})}hide(){this.scene.tweens.add({targets:this,alpha:0,duration:300,ease:"Power2"})}}class D extends r.Scene{pongClient=null;opponent=null;yourSide="left";leftPaddle=null;rightPaddle=null;ball=null;leftBanner=null;rightBanner=null;countdownText=null;centerLine=null;cursors=null;wasd=null;constructor(){super({key:"PongGameScene"})}init(t){this.pongClient=t.pongClient,this.opponent=t.opponent,this.yourSide=t.yourSide}preload(){this.load.image("background","https://files.catbox.moe/qnp7wc.png")}create(){const{width:t,height:e}=this.cameras.main;this.add.image(0,0,"background").setOrigin(0).setDisplaySize(t,e);const o=8;this.add.rectangle(0,0,t,o,16692481).setOrigin(0),this.add.rectangle(0,e-o,t,o,16692481).setOrigin(0),this.drawCenterLine();const n=50+i.PADDLE_WIDTH/2,a=t-50-i.PADDLE_WIDTH/2;this.yourSide==="left"?(this.leftPaddle=new m(this,n,e/2,6819033),this.leftPaddle.setLocalPlayer(!0),this.rightPaddle=new m(this,a,e/2,503304),this.rightPaddle.setLocalPlayer(!1)):(this.leftPaddle=new m(this,n,e/2,6819033),this.leftPaddle.setLocalPlayer(!1),this.rightPaddle=new m(this,a,e/2,503304),this.rightPaddle.setLocalPlayer(!0)),this.ball=new O(this,t/2,e/2),this.createPlayerBanners(),this.countdownText=this.add.text(t/2,e/2-100,"",{fontSize:"128px",color:"#ffffff",fontStyle:"bold"}),this.countdownText.setOrigin(.5),this.setupInput(),this.setupServerHandlers(),this.scene.launch("PongUIScene")}drawCenterLine(){this.centerLine=this.add.graphics(),this.centerLine.lineStyle(2,4473924);const t=20,e=15,s=this.cameras.main.width/2;for(let o=0;o<this.cameras.main.height;o+=t+e)this.centerLine.lineBetween(s,o,s,o+t)}createPlayerBanners(){this.yourSide==="left"?(this.leftBanner=new S(this,"left",l.getCurrentUserDisplayName()),this.rightBanner=new S(this,"right",this.opponent?.displayName||"Opponent")):(this.leftBanner=new S(this,"left",this.opponent?.displayName||"Opponent"),this.rightBanner=new S(this,"right",l.getCurrentUserDisplayName())),this.leftBanner?.show(),this.rightBanner?.show()}setupInput(){this.cursors=this.input.keyboard?.createCursorKeys()||null,this.wasd=this.input.keyboard?.addKeys({up:r.Input.Keyboard.KeyCodes.W,down:r.Input.Keyboard.KeyCodes.S}),this.input.on("pointerdown",t=>{const e=t.x<this.cameras.main.width/2;(this.yourSide==="left"&&e||this.yourSide==="right"&&!e)&&(this.yourSide==="left"?this.leftPaddle:this.rightPaddle)?.updatePointerInput(t.y,!0)}),this.input.on("pointermove",t=>{const e=t.x<this.cameras.main.width/2,s=this.yourSide==="left"&&e||this.yourSide==="right"&&!e;t.isDown&&s&&(this.yourSide==="left"?this.leftPaddle:this.rightPaddle)?.updatePointerInput(t.y,!0)}),this.input.on("pointerup",()=>{(this.yourSide==="left"?this.leftPaddle:this.rightPaddle)?.updatePointerInput(0,!1)})}setupServerHandlers(){this.pongClient&&(this.pongClient.on("countdown",t=>{this.countdownText&&(t>0?(this.countdownText.setText(t.toString()),this.tweens.add({targets:this.countdownText,scale:{from:2,to:1},alpha:{from:1,to:.5},duration:1e3,ease:"Power2"})):(this.countdownText.setText("GO!"),this.tweens.add({targets:this.countdownText,alpha:0,duration:500,delay:500,onComplete:()=>{this.countdownText?.destroy(),this.countdownText=null}})))}),this.pongClient.on("game_state",t=>{this.updateGameState(t);const e=this.scene.get("PongUIScene");e&&e.updateScore&&e.updateScore(t.score1,t.score2)}),this.pongClient.on("game_over",t=>{this.handleGameOver(t.winner,t.finalScore)}),this.pongClient.on("opponent_disconnected",()=>{this.handleOpponentDisconnect()}))}updateGameState(t){this.ball&&this.ball.updatePosition(t.ballX,t.ballY,t.ballVelocityX,t.ballVelocityY),this.yourSide==="left"?this.rightPaddle&&this.rightPaddle.updatePosition(t.paddle2Y):this.leftPaddle&&this.leftPaddle.updatePosition(t.paddle1Y)}update(){this.handlePaddleInput(),this.leftPaddle?.update(),this.rightPaddle?.update()}handlePaddleInput(){if(!this.pongClient)return;const t=this.yourSide==="left"?this.leftPaddle:this.rightPaddle;if(!t)return;const e=!!(this.cursors?.up.isDown||this.wasd?.up.isDown),s=!!(this.cursors?.down.isDown||this.wasd?.down.isDown);t.updateKeyboardInput(e,s),this.pongClient.movePaddle(t.getGhostY())}handleGameOver(t,e){console.log("Game over!",t,e);const s=t===this.yourSide;this.scene.stop("PongUIScene"),this.scene.start("PongGameOverScene",{didWin:s,yourScore:this.yourSide==="left"?e.left:e.right,opponentScore:this.yourSide==="left"?e.right:e.left,opponent:this.opponent,pongClient:this.pongClient})}handleOpponentDisconnect(){console.log("Opponent disconnected"),this.add.text(this.cameras.main.width/2,this.cameras.main.height/2,`Opponent Disconnected

You Win by Default!`,{fontSize:"32px",color:"#ffffff",align:"center"}).setOrigin(.5),this.time.delayedCall(3e3,()=>{this.yourSide==="left"?this.leftPaddle?.getTop():this.rightPaddle?.getTop(),this.handleGameOver(this.yourSide,{left:this.yourSide==="left"?i.WINNING_SCORE:0,right:this.yourSide==="right"?i.WINNING_SCORE:0})})}}class E extends r.Scene{leftScoreText=null;rightScoreText=null;winningScoreText=null;constructor(){super({key:"PongUIScene"})}create(){const{width:t,height:e}=this.cameras.main;this.leftScoreText=this.add.text(t/4,80,"0",{fontSize:"96px",color:"#4a90e2",fontStyle:"bold"}),this.leftScoreText.setOrigin(.5),this.leftScoreText.setAlpha(.6),this.rightScoreText=this.add.text(t*3/4,80,"0",{fontSize:"96px",color:"#ff6b6b",fontStyle:"bold"}),this.rightScoreText.setOrigin(.5),this.rightScoreText.setAlpha(.6),this.winningScoreText=this.add.text(t/2,30,`First to ${i.WINNING_SCORE}`,{fontSize:"16px",color:"#888888"}),this.winningScoreText.setOrigin(.5),this.add.text(t/2,e-20,"ESC to quit",{fontSize:"14px",color:"#666666"}).setOrigin(.5),this.input.keyboard?.on("keydown-ESC",()=>{this.quitGame()})}updateScore(t,e){this.leftScoreText&&(this.leftScoreText.setText(t.toString()),parseInt(this.leftScoreText.text)!==t&&this.tweens.add({targets:this.leftScoreText,scale:{from:1.2,to:1},duration:300,ease:"Back.out"})),this.rightScoreText&&(this.rightScoreText.setText(e.toString()),parseInt(this.rightScoreText.text)!==e&&this.tweens.add({targets:this.rightScoreText,scale:{from:1.2,to:1},duration:300,ease:"Back.out"}))}quitGame(){const t=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2,`Are you sure you want to quit?

Press ESC again to confirm`,{fontSize:"24px",color:"#ffffff",align:"center",backgroundColor:"#000000",padding:{x:20,y:20}});t.setOrigin(.5);const e=this.input.keyboard?.addKey(r.Input.Keyboard.KeyCodes.ESC),s=()=>{this.scene.stop("PongGameScene"),this.scene.stop("PongUIScene"),window.location.href="/"};e?.once("down",s),this.time.delayedCall(3e3,()=>{t.destroy(),e?.off("down",s)})}}class L extends r.Scene{didWin=!1;yourScore=0;opponentScore=0;opponent=null;pongClient=null;leaderboard=[];constructor(){super({key:"PongGameOverScene"})}init(t){this.didWin=t.didWin,this.yourScore=t.yourScore,this.opponentScore=t.opponentScore,this.opponent=t.opponent,this.pongClient=t.pongClient}async create(){const{width:t,height:e}=this.cameras.main;this.add.rectangle(0,0,t,e,0,.95).setOrigin(0);const s=this.add.text(t/2,150,this.didWin?"VICTORY!":"DEFEAT",{fontSize:"72px",color:this.didWin?"#4ade80":"#ff6b6b",fontStyle:"bold"});s.setOrigin(.5),this.tweens.add({targets:s,scale:{from:0,to:1},alpha:{from:0,to:1},duration:500,ease:"Back.out"});const o=this.add.container(t/2,280),n=this.add.text(0,0,`You: ${this.yourScore}  -  ${this.opponent?.displayName||"Opponent"}: ${this.opponentScore}`,{fontSize:"32px",color:"#ffffff"});n.setOrigin(.5),o.add(n),await this.submitResult(),this.displayStats(t/2,380),await this.loadAndDisplayLeaderboard(t/2,550),this.createButtons(t/2,e-150)}async submitResult(){try{this.didWin?(await l.submitWin({opponent:this.opponent?.displayName,your_score:this.yourScore,opponent_score:this.opponentScore}),console.log("‚úÖ Win submitted to BEARpark")):(await l.submitLoss({opponent:this.opponent?.displayName,your_score:this.yourScore,opponent_score:this.opponentScore}),console.log("‚úÖ Loss submitted to BEARpark"))}catch(t){console.error("‚ùå Error submitting result:",t)}}displayStats(t,e){const s=l.getLocalStats(),o=this.add.container(t,e),n=this.add.text(0,0,"Your Stats",{fontSize:"24px",color:"#4a90e2",fontStyle:"bold"});n.setOrigin(.5),o.add(n);const a=this.add.text(0,40,`Wins: ${s.wins}  |  Losses: ${s.losses}  |  Win Rate: ${(s.winRate*100).toFixed(1)}%`,{fontSize:"18px",color:"#ffffff"});a.setOrigin(.5),o.add(a),o.setAlpha(0),this.tweens.add({targets:o,alpha:1,duration:500,delay:300})}async loadAndDisplayLeaderboard(t,e){const s=this.add.container(t,e),o=this.add.text(0,0,"Top Players",{fontSize:"24px",color:"#4a90e2",fontStyle:"bold"});o.setOrigin(.5),s.add(o);const n=this.add.text(0,40,"Loading...",{fontSize:"16px",color:"#888888"});n.setOrigin(.5),s.add(n);try{if(this.leaderboard=await l.getLeaderboard(5),n.destroy(),this.leaderboard.length>0)this.leaderboard.forEach((a,d)=>{const h=l.formatDisplayName(a),y=a.score||a.metadata?.wins||0,w=a.metadata?.losses||0,p=this.add.text(0,40+d*30,`${d+1}. ${h} - ${y}W ${w}L`,{fontSize:"16px",color:"#ffffff"});p.setOrigin(.5),s.add(p)});else{const a=this.add.text(0,40,"No leaderboard data yet",{fontSize:"16px",color:"#888888"});a.setOrigin(.5),s.add(a)}}catch(a){n.setText("Failed to load leaderboard"),console.error("Error loading leaderboard:",a)}s.setAlpha(0),this.tweens.add({targets:s,alpha:1,duration:500,delay:600})}createButtons(t,e){const s=this.add.text(t,e,"[ Play Again ]",{fontSize:"24px",color:"#4ade80"});s.setOrigin(.5),s.setInteractive({useHandCursor:!0}),s.on("pointerover",()=>{s.setScale(1.1)}),s.on("pointerout",()=>{s.setScale(1)}),s.on("pointerdown",()=>{this.playAgain()});const o=this.add.text(t,e+60,"[ Main Menu ]",{fontSize:"20px",color:"#888888"});o.setOrigin(.5),o.setInteractive({useHandCursor:!0}),o.on("pointerover",()=>{o.setScale(1.1),o.setColor("#ffffff")}),o.on("pointerout",()=>{o.setScale(1),o.setColor("#888888")}),o.on("pointerdown",()=>{this.returnToMenu()}),s.setAlpha(0),o.setAlpha(0),this.tweens.add({targets:[s,o],alpha:1,duration:500,delay:900})}playAgain(){this.pongClient&&this.pongClient.disconnect(),this.scene.start("PongLobbyScene")}returnToMenu(){this.pongClient&&this.pongClient.disconnect(),window.location.href="/"}}const I={type:r.AUTO,width:1280,height:720,parent:"game-container",backgroundColor:"#000000",scale:{mode:r.Scale.FIT,autoCenter:r.Scale.CENTER_BOTH},scene:[_,D,E,L],physics:{default:"arcade",arcade:{debug:!1,fps:60}}},k=new r.Game(I);k.scene.start("PongLobbyScene");console.log("üéÆ BEAR PONG initialized");console.log("üîå Server URL:","wss://bear-pong-production.up.railway.app");
