<!doctype html>
<html lang="en" id="top" class="no-js">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, viewport-fit=cover" />
  <!-- ðŸ»â„ï¸ COCAINE BEAR: Cache for 1 year -->
  <meta http-equiv="Cache-Control" content="public, max-age=31536000" />
  <title>BEAR Park â€” BEARcade</title>
  <meta name="description" content="Welcome to BEAR Park â€” play BEARcade games, explore the lore of Bearableguy123, view BEAR NFTs, watch the live stream, and join the $BEAR community." />
  <meta name="theme-color" content="#edb723" />
  <meta name="color-scheme" content="dark light" />
  <link rel="canonical" href="https://bearpark.xyz/" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="BEAR Park â€” BEARcade" />
  <meta property="og:description" content="Defend the castle. Play BEARcade. Join the $BEAR fam." />
  <meta property="og:image" content="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/qnd2tx.png" />
  <meta property="og:url" content="https://bearpark.xyz/" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="BEAR Park â€” BEARcade" />
  <meta name="twitter:description" content="Defend the castle. Play BEARcade. Join the $BEAR fam." />
  <meta name="twitter:image" content="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/qnd2tx.png" />

  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/favicon-16x16.png" sizes="16x16" type="image/png">
  <link rel="icon" href="/favicon-32x32.png" sizes="32x32" type="image/png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="icon" href="/android-chrome-192x192.png" sizes="192x192" type="image/png">
  <link rel="icon" href="/android-chrome-512x512.png" sizes="512x512" type="image/png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- Performance: preconnects + hero preload -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preload" as="image" href="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/qnd2tx.png" fetchpriority="high" />
  <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet" />

  <!-- ðŸ»â„ï¸ COCAINE BEAR: Kill console + preconnect -->
  <script>if(location.hostname!=='localhost')console.log=console.warn=console.info=console.debug=function(){};</script>
  <link rel="preconnect" href="https://unpkg.com" crossorigin />
  <link rel="preconnect" href="https://files.catbox.moe" crossorigin />

  <!-- XRPL Library (deferred) -->
  <script defer src="https://unpkg.com/xrpl@3.0.0/build/xrpl-latest-min.js"></script>

  <style>
  /* ==== THEME =========================================================== */
  :root{
    --gold:#edb723;
    --gold-ink:#231b04;
    --charcoal:#141619;
    --card:#1e2226;
    --ink:#0b0d0e;
    --accent:#d75c46;
    --honey:#ffefb3;
    --elev: 0 0.8px 1.6px rgba(0,0,0,.18), 0 5px 18px rgba(0,0,0,.28);
    --elev-strong: 0 10px 28px rgba(0,0,0,.45), 0 1px 0 rgba(255,255,255,.03) inset;
    --ease-spring:cubic-bezier(.18,.9,.2,1);
    --ring: 0 0 0 4px #000, 0 0 0 6px rgba(237,183,35,.66);
    accent-color: var(--gold);
    --stripe-purple: #680cd9;
    --stripe-yellow: #feb501;
    --stripe-green: #07ae08;
    --tri-gradient: linear-gradient(to right, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
  }

  /* ==== BASE ============================================================ */
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--charcoal);color:#fff}
  body{padding-bottom:calc(160px + env(safe-area-inset-bottom))}

  /* Tri-color border utility for rounded elements */
  .tri-border-rounded {
    position: relative;
    border: none;
  }
  .tri-border-rounded::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 6px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: -1;
  }
  html{scroll-behavior:smooth}
  img{max-width:100%;height:auto;display:block}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1100px;margin:0 auto;padding:52px 20px}
  .center{display:flex;justify-content:center;align-items:center}

  /* Global font */
  body, p, .tile .lbl, button, a, small {
    font-family:"Luckiest Guy","Arial Black",Impact,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    text-rendering:optimizeLegibility;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* Decorative grain + aurora */
  body::before{
    content:"";
    position:fixed; inset:-20vmax; pointer-events:none; z-index:-2;
    background:
      radial-gradient(100vmax 60vmax at 10% -10%, rgba(237,183,35,.055), transparent 60%),
      radial-gradient(80vmax 60vmax at 100% 10%, rgba(215,92,70,.055), transparent 60%),
      radial-gradient(80vmax 60vmax at 50% 110%, rgba(118,174,255,.045), transparent 60%);
    filter:blur(24px) saturate(1.05);
  }
  body::after{
    content:"";
    position:fixed; inset:0; pointer-events:none; z-index:-1;
    background-image:
      radial-gradient(rgba(255,255,255,.05), transparent 40%),
      repeating-linear-gradient(0deg, rgba(255,255,255,.02) 0 2px, transparent 2px 4px);
    mix-blend-mode:overlay; opacity:.18;
  }

  /* Skip link */
  .skip-link{position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden}
  .skip-link:focus{left:12px;top:12px;width:auto;height:auto;z-index:1000;background:#000;color:#fff;border:3px solid var(--gold);border-radius:10px;padding:10px 14px}

  /* Sticky nav + scroll progress */
  .site-nav{position:sticky;top:0;z-index:50;background:linear-gradient(180deg, #0f1114, rgba(15,17,20,.8));backdrop-filter:saturate(1.05) blur(6px);border-bottom:4px solid transparent; border-image: var(--tri-gradient) 1}
  .site-nav .bar{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:14px;padding:10px 20px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:900}
  .brand img{width:36px;height:36px}
  .links{display:flex;gap:10px;flex-wrap:wrap}
  .links a{font-weight:900;padding:8px 12px;border-radius:12px}
  .links a[aria-current="true"], .links a:hover{background:#1c1f23}
  .nav-cta{margin-left:auto}
  .progress{position:absolute;inset-inline:0;top:0;height:4px;background:linear-gradient(90deg,var(--gold),#ffe280);transform-origin:left center;transform:scaleX(0)}

  /* Headings */
  .h1,.h2,.h3{font-weight:900; letter-spacing:.5px; text-align:center; line-height:1.05; margin:0 0 14px; color:#fff; text-shadow:0 4px 0 rgba(0,0,0,.35), 0 1px 0 rgba(0,0,0,.25)}
  .h1{font-size:clamp(44px,7vw,96px)}
  .h2{font-size:clamp(38px,5.5vw,72px)}
  .h3{font-size:clamp(28px,3.5vw,44px)}
  p{margin:0 0 14px;font-weight:600;font-size:18px;line-height:1.35}
  .on-dark{color:var(--gold)!important}

  /* Sections */
  section{
    position:relative;
    border-top: 6px solid;
    border-bottom: 6px solid;
    border-image: linear-gradient(to right, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%) 1;
  }
  section.alt{background:var(--gold);color:var(--gold-ink)}
  section.dark{background:linear-gradient(180deg,#141619 0%, #101215 100%);color:#fff}
  .spacer{height:12px}

  /* Buttons */
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:.6rem;font:900 clamp(18px,2.5vw,24px)/1 "Luckiest Guy","Arial Black",Impact,system-ui,sans-serif;border-radius:26px;padding:1.1rem 1.6rem;color:#fff;background:var(--accent);border:none; box-shadow:0 10px 0 #7b2a20, 0 18px 24px rgba(0,0,0,.35);transition:transform .12s var(--ease-spring), box-shadow .12s var(--ease-spring), filter .2s ease;white-space:nowrap; position:relative; will-change:transform}
  .btn::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 26px;
    padding: 6px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: -1;
  }
  .btn{transition:all 0.2s ease;}
  .btn:hover{filter:brightness(1.12); transform:translateY(-2px);}
  .btn:active{transform:translateY(4px); box-shadow:0 6px 0 #7b2a20, 0 10px 16px rgba(0,0,0,.35)}
  .btn.ghost{background:#1c1f23;color:#fff;box-shadow:0 10px 0 #000,0 18px 24px rgba(0,0,0,.35)}
  .btn.gold{background:var(--gold);color:#000;box-shadow:0 10px 0 #9b7a0d,0 18px 24px rgba(0,0,0,.35)}
  .btn.gold:hover{box-shadow:0 12px 0 #9b7a0d,0 22px 28px rgba(0,0,0,.4); filter:brightness(1.15);}
  .btn:focus-visible{outline:none; box-shadow:var(--ring)}

  /* Input Styles */
  input[type="text"]:focus{
    border-color:var(--gold) !important;
    box-shadow:0 0 0 3px rgba(237,183,35,0.2);
    outline:none;
  }

  /* Cards */
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border:4px solid transparent;
    border-radius:20px;
    padding:22px;
    box-shadow:var(--elev-strong);
    overflow:hidden;
    -webkit-overflow-scrolling:auto;
    backdrop-filter:saturate(1.1) blur(2px);
    transform-style:preserve-3d;
    will-change:transform;
    transition:transform .4s var(--ease-spring), box-shadow .4s var(--ease-spring);
    background-image: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)), var(--tri-gradient);
    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
  }
  .card:hover{ transform:translateY(-4px); box-shadow:0 18px 40px rgba(0,0,0,.5) }
  .card:focus-within{ box-shadow:var(--ring), var(--elev-strong) }

  /* Hero */
  .hero{--hero-bg:url("https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/qnd2tx.png"); background:radial-gradient(1200px 500px at 50% -10%, rgba(255,255,255,.065), transparent 60%) , var(--hero-bg) center/cover no-repeat; min-height:56vh; display:flex; align-items:center; position:relative; border-bottom:6px solid transparent; border-image: var(--tri-gradient) 1; overflow:hidden}
  .hero .plate{background:var(--gold); color:var(--ink); border:6px solid transparent; border-radius:22px; box-shadow:0 22px 48px rgba(0,0,0,.45), 0 2px 0 rgba(255,255,255,.25) inset; padding:20px 28px; display:inline-block; margin:0 auto; position:relative; transform:perspective(800px) rotateX(0) rotateY(0) translateZ(0); transition:transform .6s var(--ease-spring), box-shadow .4s var(--ease-spring); will-change:transform; background-image: linear-gradient(var(--gold), var(--gold)), var(--tri-gradient); background-origin: padding-box, border-box; background-clip: padding-box, border-box;}
  .hero .logo{position:absolute; left:-72px; top:-40px; width:120px; transform:rotate(-4deg); filter:drop-shadow(0 8px 0 rgba(0,0,0,.4))}
  .hero .subtitle{font:800 clamp(16px,2.4vw,22px)/1.2 "Luckiest Guy"; margin-top:-6px; color:var(--ink)}

  /* Hero Character */
  #heroCharacter{
    position:absolute;
    right:30%;
    bottom:-50%;
    transform:translateY(50%);
    width:30vh;
    max-width:350px;
    min-width:200px;
    height:auto;
    z-index:10;
    pointer-events:none;
    transition:transform 0.1s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  /* Portrait phones (iPhone SE, iPhone 14, Galaxy) */
  @media (max-width: 768px) and (orientation: portrait){
    #heroCharacter{
      width:24vh;
      max-width:250px;
      right:5%;
      transform:translateY(50%);
    }
  }

  /* Landscape tablets and large screens */
  @media (min-width: 769px) and (orientation: landscape){
    #heroCharacter{
      width:22vh;
      max-width:280px;
      right:10%;
      transform:translateY(48%);
    }
  }

  /* Very small phones (iPhone SE specifically) */
  @media (max-width: 375px) and (max-height: 667px){
    #heroCharacter{
      width:26vh;
      max-width:230px;
      right:3%;
      transform:translateY(52%);
    }
  }

  /* Standard desktop (1024px - 1439px) - Center positioning with small offset */
  @media (min-width: 1024px){
    #heroCharacter{
      left:50%;
      right:auto;
      margin-left:-150px;
      bottom:-50%;
      width:26vh;
      max-width:300px;
    }
  }

  /* Large desktop (1440px - 1919px) - Center positioning with moderate offset */
  @media (min-width: 1440px){
    #heroCharacter{
      left:50%;
      right:auto;
      margin-left:-300px;
      bottom:-50%;
      width:27vh;
      max-width:310px;
    }
  }

  /* Ultrawide screens (1920px and wider) - Put character RIGHT NEXT to the BEAR PARK sign */
  @media (min-width: 1920px){
    #heroCharacter{
      left:50%;
      right:auto;
      margin-left:-500px;
      bottom:-50%;
      width:28vh;
      max-width:320px;
    }
  }

  /* Extra wide screens (2560px+) - Put character RIGHT NEXT to the BEAR PARK sign */
  @media (min-width: 2560px){
    #heroCharacter{
      left:50%;
      right:auto;
      margin-left:-500px;
      bottom:-50%;
      width:30vh;
      max-width:340px;
    }
  }

  /* Side honey rails */
  .rails::before,.rails::after{content:"";position:fixed;top:0;bottom:0;width:18px;z-index:1;pointer-events:none;opacity:.65}
  .rails::before{left:80px;background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0)), repeating-linear-gradient(180deg, rgba(0,0,0,.8) 0 3px, rgba(0,0,0,0) 3px 6px), linear-gradient(180deg, var(--gold) 0%, #946e00 100%);border:3px solid transparent;border-image: var(--tri-gradient) 1;border-radius:999px}
  .rails::after{right:6px;background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0)), repeating-linear-gradient(180deg, rgba(0,0,0,.8) 0 3px, rgba(0,0,0,0) 3px 6px), linear-gradient(180deg, var(--gold) 0%, #946e00 100%);border:3px solid transparent;border-image: var(--tri-gradient) 1;border-radius:999px}

  /* Arcade image */
  .arcade{position:relative;width:100%;max-width:1100px;margin:0 auto}
  .arcade img{width:100%;height:auto;display:block;border:4px solid transparent;border-radius:20px;box-shadow:0 18px 40px rgba(0,0,0,.45); background-image: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0)), var(--tri-gradient); background-origin: padding-box, border-box; background-clip: padding-box, border-box;}
  .arcade a.hotspot{position:absolute;display:block;border-radius:16px;text-indent:-9999px;overflow:hidden;outline:none;background:transparent;transition: box-shadow .25s var(--ease-spring), transform .25s var(--ease-spring)}
  .arcade a.hotspot:focus-visible{outline:6px solid rgba(237,183,35,.7)}
  .arcade a.hotspot:hover, .arcade a.hotspot:focus-visible{ box-shadow: 0 0 0 6px rgba(237,183,35,.35), 0 0 0 10px rgba(0,0,0,.6); }
  .arcade a.hotspot::after{
    content:"";
    position:absolute; left:50%; top:0; width:20px; height:0; transform:translate(-50%,0);
    background: linear-gradient(180deg, #fff6c7 0%, #ffe280 40%, #edb723 70%, #9b7a0d 100%);
  border:3px solid transparent; border-top:none; border-radius:0 0 16px 16px; border-image: var(--tri-gradient) 1; box-shadow:0 6px 0 #946e00, 0 12px 20px rgba(0,0,0,.4);
    transition:height .35s var(--ease-spring), opacity .25s ease; opacity:0;
  }
  .arcade a.hotspot:hover::after, .arcade a.hotspot:focus-visible::after{ height:36px; opacity:1 }

  /* Grid & tiles */
  .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:22px}
  @media (max-width:820px){.grid-2{grid-template-columns:1fr}}
  .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:22px}
  @media (max-width:1024px){.grid-3{grid-template-columns:1fr}}
  .tile{text-decoration:none;display:flex;flex-direction:column;align-items:center;gap:14px}
  .tile .face{width:100%;min-height:140px;padding:22px;background:var(--card);border:4px solid transparent;border-radius:18px;box-shadow:0 12px 0 #000,0 18px 28px rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;transition:transform .35s var(--ease-spring), box-shadow .35s var(--ease-spring);transform-style:preserve-3d; will-change:transform; background-image: linear-gradient(var(--card), var(--card)), var(--tri-gradient); background-origin: padding-box, border-box; background-clip: padding-box, border-box;}
  .tile:hover .face{ transform:translateY(-4px); box-shadow:0 16px 0 #000,0 26px 40px rgba(0,0,0,.45) }
  .tile img{max-width:220px;max-height:64px;object-fit:contain;filter:drop-shadow(0 2px 0 rgba(0,0,0,.4))}
  .tile .lbl{font-weight:800;font-size:18px;line-height:1.2;color:var(--ink);opacity:.9}
  .dark .tile .lbl{color:var(--gold)}

  /* NFTs */
  #nfts .card{padding:26px}
  #nfts .card{background:linear-gradient(180deg,#141619 0%, #101215 100%) !important; border:4px solid transparent !important; border-radius:20px !important; background-image: linear-gradient(180deg,#141619 0%, #101215 100%), var(--tri-gradient) !important; background-origin: padding-box, border-box !important; background-clip: padding-box, border-box !important;}
  .nft-media{display:block;border:6px solid transparent;border-radius:16px;overflow:hidden; background-image: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0)), var(--tri-gradient); background-origin: padding-box, border-box; background-clip: padding-box, border-box;}
  .nft-media img,.nft-media video{display:block;width:100%;height:auto}
  #nfts .card h3,#nfts .card p{color:var(--gold)!important}

  /* Leaderboards */
  .leaderboard-card{
    position:relative;
    background:radial-gradient(500px 200px at 50% -20%, rgba(118,174,255,.12), transparent 60%), var(--ink);
    border-radius:28px;
    padding:32px 24px;
    isolation:isolate;
  }
  .leaderboard-card::before{
    content:'';
    position:absolute;
    inset:0;
    border-radius:28px;
    padding:4px;
    background:var(--tri-gradient);
    -webkit-mask:linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite:xor;
    mask:linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite:exclude;
    pointer-events:none;
    z-index:0;
    opacity:1;
  }
  .leaderboard-list{
    display:flex;
    flex-direction:column;
    gap:12px;
    overflow-y:auto;
    max-height:520px;
    padding-right:8px;
  }

  .leaderboard-list::-webkit-scrollbar{
    width:8px;
  }

  .leaderboard-list::-webkit-scrollbar-track{
    background:rgba(0,0,0,0.2);
    border-radius:4px;
  }

  .leaderboard-list::-webkit-scrollbar-thumb{
    background:var(--gold);
    border-radius:4px;
  }
  .leaderboard-entry{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:16px;
    border-radius:12px;
    background:linear-gradient(135deg, rgba(104, 12, 217, 0.15) 0%, rgba(7, 174, 8, 0.15) 100%);
    border-left:4px solid var(--gold);
    transition:all 0.2s ease;
  }
  .leaderboard-entry:hover{transform:translateX(8px);background:linear-gradient(135deg, rgba(104, 12, 217, 0.25) 0%, rgba(7, 174, 8, 0.25) 100%)}
  .leaderboard-entry.rank-1{background:linear-gradient(135deg, rgba(237, 183, 35, 0.3) 0%, rgba(255, 215, 0, 0.2) 100%);border-left-color:#FFD700;border-left-width:6px}
  .leaderboard-entry.rank-2{background:linear-gradient(135deg, rgba(192, 192, 192, 0.2) 0%, rgba(169, 169, 169, 0.15) 100%);border-left-color:#C0C0C0;border-left-width:5px}
  .leaderboard-entry.rank-3{background:linear-gradient(135deg, rgba(205, 127, 50, 0.2) 0%, rgba(184, 115, 51, 0.15) 100%);border-left-color:#CD7F32;border-left-width:5px}
  .leaderboard-rank{font-size:24px;color:var(--gold);text-shadow:2px 2px 0px #000;min-width:50px;font-family:'Luckiest Guy',cursive}
  .leaderboard-name{font-size:18px;color:#fff;text-shadow:2px 2px 0px #000;flex:1;margin:0 16px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
  .leaderboard-score{font-size:22px;color:var(--stripe-yellow);text-shadow:2px 2px 0px #000;font-weight:800}
  .leaderboard-wallet{font-size:11px;color:#888;font-family:monospace;margin-top:4px}
  .loading{text-align:center;padding:32px;color:#888;font-size:16px}

  /* Community banner */
  .community-banner{position:relative;overflow:hidden;border-radius:22px;border:6px solid transparent;background:#000;box-shadow:0 20px 40px rgba(0,0,0,.45); background-image: linear-gradient(#000, #000), var(--tri-gradient); background-origin: padding-box, border-box; background-clip: padding-box, border-box;}
  .community-banner img.bg{width:100%;opacity:.45;filter:saturate(1.05) contrast(1.02)}
  .community-banner .overlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;padding:24px}
  .pair{display:flex;gap:16px;flex-wrap:wrap;justify-content:center}

  /* Kick stream (true 16:9) */
  .square{position:relative;width:100%;max-width:900px;margin:0 auto;aspect-ratio:16/9;border-radius:16px;overflow:hidden}
  .square iframe,.square .placeholder{position:absolute;inset:0;width:100%;height:100%;border:0;border-radius:16px}
  .square .placeholder{display:grid;place-items:center;background:#0b0d0e;border:0}

  /* Carousel */
  .carousel{position:relative;overflow:visible;border:6px solid transparent;border-radius:16px; background-image: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0)), var(--tri-gradient); background-origin: padding-box, border-box; background-clip: padding-box, border-box;}
  .carousel .viewport{position:relative;width:100%;min-height:400px;overflow:hidden;touch-action:none;cursor:grab;background:#0b0d0e;display:flex;align-items:center;border-radius:12px}
  .carousel .viewport.grabbing{cursor:grabbing}
  .slides{display:flex;will-change:transform;transition:transform .7s var(--ease-spring);align-items:center}
  .slides img{width:100%;height:auto;flex:0 0 100%;object-fit:contain; user-select:none;-webkit-user-drag:none;pointer-events:none;background:#0b0d0e; transform-origin:center center;display:block;max-height:600px}

  /* Carousel Navigation Arrows */
  .carousel-arrow{position:absolute;top:50%;transform:translateY(-50%);z-index:10;width:56px;height:56px;border-radius:50%;border:3px solid transparent;background:linear-gradient(#0b0d0e, #0b0d0e) padding-box, var(--tri-gradient) border-box;color:var(--gold);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s var(--ease-spring);opacity:0.7;backdrop-filter:blur(10px)}
  .carousel-arrow:hover{opacity:1;transform:translateY(-50%) scale(1.1);box-shadow:0 8px 24px rgba(0,0,0,0.5), 0 0 20px rgba(237,183,35,0.3)}
  .carousel-arrow:active{transform:translateY(-50%) scale(0.95)}
  .carousel-arrow-left{left:-28px}
  .carousel-arrow-right{right:-28px}
  .carousel-arrow svg{filter:drop-shadow(0 2px 4px rgba(0,0,0,0.8))}

  /* Hide arrows on mobile/tablet */
  @media (max-width: 1024px) {
    .carousel-arrow{display:none}
  }

  .dots{display:flex;gap:8px;justify-content:center;margin-top:12px}
  .dot{width:16px;height:16px;border-radius:50%;background:#000;border:3px solid transparent;background-image:linear-gradient(#000, #000), var(--tri-gradient);background-origin:padding-box, border-box;background-clip:padding-box, border-box;opacity:1;transition:all .25s var(--ease-spring);cursor:pointer}
  .dot:hover{transform:scale(1.1)}
  .dot.active{background-image:linear-gradient(var(--gold), var(--gold)), var(--tri-gradient);transform:scale(1.15);box-shadow:0 0 12px rgba(237,183,35,0.6)}
  footer{border-top:6px solid transparent; border-image: var(--tri-gradient) 1}

  /* Scroll reveal */
  .reveal{opacity:1; transform:translateY(0) scale(1); filter:blur(0)}
  .reveal.in{opacity:1; transform:translateY(0) scale(1); filter:blur(0); transition:opacity .6s var(--ease-spring), transform .6s var(--ease-spring), filter .6s var(--ease-spring)}

  /* Reduced motion */
  @media (prefers-reduced-motion:reduce){
    html{scroll-behavior:auto}
    .reveal{opacity:1; transform:none; filter:none}
    .slides{transition:none}
    .btn, .card, .tile .face{transition:none}
  }

  /* Buy drawer + FAB base styles used by JS */
  .fab-buy{
    position:fixed; right:20px; bottom:calc(20px + env(safe-area-inset-bottom)); z-index:60;
    display:inline-flex; align-items:center; justify-content:center; gap:.6rem;
    font:900 20px/1 "Luckiest Guy","Arial Black",Impact,system-ui,sans-serif;
    padding:16px 24px; border-radius:999px; color:#000; background:var(--gold);
    border:none; box-shadow:0 10px 0 #9b7a0d, 0 18px 24px rgba(0,0,0,.35), 0 0 0 4px var(--stripe-purple), 0 0 0 4px var(--stripe-yellow), 0 0 0 4px var(--stripe-green);
    background-image: linear-gradient(var(--gold), var(--gold)), var(--tri-gradient);
    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
    border: 4px solid transparent;
    transition:transform .12s var(--ease-spring), filter .15s ease;
  }
  .fab-buy:hover{filter:brightness(1.05)}
  .fab-buy:active{transform:translateY(2px)}

  /* Disconnect button inside drawer */
  .drawer-disconnect-btn {
    display:flex; align-items:center; justify-content:center; gap:.6rem;
    font:900 18px/1 "Luckiest Guy","Arial Black",Impact,system-ui,sans-serif;
    padding:14px 20px; border-radius:20px; color:#fff; background:var(--accent);
    border: 3px solid transparent;
    box-shadow:0 6px 0 #7b2a20, 0 8px 16px rgba(0,0,0,.35);
    transition:all .2s ease;
    cursor:pointer;
    width:100%;
    margin-top:8px;
    margin-bottom:0;
    text-transform:uppercase;
    background-image: linear-gradient(var(--accent), var(--accent)), var(--tri-gradient);
    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
  }

  #drawerDisconnectContainer {
    margin-top: auto;
    padding-top: 8px;
  }
  .drawer-disconnect-btn:hover{
    filter:brightness(1.15);
    transform:translateY(-2px);
    box-shadow:0 8px 0 #7b2a20, 0 10px 20px rgba(0,0,0,.45);
  }
  .drawer-disconnect-btn:active{transform:translateY(0); box-shadow:0 2px 0 #7b2a20, 0 4px 10px rgba(0,0,0,.35);}

  .drawer{
    position:fixed; top:0; right:0; bottom:0;
    width:min(420px, calc(100% - 72px));
    background:linear-gradient(180deg,#141619 0%, #0e1013 100%);
    border-left:6px solid;
    border-image: linear-gradient(to bottom, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%) 1;
    z-index:70;
    transform:translateX(102%); transition:transform .38s var(--ease-spring);
    box-shadow:-24px 0 40px rgba(0,0,0,.55);
    display:flex; flex-direction:column;
  }
  .drawer.open{ transform:translateX(0) }
  .drawer-scrim{ position:fixed; inset:0; background:rgba(0,0,0,.55); backdrop-filter:blur(2px); z-index:65 }
  .drawer-head{ flex-shrink:0; display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 18px; padding-top:calc(88px + env(safe-area-inset-top)); border-bottom:4px solid; border-image: linear-gradient(to right, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%) 1; background:linear-gradient(180deg, rgba(237,183,35,0.12) 0%, #1a1d22 100%); z-index:71 }
  .drawer-body{ flex:1; padding:20px; padding-bottom:calc(220px + env(safe-area-inset-bottom)); overflow:auto; display:flex; flex-direction:column; gap:20px }

  .drawer-close-btn{
    position:relative;
    width:48px;
    height:48px;
    border-radius:50%;
    background:linear-gradient(135deg, var(--gold) 0%, #d4a617 100%);
    color:#000;
    border:3px solid rgba(255,255,255,.5);
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 4px 16px rgba(237,183,35,.5), 0 0 0 2px rgba(0,0,0,.3), inset 0 1px 0 rgba(255,255,255,.3);
    transition:all .25s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight:900;
    font-size:26px;
    flex-shrink:0;
  }
  .drawer-close-btn:hover{
    background:linear-gradient(135deg, #ffd700 0%, var(--gold) 100%);
    border-color:rgba(255,255,255,.7);
    transform:scale(1.1) rotate(90deg);
    box-shadow:0 6px 20px rgba(237,183,35,.7), 0 0 0 3px rgba(237,183,35,.2), inset 0 1px 0 rgba(255,255,255,.4);
  }
  .drawer-close-btn:active{
    transform:scale(0.9) rotate(90deg);
    box-shadow:0 2px 10px rgba(237,183,35,.6), 0 0 0 2px rgba(237,183,35,.15);
  }

  /* BEAR Space Popup Teaser */
  .bear-space-popup {
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,.75);
    backdrop-filter: blur(8px);
    opacity: 0;
    pointer-events: none;
    transition: opacity .3s var(--ease-spring);
  }
  .bear-space-popup.show {
    opacity: 1;
    pointer-events: auto;
  }
  .bear-space-popup-content {
    position: relative;
    padding: 40px 48px;
    border-radius: 28px;
    background: radial-gradient(600px 300px at 50% 0%, rgba(93, 63, 211, 0.25), transparent 70%),
                radial-gradient(400px 200px at 50% 100%, rgba(237,183,35,0.15), transparent 60%),
                #0b0d0e;
    box-shadow: 0 24px 48px rgba(0,0,0,.65), 0 0 0 1px rgba(255,255,255,.05) inset;
    text-align: center;
    max-width: 420px;
    isolation: isolate;
    transform: scale(0.8) translateY(30px);
    transition: transform .4s var(--ease-spring);
  }
  .bear-space-popup.show .bear-space-popup-content {
    transform: scale(1) translateY(0);
  }
  .bear-space-popup-content::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 28px;
    padding: 4px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: 0;
    opacity: 1;
  }
  .bear-space-icon {
    font-size: 72px;
    line-height: 1;
    margin-bottom: 16px;
    filter: drop-shadow(0 4px 8px rgba(0,0,0,.4));
    animation: floatBear 3s ease-in-out infinite;
  }
  @keyframes floatBear {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    25% { transform: translateY(-8px) rotate(-3deg); }
    50% { transform: translateY(-12px) rotate(0deg); }
    75% { transform: translateY(-8px) rotate(3deg); }
  }

  /* Hero Character Idle Animation */
  #heroCharacter {
    animation: heroBreathing 4s ease-in-out infinite;
    transform-origin: center bottom;
  }
  @keyframes heroBreathing {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-6px) scale(1.02); }
  }

  .bear-space-title {
    font-size: 48px;
    font-weight: 900;
    color: var(--gold);
    text-shadow: 0 4px 0 rgba(0,0,0,.4), 0 0 24px rgba(237,183,35,.5);
    margin-bottom: 8px;
    letter-spacing: 2px;
  }
  .bear-space-subtitle {
    font-size: 24px;
    font-weight: 800;
    color: var(--stripe-purple);
    text-shadow: 0 2px 4px rgba(0,0,0,.6);
    margin-bottom: 20px;
    text-transform: uppercase;
  }
  .bear-space-description {
    font-size: 18px;
    font-weight: 600;
    color: rgba(255,255,255,.85);
    line-height: 1.4;
    text-shadow: 0 2px 4px rgba(0,0,0,.4);
  }

  /* Success Popup - Bubbly and Meme-y */
  .bear-success-popup {
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,.8);
    backdrop-filter: blur(10px);
    opacity: 0;
    pointer-events: none;
    transition: opacity .4s ease;
  }
  .bear-success-popup.show {
    opacity: 1;
    pointer-events: auto;
  }
  .bear-success-popup-content {
    position: relative;
    padding: 48px 56px;
    border-radius: 32px;
    background: radial-gradient(600px 300px at 50% 0%, rgba(237,183,35,0.3), transparent 70%),
                linear-gradient(135deg, #edb723, #f4a623);
    box-shadow: 0 32px 64px rgba(237,183,35,.4), 0 0 0 4px rgba(255,255,255,.2) inset;
    text-align: center;
    max-width: 480px;
    transform: scale(0.5) translateY(50px) rotate(-5deg);
    transition: transform .6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    animation: bounce 0.8s ease infinite alternate;
  }
  .bear-success-popup.show .bear-success-popup-content {
    transform: scale(1) translateY(0) rotate(0deg);
  }
  @keyframes bounce {
    0% { transform: scale(1) translateY(0) rotate(0deg); }
    100% { transform: scale(1.05) translateY(-10px) rotate(1deg); }
  }
  .bear-success-icon {
    font-size: 96px;
    line-height: 1;
    margin-bottom: 20px;
    filter: drop-shadow(0 8px 16px rgba(0,0,0,.5));
    animation: spin-celebrate 1.5s ease-in-out infinite;
  }
  @keyframes spin-celebrate {
    0%, 100% { transform: rotate(0deg) scale(1); }
    25% { transform: rotate(-15deg) scale(1.1); }
    50% { transform: rotate(0deg) scale(1.2); }
    75% { transform: rotate(15deg) scale(1.1); }
  }
  .bear-success-title {
    font-size: 56px;
    font-weight: 900;
    color: #000;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 16px;
    text-shadow: 3px 3px 0 rgba(255,255,255,.5), -2px -2px 0 rgba(0,0,0,.2);
    line-height: 1.1;
  }
  .bear-success-message {
    font-size: 22px;
    font-weight: 700;
    color: #000;
    margin-bottom: 16px;
    line-height: 1.4;
  }
  .bear-success-sub {
    font-size: 28px;
    font-weight: 900;
    color: #fff;
    text-shadow: 2px 2px 4px rgba(0,0,0,.4);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .btn.sm{ font-size:26px; padding:1.2rem 1.8rem; border-radius:28px; box-shadow:0 10px 0 #000,0 16px 24px rgba(0,0,0,.35) }

  .price-card{
    position: relative;
    display:grid; gap:12px; padding:28px;
    border-radius:28px;
    background:radial-gradient(500px 200px at 50% -20%, rgba(237,183,35,.1), transparent 60%), #0b0d0e;
    box-shadow:0 12px 22px rgba(0,0,0,.35)
  }
  .price-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 16px;
    padding: 6px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: -1;
  }
  .price-card .metric{ font-size:52px; font-weight:900; display:flex; align-items:baseline; gap:10px }
  .price-card .metric small{ opacity:.8; font-size:24px }
  .price-card .sub{ opacity:.9; font-size:20px }

  /* Portfolio Card */
  .portfolio-card{
    position: relative;
    padding:32px;
    border-radius:28px;
    background:radial-gradient(500px 200px at 50% -20%, rgba(118,174,255,.12), transparent 60%), #0b0d0e;
    box-shadow:0 12px 22px rgba(0,0,0,.35);
    transition:transform 0.2s ease, box-shadow 0.2s ease;
    isolation: isolate;
  }
  .portfolio-card:hover{
    transform:translateY(-2px);
    box-shadow:0 16px 32px rgba(0,0,0,.45);
  }
  .portfolio-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 28px;
    padding: 4px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: 0;
    opacity: 1;
  }

  /* Profile Card */
  .profile-card{
    position: relative;
    padding:32px;
    border-radius:28px;
    background:radial-gradient(500px 200px at 50% -20%, rgba(237,183,35,.08), transparent 60%), #0b0d0e;
    box-shadow:0 12px 22px rgba(0,0,0,.35);
    transition:transform 0.2s ease, box-shadow 0.2s ease;
    isolation: isolate;
  }
  .profile-card:hover{
    transform:translateY(-2px);
    box-shadow:0 16px 32px rgba(0,0,0,.45);
  }

  /* Pulsing highlight animation for profile section */
  @keyframes profile-pulse {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(237,183,35,0.9), 0 12px 22px rgba(0,0,0,.35);
      transform: scale(1);
    }
    50% {
      box-shadow: 0 0 0 15px rgba(237,183,35,0), 0 16px 32px rgba(237,183,35,.4);
      transform: scale(1.02);
    }
  }
  .profile-highlight-pulse {
    animation: profile-pulse 1.5s ease-in-out infinite !important;
    border: 3px solid var(--gold) !important;
  }

  /* Better input field interactions */
  #profileUsername:focus {
    outline: none !important;
    border-color: var(--gold) !important;
    box-shadow: 0 0 0 4px rgba(237,183,35,0.3) !important;
    transform: scale(1.02);
  }
  #profileAvatarSelector {
    transition: all 0.3s ease;
  }
  #profileAvatarSelector:hover {
    border-color: var(--gold);
    transform: translateY(-2px);
  }
  .profile-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 28px;
    padding: 4px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: 0;
    opacity: 1;
  }

  .portfolio-stats{ display:grid; gap:12px }
  .stat-row{
    display:flex; justify-content:space-between; align-items:center;
    padding:14px 16px; background:rgba(255,255,255,.03); border-radius:12px;
    border:2px solid rgba(255,255,255,.08)
  }
  .stat-label{ font-size:22px; opacity:.85 }
  .stat-value{ font-size:32px; font-weight:900; color:var(--gold) }

  /* Points Card */
  .points-card{
    padding:28px;
  border:4px solid transparent; border-radius:28px;
    background:radial-gradient(500px 200px at 50% -20%, rgba(237,183,35,.08), transparent 60%), #0b0d0e;
    box-shadow:0 12px 22px rgba(0,0,0,.35);
    background-image: radial-gradient(500px 200px at 50% -20%, rgba(237,183,35,.08), transparent 60%), linear-gradient(#0b0d0e, #0b0d0e), var(--tri-gradient);
    background-origin: padding-box, padding-box, border-box;
    background-clip: padding-box, padding-box, border-box;
  }
  .points-card .activity-item{
    padding:16px 18px; background:rgba(255,255,255,.03); border-radius:14px;
    border-left:4px solid var(--gold); margin-bottom:10px; font-size:20px;
    display:flex; justify-content:space-between; align-items:center
  }
  .points-card .activity-item .points{ color:var(--gold); font-weight:900; font-size:24px }

  .links-grid{ display:grid; grid-template-columns:1fr 1fr; gap:14px }
  .links-grid .tile .lbl{ color:var(--gold) }
  @media (max-width:520px){ .links-grid{ grid-template-columns:1fr } }

  /* === User-requested removals === */
  .site-nav{display:none !important}
  .rails::before,.rails::after{display:none !important}

  /* ===== NEW FIXED NAVIGATION BAR ===== */
  .top-nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 9999;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  }

  /* Three-color stripe background */
  .top-nav-stripes {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    z-index: -1;
  }
  .top-nav-stripes .stripe-1 {
    flex: 1;
    background: #680cd9;
  }
  .top-nav-stripes .stripe-2 {
    flex: 1;
    background: #feb501;
  }
  .top-nav-stripes .stripe-3 {
    flex: 1;
    background: #07ae08;
  }

  /* Main nav bar */
  .top-nav-bar {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 24px;
    max-width: 1400px;
    margin: 0 auto;
  }

  /* Menu button with logo */
  .menu-btn {
    display: flex;
    align-items: center;
    position: relative;
    background: none;
    cursor: pointer;
    padding: 0;
    border-radius: 12px;
    transition: all 0.2s;
    border: 4px solid transparent;
    background-image: linear-gradient(#141619, #141619), var(--tri-gradient);
    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
    filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
  }

  .menu-btn:hover {
    transform: scale(1.05);
    filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.9));
  }

  .menu-btn img {
    width: 52px;
    height: 52px;
    display: block;
    border-radius: 8px;
  }

  /* Hamburger icon overlay */
  .menu-btn::after {
    content: '';
    position: absolute;
    bottom: -4px;
    right: -4px;
    width: 24px;
    height: 24px;
    background: #edb723;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    background-image:
      linear-gradient(#000 0%, #000 100%),
      linear-gradient(#000 0%, #000 100%),
      linear-gradient(#000 0%, #000 100%);
    background-size: 14px 2px;
    background-position: center calc(50% - 5px), center 50%, center calc(50% + 5px);
    background-repeat: no-repeat;
  }

  /* Nav buttons container */
  .nav-buttons-container {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  /* Honey points button - dark with tri-color border */
  .honey-points-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: #1a1a1a;
    color: var(--gold);
    border: 3px solid transparent;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 900;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 0 #000, 0 4px 12px rgba(0,0,0,0.8);
    filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
    background-image: linear-gradient(#1a1a1a, #1a1a1a), var(--tri-gradient);
    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
  }

  .honey-points-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 #000, 0 6px 18px rgba(0,0,0,0.9);
    filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.9));
    background: #252525;
  }

  .honey-points-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 0 #000, 0 2px 8px rgba(0,0,0,0.6);
  }

  /* Welcome profile button - purple with tri-color border */
  .welcome-profile-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: #5D3FD3;
    color: #fff;
    border: 3px solid transparent;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 900;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 0 #000, 0 4px 12px rgba(0,0,0,0.8);
    filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
    background-image: linear-gradient(#5D3FD3, #5D3FD3), var(--tri-gradient);
    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
  }

  .welcome-profile-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 #000, 0 6px 18px rgba(0,0,0,0.9);
    filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.9));
    background: #6D4FE3;
  }

  .welcome-profile-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 0 #000, 0 2px 8px rgba(0,0,0,0.6);
  }

  .welcome-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid transparent;
    background-image: linear-gradient(#fff, #fff), var(--tri-gradient);
    background-origin: padding-box, border-box;
    background-clip: padding-box, border-box;
    margin-left: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.4);
  }

  /* Hamburger menu overlay */
  .menu-overlay {
    position: fixed;
    top: 0;
    left: -100%;
    width: 100%;
    max-width: 400px;
    height: 100vh;
    background: linear-gradient(180deg, #141619 0%, #0e1013 100%);
    box-shadow: 4px 0 24px rgba(0,0,0,0.5);
    z-index: 10000;
    transition: left 0.3s var(--ease-spring);
    overflow-y: auto;
    border-right: 6px solid;
    border-image: linear-gradient(to bottom, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%) 1;
  }

  .menu-overlay.open {
    left: 0;
  }

  .menu-overlay-header {
    padding: 20px;
    background: #0f1114;
    border-bottom: 4px solid;
    border-image: linear-gradient(to right, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%) 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .menu-overlay-header h2 {
    margin: 0;
    color: var(--gold);
    font-size: 24px;
  }

  .menu-close-btn {
    background: none;
    border: none;
    color: var(--gold);
    font-size: 32px;
    cursor: pointer;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.2s;
  }

  .menu-close-btn:hover {
    background: rgba(237,183,35,0.1);
  }

  .menu-items {
    padding: 16px;
    display: grid;
    gap: 10px;
  }

  .menu-item {
    position: relative;
    display: block;
    padding: 18px 20px;
    background: radial-gradient(500px 200px at 50% -20%, rgba(237,183,35,0.08), transparent 60%), #0b0d0e;
    border-radius: 16px;
    color: var(--gold);
    font-size: 16px;
    font-weight: 900;
    text-transform: uppercase;
    transition: all 0.2s;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.35);
    text-decoration: none;
    opacity: 0;
    transform: translateX(-20px);
    animation: slideInStagger 0.4s var(--ease-spring) forwards;
  }
  .menu-item:nth-child(1) { animation-delay: 0.05s; }
  .menu-item:nth-child(2) { animation-delay: 0.1s; }
  .menu-item:nth-child(3) { animation-delay: 0.15s; }
  .menu-item:nth-child(4) { animation-delay: 0.2s; }
  .menu-item:nth-child(5) { animation-delay: 0.25s; }
  .menu-item:nth-child(6) { animation-delay: 0.3s; }
  .menu-item:nth-child(7) { animation-delay: 0.35s; }
  .menu-item:nth-child(8) { animation-delay: 0.4s; }

  @keyframes slideInStagger {
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  .menu-item::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 16px;
    padding: 6px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: -1;
  }

  .menu-item:hover {
    background: radial-gradient(500px 200px at 50% -20%, rgba(237,183,35,0.15), transparent 60%), #0b0d0e;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.45);
  }

  .menu-item-icon {
    margin-right: 12px;
    font-size: 20px;
  }

  /* Scrim for menu */
  .menu-scrim {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0,0,0,0.7);
    z-index: 9998;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }

  .menu-scrim.open {
    opacity: 1;
    pointer-events: all;
  }

  /* Adjust body padding for fixed nav */
  body {
    padding-top: 72px;
  }

  @media (max-width: 768px) {
    .menu-overlay {
      max-width: 100%;
    }

    .honey-points-btn,
    .welcome-profile-btn {
      padding: 6px 12px;
      font-size: 11px;
      gap: 4px;
    }

    .nav-buttons-container {
      gap: 8px;
    }

    .menu-btn img {
      width: 40px;
      height: 40px;
    }

    .top-nav-bar {
      padding: 8px 16px;
    }

    .welcome-avatar {
      width: 32px;
      height: 32px;
      margin-left: 6px;
    }
  }

  /* Tablet and larger screens - increase header padding for foldables */
  @media (min-width:768px) and (max-width:1024px){
    #buyDrawer .drawer-head{padding-top:calc(env(safe-area-inset-top,0px) + 105px) !important;}
  }

  /* Make the drawer full-screen on phones & foldables so width isn't the limiter */
  @media (max-width:1024px){
    #buyDrawer{
      left:0 !important; right:0 !important; top:0 !important; bottom:0 !important;
      width:100vw !important; height:100vh !important; border-left:0 !important; border-radius:0 !important;
    }
    .drawer-scrim{display:none !important;}
    #buyDrawer .drawer-head{padding-top:calc(env(safe-area-inset-top,0px) + 70px)}
    #buyDrawer .drawer-body{padding-bottom:calc(env(safe-area-inset-bottom,0px) + 200px); overscroll-behavior:contain}
  }

  /* Phone-specific adjustments for smaller devices like iPhone SE */
  @media (max-width:667px){
    #buyDrawer .drawer-body{padding-bottom:calc(env(safe-area-inset-bottom,0px) + 180px) !important;}
  }

  /* Use dynamic viewport height where supported */
  @supports (height: 100dvh){
    #buyDrawer{height:100dvh}
  }

  /* ===== BEAR OVERVIEW SECTION (DexScreener Style) ===== */
  .dex-layout{
    display:grid;
    grid-template-columns:1fr 360px;
    gap:20px;
    margin-top:24px;
  }
  @media(max-width:1100px){
    .dex-layout{grid-template-columns:1fr;}
    .dex-stats-sidebar{order:-1;}
  }

  .dex-chart-container{
    min-height:600px;
  }

  .dex-stats-sidebar{
    display:flex;
    flex-direction:column;
  }

  /* Stats List (DexScreener style) */
  .stats-list{
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .stat-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 14px;
    background:rgba(237,183,35,0.05);
    border-radius:8px;
    border:1px solid rgba(237,183,35,0.15);
    transition:all 0.2s;
  }

  .stat-item:hover{
    background:rgba(237,183,35,0.08);
    border-color:rgba(237,183,35,0.25);
  }

  .stat-label{
    font-size:15px;
    color:#fff;
    opacity:0.7;
    text-transform:uppercase;
    letter-spacing:0.5px;
    font-weight:700;
  }

  .stat-value{
    font-size:20px;
    font-weight:900;
    color:var(--gold);
    text-align:right;
  }

  /* ===== BEAR HONEY POINTS SECTION ===== */
  .honey-points-grid{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:24px;
    margin-top:24px;
    max-width:1400px;
    margin-left:auto;
    margin-right:auto;
  }
  @media(max-width:1200px){
    .honey-points-grid{grid-template-columns:1fr;}
  }

  .honey-card{
    position: relative;
    background:var(--card);
    border-radius:16px;
    padding:20px;
    box-shadow:var(--elev);
    margin-bottom:20px;
  }
  .honey-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 16px;
    padding: 6px;
    background: linear-gradient(135deg, var(--stripe-purple) 0%, var(--stripe-purple) 33.33%, var(--stripe-yellow) 33.33%, var(--stripe-yellow) 66.66%, var(--stripe-green) 66.66%, var(--stripe-green) 100%);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    z-index: 0;
  }

  .honey-card-title{
    margin:0 0 16px 0;
    font-size:22px;
    font-weight:900;
    color:var(--gold);
    text-transform:uppercase;
    letter-spacing:0.5px;
  }

  /* Price Stats Grid */
  .price-stats-grid{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:12px;
  }
  @media(max-width:768px){
    .price-stats-grid{grid-template-columns:repeat(2, 1fr);}
  }

  .price-stat{
    background:rgba(237,183,35,0.08);
    padding:14px;
    border-radius:10px;
    border:2px solid rgba(237,183,35,0.2);
  }

  .price-stat-label{
    font-size:12px;
    color:#fff;
    opacity:0.9;
    margin-bottom:6px;
    text-transform:uppercase;
    letter-spacing:0.5px;
  }

  .price-stat-value{
    font-size:20px;
    font-weight:900;
    color:var(--gold);
  }

  /* Chart Container */
  .chart-container{
    background:rgba(0,0,0,0.3);
    border-radius:12px;
    overflow:hidden;
    border:2px solid rgba(0,0,0,0.5);
  }
  .chart-container iframe{
    display:block;
  }

  /* Liquidity Grid */
  .liquidity-grid{
    display:grid;
    gap:12px;
  }

  .liquidity-stat{
    display:flex;
    align-items:center;
    gap:14px;
    background:rgba(237,183,35,0.08);
    padding:16px;
    border-radius:10px;
    border:2px solid rgba(237,183,35,0.2);
  }

  .liquidity-icon{
    font-size:32px;
    line-height:1;
  }

  .liquidity-label{
    font-size:12px;
    color:#fff;
    opacity:0.9;
    margin-bottom:4px;
    text-transform:uppercase;
    letter-spacing:0.5px;
  }

  .liquidity-value{
    font-size:20px;
    font-weight:900;
    color:var(--gold);
  }

  /* My Points Card */
  .my-points-card{
    background:linear-gradient(135deg, rgba(237,183,35,0.15), rgba(215,92,70,0.15));
    border:3px solid var(--gold);
  }

  .points-hero{
    text-align:center;
    padding:24px;
    background:rgba(0,0,0,0.4);
    border-radius:12px;
    margin-bottom:16px;
    border:2px solid rgba(237,183,35,0.3);
  }

  .points-hero-value{
    font-size:56px;
    font-weight:900;
    color:var(--gold);
    line-height:1;
    text-shadow:0 2px 8px rgba(237,183,35,0.5);
  }

  .points-hero-label{
    font-size:14px;
    margin-top:8px;
    opacity:0.8;
    text-transform:uppercase;
    letter-spacing:1px;
  }

  /* Points Breakdown */
  .points-breakdown{
    display:flex;
    flex-direction:column;
    gap:12px;
    margin-bottom:16px;
  }

  .points-breakdown-item{
    display:flex;
    align-items:center;
    gap:16px;
    padding:16px;
    background:rgba(0,0,0,0.3);
    border-radius:12px;
    border:2px solid rgba(237,183,35,0.2);
    transition:all 0.3s ease;
  }

  .points-breakdown-item:hover{
    border-color:rgba(237,183,35,0.4);
    transform:translateX(4px);
  }

  .points-breakdown-icon{
    font-size:32px;
    line-height:1;
  }

  .points-breakdown-content{
    flex:1;
  }

  .points-breakdown-label{
    font-size:14px;
    opacity:0.8;
    margin-bottom:4px;
    text-transform:uppercase;
    letter-spacing:0.5px;
  }

  .points-breakdown-value{
    font-size:24px;
    font-weight:900;
    color:var(--gold);
  }

  /* Daily Game Progress Widget */
  .daily-game-progress{
    background:linear-gradient(135deg, rgba(237,183,35,0.1) 0%, rgba(255,215,0,0.05) 100%);
    border:2px solid rgba(237,183,35,0.3);
    border-radius:16px;
    padding:20px;
    margin:20px 0;
    transition:all 0.3s ease;
  }

  .daily-game-progress:hover{
    border-color:rgba(237,183,35,0.5);
    transform:translateY(-2px);
    box-shadow:0 8px 24px rgba(237,183,35,0.2);
  }

  .daily-progress-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:12px;
  }

  .daily-progress-title{
    font-size:16px;
    font-weight:700;
    color:#fff;
    text-transform:uppercase;
    letter-spacing:0.5px;
  }

  .daily-progress-count{
    font-size:20px;
    font-weight:900;
    color:var(--gold);
    text-shadow:0 0 10px rgba(237,183,35,0.5);
  }

  .daily-progress-bar-container{
    height:12px;
    background:rgba(0,0,0,0.3);
    border-radius:20px;
    overflow:hidden;
    margin-bottom:12px;
    border:1px solid rgba(237,183,35,0.2);
  }

  .daily-progress-bar{
    height:100%;
    background:linear-gradient(90deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
    border-radius:20px;
    transition:width 0.6s cubic-bezier(0.65, 0, 0.35, 1);
    box-shadow:0 0 20px rgba(255,215,0,0.6), inset 0 1px 0 rgba(255,255,255,0.3);
    position:relative;
    background-size:200% 100%;
    animation:shimmer 2s infinite;
  }

  @keyframes shimmer{
    0%{ background-position:0% 50%; }
    50%{ background-position:100% 50%; }
    100%{ background-position:0% 50%; }
  }

  /* Shimmer Skeleton Loaders */
  .skeleton {
    background: linear-gradient(90deg, rgba(237,183,35,0.1) 0%, rgba(237,183,35,0.2) 50%, rgba(237,183,35,0.1) 100%);
    background-size: 200% 100%;
    animation: shimmer 2s infinite;
    border-radius: 8px;
    position: relative;
    overflow: hidden;
  }
  .skeleton::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.1) 50%, transparent 100%);
    animation: shimmerSlide 2s infinite;
  }
  @keyframes shimmerSlide {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
  .skeleton-text {
    height: 20px;
    margin-bottom: 10px;
  }
  .skeleton-title {
    height: 32px;
    width: 60%;
    margin-bottom: 16px;
  }
  .skeleton-card {
    height: 200px;
    width: 100%;
  }
  .skeleton-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
  }

  .daily-progress-info{
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size:13px;
  }

  .daily-progress-points{
    color:var(--gold);
    font-weight:700;
    text-shadow:0 0 10px rgba(237,183,35,0.3);
  }

  .daily-progress-remaining{
    color:rgba(255,255,255,0.7);
    font-weight:600;
  }

  .points-rank{
    text-align:center;
    padding:12px;
    background:rgba(0,0,0,0.3);
    border-radius:8px;
    margin-bottom:12px;
    font-size:14px;
  }

  .points-rank strong{
    color:var(--gold);
    font-size:16px;
  }

  .points-twitter{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    padding:10px;
    background:rgba(29,155,240,0.1);
    border-radius:8px;
    border:2px solid rgba(29,155,240,0.3);
  }

  .points-cta{
    text-align:center;
    padding:24px;
  }

  /* Leaderboard */
  .leaderboard-card{
    max-height:600px;
    display:flex;
    flex-direction:column;
  }

  .leaderboard{
    flex:1;
    overflow-y:auto;
    margin:-8px;
    padding:8px;
  }

  .leaderboard::-webkit-scrollbar{
    width:8px;
  }

  .leaderboard::-webkit-scrollbar-track{
    background:rgba(0,0,0,0.2);
    border-radius:4px;
  }

  .leaderboard::-webkit-scrollbar-thumb{
    background:var(--gold);
    border-radius:4px;
  }

  .leaderboard-loading{
    text-align:center;
    padding:32px;
    opacity:0.6;
  }

  .leaderboard-item{
    display:flex;
    align-items:center;
    gap:12px;
    padding:12px;
    background:rgba(237,183,35,0.08);
    border-radius:10px;
    border:2px solid rgba(237,183,35,0.2);
    margin-bottom:8px;
    transition:all 0.2s var(--ease-spring);
    opacity: 0;
    transform: translateY(10px);
    animation: fadeInUp 0.4s var(--ease-spring) forwards;
  }
  .leaderboard-item:nth-child(1) { animation-delay: 0.05s; }
  .leaderboard-item:nth-child(2) { animation-delay: 0.1s; }
  .leaderboard-item:nth-child(3) { animation-delay: 0.15s; }
  .leaderboard-item:nth-child(4) { animation-delay: 0.2s; }
  .leaderboard-item:nth-child(5) { animation-delay: 0.25s; }
  .leaderboard-item:nth-child(6) { animation-delay: 0.3s; }
  .leaderboard-item:nth-child(7) { animation-delay: 0.35s; }
  .leaderboard-item:nth-child(8) { animation-delay: 0.4s; }
  .leaderboard-item:nth-child(9) { animation-delay: 0.45s; }
  .leaderboard-item:nth-child(10) { animation-delay: 0.5s; }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .leaderboard-item:hover{
    background:rgba(237,183,35,0.15);
    border-color:rgba(237,183,35,0.4);
    transform:translateX(4px);
  }

  .leaderboard-rank{
    font-size:20px;
    font-weight:900;
    color:var(--gold);
    min-width:32px;
    text-align:center;
  }

  .leaderboard-rank.top-3{
    font-size:24px;
  }

  .leaderboard-user{
    flex:1;
    min-width:0;
  }

  .leaderboard-username{
    font-weight:900;
    font-size:14px;
    color:var(--gold);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .leaderboard-wallet{
    font-size:11px;
    opacity:0.6;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .leaderboard-points{
    font-size:16px;
    font-weight:900;
    color:var(--honey);
    white-space:nowrap;
  }

  /* Trophy colors for top 3 */
  .leaderboard-item.rank-1 .leaderboard-rank{color:#FFD700;}
  .leaderboard-item.rank-2 .leaderboard-rank{color:#C0C0C0;}
  .leaderboard-item.rank-3 .leaderboard-rank{color:#CD7F32;}

  .leaderboard-item.rank-1{
    background:linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,215,0,0.05));
    border-color:rgba(255,215,0,0.4);
  }

  .leaderboard-item.rank-2{
    background:linear-gradient(135deg, rgba(192,192,192,0.15), rgba(192,192,192,0.05));
    border-color:rgba(192,192,192,0.4);
  }

  .leaderboard-item.rank-3{
    background:linear-gradient(135deg, rgba(205,127,50,0.15), rgba(205,127,50,0.05));
    border-color:rgba(205,127,50,0.4);
  }

  /* Raids Card */
  .raids-card{
    position:relative;
  }

  .admin-raid-btn{
    position:absolute;
    top:-12px;
    left:20px;
    background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color:#fff;
    border:none;
    padding:8px 16px;
    border-radius:8px;
    font-size:12px;
    font-weight:900;
    cursor:pointer;
    text-transform:uppercase;
    letter-spacing:0.5px;
    transition:all 0.3s ease;
    box-shadow:0 4px 12px rgba(102, 126, 234, 0.4);
    z-index:10;
  }
  .admin-raid-btn:hover{
    transform:translateY(-2px) scale(1.05);
    box-shadow:0 6px 20px rgba(102, 126, 234, 0.6);
  }

  .raids-toggle-btn{
    position:absolute;
    top:-12px;
    right:20px;
    background:var(--gold);
    color:#000;
    border:none;
    padding:6px 12px;
    border-radius:6px;
    font-size:11px;
    font-weight:900;
    cursor:pointer;
    text-transform:uppercase;
    letter-spacing:0.5px;
    transition:all 0.2s;
    z-index:10;
  }

  .raids-toggle-btn:hover{
    transform:scale(1.05);
    box-shadow:0 4px 12px rgba(237,183,35,0.4);
  }

  .raids-list{
    display:flex;
    flex-direction:column;
    gap:16px;
    max-height:500px;
    overflow-y:auto;
  }

  .raid-item{
    background:rgba(0,0,0,0.3);
    border:2px solid rgba(237,183,35,0.3);
    border-radius:12px;
    padding:16px;
    transition:all 0.3s;
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .raid-item:hover{
    border-color:rgba(237,183,35,0.5);
    transform:translateY(-2px);
  }

  .raid-profile-header{
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:12px;
  }

  .raid-profile-emoji{
    width:52px;
    height:52px;
    border-radius:50%;
    border:2px solid var(--gold);
    background:linear-gradient(135deg, rgba(237,183,35,0.15), rgba(237,183,35,0.05));
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    flex-shrink:0;
  }

  .raid-profile-pic{
    width:48px;
    height:48px;
    border-radius:50%;
    border:2px solid var(--gold);
    object-fit:cover;
  }

  .raid-profile-info{
    flex:1;
  }

  .raid-profile-name{
    font-size:15px;
    font-weight:900;
    color:var(--gold);
    margin-bottom:2px;
  }

  .raid-profile-handle{
    font-size:13px;
    opacity:0.7;
  }

  .raid-preview-image{
    width:100%;
    height:200px;
    object-fit:cover;
    border-radius:8px;
    border:2px solid rgba(237,183,35,0.2);
  }

  .raid-tweet-preview{
    margin:16px 0;
    padding:12px;
    background:rgba(0,0,0,0.2);
    border-radius:8px;
    border:1px solid rgba(237,183,35,0.2);
    min-height:100px;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:all 0.3s ease;
  }

  .raid-tweet-preview:hover{
    background:rgba(237,183,35,0.1);
    border-color:rgba(237,183,35,0.4);
    transform:translateY(-2px);
  }

  .raid-preview-loading{
    color:rgba(255,255,255,0.5);
    font-size:13px;
    text-align:center;
  }

  .raid-preview-error{
    color:rgba(255,255,255,0.3);
    font-size:13px;
    text-align:center;
    font-style:italic;
  }

  /* Twitter embed styling */
  .raid-tweet-preview{
    position: relative;
  }

  .raid-tweet-preview blockquote{
    margin:0 !important;
  }

  .raid-tweet-preview .twitter-tweet{
    margin:0 auto !important;
  }

  .raid-tweet-click-overlay{
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
    z-index: 10;
    background: transparent;
  }

  .raid-item.completed{
    opacity:0.6;
    border-color:rgba(0,255,0,0.3);
  }

  .raid-item.missed{
    opacity:0.4;
    border-color:rgba(255,0,0,0.3);
  }

  .raid-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:12px;
  }

  .raid-timer{
    font-size:12px;
    font-weight:900;
    color:var(--gold);
    background:rgba(237,183,35,0.1);
    padding:4px 8px;
    border-radius:6px;
  }

  .raid-timer.expired{
    color:#ff6b6b;
    background:rgba(255,0,0,0.1);
  }

  .raid-description{
    font-size:14px;
    line-height:1.5;
    margin-bottom:12px;
    opacity:0.9;
  }

  .raid-footer{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
  }

  .raid-reward{
    font-size:13px;
    font-weight:900;
    color:var(--gold);
  }

  .raid-btn{
    background:linear-gradient(135deg, var(--gold), #d4a127);
    color:#000;
    border:none;
    padding:10px 20px;
    border-radius:8px;
    font-size:14px;
    font-weight:900;
    cursor:pointer;
    text-transform:uppercase;
    letter-spacing:0.5px;
    transition:all 0.3s;
    text-decoration:none;
    display:inline-block;
  }

  .raid-btn:hover{
    transform:scale(1.05);
    box-shadow:0 4px 12px rgba(237,183,35,0.4);
  }

  .raid-btn:disabled{
    opacity:0.5;
    cursor:not-allowed;
    transform:none;
  }

  .raids-empty{
    text-align:center;
    padding:32px;
    opacity:0.7;
  }

  /* Completing state */
  .raid-item.completing{
    border-color:rgba(255,215,0,0.6);
    background:rgba(255,215,0,0.05);
  }

  /* Fade out animation */
  .raid-item.fade-out{
    animation:fadeOutSlide 1s ease-out forwards;
  }

  @keyframes fadeOutSlide{
    0%{
      opacity:1;
      transform:translateY(0) scale(1);
      max-height:500px;
    }
    50%{
      opacity:0.5;
      transform:translateY(-10px) scale(0.98);
    }
    100%{
      opacity:0;
      transform:translateY(-20px) scale(0.95);
      max-height:0;
      margin:0;
      padding:0;
      border:none;
    }
  }

  /* Completing button state */
  .raid-btn.completing{
    background:linear-gradient(135deg, #ffd700, #ffa500);
    pointer-events:none;
    animation:pulse 1.5s ease-in-out infinite;
  }

  @keyframes pulse{
    0%, 100%{
      opacity:1;
    }
    50%{
      opacity:0.7;
    }
  }

  /* Image error handling */
  .raid-profile-pic{
    background:rgba(237,183,35,0.1);
  }

  .raid-preview-image{
    background:rgba(0,0,0,0.3);
  }

  @media(max-width:768px){
    .honey-card{
      padding:16px;
    }
    .price-stats-grid{
      grid-template-columns:1fr;
    }
    .points-hero-value{
      font-size:42px;
    }
    .points-breakdown-item{
      flex-direction:row;
      padding:12px;
    }
    .points-breakdown-icon{
      font-size:28px;
    }
    .points-breakdown-label{
      font-size:12px;
    }
    .points-breakdown-value{
      font-size:20px;
    }
    .chart-container iframe{
      height:400px !important;
    }
  }
  </style>

  <!-- Twitter Widgets Script for Embedded Tweets -->
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</head>
<body>
  <!-- Fixed Top Navigation -->
  <div class="top-nav">
    <div class="top-nav-stripes">
      <div class="stripe-1"></div>
      <div class="stripe-2"></div>
      <div class="stripe-3"></div>
    </div>
    <div class="top-nav-bar">
      <button class="menu-btn" onclick="toggleMenu()" aria-label="Open menu">
        <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/1z14d9.jpg" alt="BEAR Park" width="52" height="52">
      </button>
      <div class="nav-buttons-container">
        <button class="honey-points-btn" onclick="window.scrollTo({top: document.getElementById('honey-points').offsetTop - 80, behavior: 'smooth'})">
          <span id="welcomePoints">HONEY <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;">: 0 PTS</span>
        </button>
        <button class="welcome-profile-btn" id="welcomeBtn">
          <span id="welcomeUsername">WELCOME BEAR (click me!)</span>
          <img class="welcome-avatar" id="welcomeAvatar" style="display: none;" alt="Profile Avatar" width="40" height="40">
        </button>
      </div>
    </div>
  </div>

  <!-- Menu Overlay -->
  <div class="menu-scrim" id="menuScrim" onclick="toggleMenu()"></div>
  <div class="menu-overlay" id="menuOverlay">
    <div class="menu-overlay-header">
      <h2>ðŸ» BEAR PARK</h2>
      <button class="menu-close-btn" onclick="toggleMenu()" aria-label="Close menu">&times;</button>
    </div>
    <div class="menu-items">
      <a href="#bear-overview" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">ðŸ“Š</span>BEAR OVERVIEW
      </a>
      <a href="#honey-points" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1.2em; width:auto; display:inline-block;"></span>BEAR HONEY POINTS
      </a>
      <a href="#bearcade" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">ðŸŽ®</span>BEARCADE
      </a>
      <a href="#leaderboards" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">ðŸ†</span>LEADERBOARDS
      </a>
      <a href="#bg123" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">ðŸ“–</span>BG123 LORE
      </a>
      <a href="#nfts" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">ðŸ–¼ï¸</span>NFT COLLECTIONS
      </a>
      <a href="#community" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">ðŸ‘¥</span>COMMUNITY
      </a>
      <a href="#memes" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">ðŸŽ­</span>5D MEMES
      </a>
      <a href="#network" class="menu-item" onclick="toggleMenu()">
        <span class="menu-item-icon">ðŸ’°</span>BUY $BEAR
      </a>
    </div>
  </div>

  <a class="skip-link" href="#bearcade">Skip to BEARcade</a>

  <!-- Sticky nav -->
  <div class="site-nav" role="navigation" aria-label="Primary">
    <div class="progress" id="progress"></div>
    <div class="bar">
      <a class="brand" href="#top" aria-label="BEAR Park Home">
        <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/25ekkd.png" width="72" height="72" alt="BEAR Park logo" loading="eager" decoding="sync" />
        <span>BEAR Park</span>
      </a>
      <nav class="links" aria-label="Sections">
        <a href="#honey-points"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;"> Honey Points</a>
        <a href="#bearcade">BEARcade</a>
        <a href="#leaderboards">ðŸ† Leaderboards</a>
        <a href="#bg123">BG123</a>
        <a href="#nfts">NFTs</a>
        <a href="#community">Community</a>
        <a href="#memes">5D Memes</a>
        <a href="#network">Network</a>
      </nav>
      <div class="nav-cta">
        <a class="btn gold" href="#network">Buy $BEAR</a>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <header class="hero" role="banner" style="position: relative; overflow: hidden;">
    <!-- ðŸŽ¨ðŸ’¥ EPIC 3D LAYERED PARALLAX SIGN ðŸ’¥ðŸŽ¨ -->
    <div id="woodenSignContainer" style="position: absolute; top: 38%; left: 50%; transform: translate(-50%, -50%); z-index: 10; perspective: 1000px;">
      <div id="signParallaxWrapper" style="position: relative; transform-style: preserve-3d; width: 430px;">
        <!-- Deep shadow layer (moves slowest) - INVISIBLE until mouse near -->
        <img class="sign-layer sign-depth-layer" data-depth="0.2" src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/25ekkd.png" alt="" style="position: absolute; width: 100%; height: auto; opacity: 0; filter: blur(20px) brightness(0); transform: translateZ(-100px) scale(1.2); pointer-events: none;">

        <!-- Mid shadow layer - INVISIBLE until mouse near -->
        <img class="sign-layer sign-depth-layer" data-depth="0.4" src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/25ekkd.png" alt="" style="position: absolute; width: 100%; height: auto; opacity: 0; filter: blur(10px) brightness(0.3); transform: translateZ(-50px) scale(1.1); pointer-events: none;">

        <!-- Main sign layer (NO glow/highlight layers) -->
        <img id="woodenSign" class="sign-layer" data-depth="1" src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/25ekkd.png" alt="BEAR PARK wooden sign" style="position: relative; width: 100%; height: auto; transform: translateZ(0px);">
      </div>
    </div>

    <!-- Animated Character -->
    <img id="heroCharacter" src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/rez765.png" alt="BEAR character" style="position: relative; z-index: 10;">

    <!-- ðŸ»ðŸ™ï¸ BEAR CITY INHABITANTS ðŸ™ï¸ðŸ» -->
    <div id="bearCityContainer" aria-hidden="true"></div>
  </header>

  <!-- BEAR OVERVIEW -->
  <section class="alt" id="bear-overview">
    <div class="wrap reveal">
      <h2 class="h2" style="font-size:clamp(42px, 5vw, 64px);"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/esp426.png" alt="Chart icon" style="height:1em; width:auto; vertical-align:middle; margin-right:8px; display:inline-block;"> BEAR OVERVIEW</h2>
      <p style="text-align:center;margin:-6px 0 32px;opacity:0.9;font-size:clamp(18px, 2.5vw, 22px);font-weight:700;">Live $BEAR price, market stats, chart, and liquidity pool.</p>

      <!-- Main Chart Area -->
      <div class="honey-card" style="margin-bottom:20px; padding:20px 20px 0 20px; overflow:hidden;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
          <h3 class="honey-card-title" style="margin:0;">ðŸ“ˆ Live Chart</h3>
          <a href="https://dexscreener.com/xrpl/4245415200000000000000000000000000000000.rbearguasyu7tuw53rufqzfdwmjhpjeqfw_xrp"
             target="_blank"
             rel="noopener noreferrer"
             style="display:inline-flex; align-items:center; gap:6px; padding:8px 16px; background:var(--gold); color:#000; border-radius:8px; font-size:12px; font-weight:900; text-transform:uppercase; transition:all 0.2s; border:2px solid transparent; border-image: var(--tri-gradient) 1;"
             onmouseover="this.style.background='#ffca3a'"
             onmouseout="this.style.background='var(--gold)'">
            <span>ðŸ“Š View Transactions</span>
          </a>
        </div>
        <div class="chart-container">
          <div id="chart-error" style="display:none;">
            <div style="padding:40px; text-align:center; color:var(--gold); background:rgba(0,0,0,0.5); border-radius:12px; height:800px; display:flex; flex-direction:column; align-items:center; justify-content:center;">
              <div style="font-size:48px; margin-bottom:16px;">ðŸ“Š</div>
              <div style="font-size:18px; font-weight:900; margin-bottom:12px;">Chart Loading Issue</div>
              <div style="opacity:0.8; margin-bottom:20px;">The embedded chart may be blocked by your browser settings.</div>
              <a href="https://dexscreener.com/xrpl/4245415200000000000000000000000000000000.rbearguasyu7tuw53rufqzfdwmjhpjeqfw_xrp"
                 target="_blank"
                 rel="noopener noreferrer"
                 class="btn gold">
                View Full Chart on DexScreener
              </a>
            </div>
          </div>
          <iframe
            id="dexscreener-embed"
            src="https://dexscreener.com/xrpl/4245415200000000000000000000000000000000.rbearguasyu7tuw53rufqzfdwmjhpjeqfw_xrp?embed=1&theme=dark&trades=0&info=0"
            style="width:100%; height:590px; border:0; border-radius:12px; background:#000; display:block;"
            title="DexScreener Chart"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
          ></iframe>
        </div>
      </div>

      <!-- Stats Grid Below Chart -->
      <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:20px;" class="stats-grid-bottom">
        <!-- Stats Sidebar -->
          <!-- USD Metrics Card -->
          <div class="honey-card" style="margin-bottom:20px;">
            <h3 class="honey-card-title">ðŸ’µ USD METRICS</h3>
            <div class="stats-list">
              <div class="stat-item">
                <div class="stat-label" style="white-space: nowrap; display: inline-flex; align-items: center; gap: 4px;"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/esp426.png" alt="BEAR" style="height:0.9em; width:auto; display:inline-block;">BEAR / ðŸ’µ USD</div>
                <div class="stat-value" id="honeyPriceUsd">â€”</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">24H CHANGE</div>
                <div class="stat-value" id="honeyChange24h">â€”</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">ðŸ’µ 24H VOLUME</div>
                <div class="stat-value" id="honeyVolume">â€”</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">ðŸ’µ MARKET CAP</div>
                <div class="stat-value" id="honeyMcap">â€”</div>
              </div>
            </div>
          </div>

          <!-- XRP Metrics Card -->
          <div class="honey-card" style="margin-bottom:20px;">
            <h3 class="honey-card-title" style="display:inline-flex; align-items:center; gap:6px;"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/lufprf.png" alt="XRP" style="height:1em; width:auto; display:inline-block;">XRP METRICS</h3>
            <div class="stats-list">
              <div class="stat-item">
                <div class="stat-label" style="white-space: nowrap; display: inline-flex; align-items: center; gap: 4px;"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/esp426.png" alt="BEAR" style="height:0.9em; width:auto; display:inline-block;">BEAR / <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/lufprf.png" alt="XRP" style="height:0.9em; width:auto; display:inline-block;">XRP</div>
                <div class="stat-value" id="honeyPriceXrp">â€”</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">24H CHANGE</div>
                <div class="stat-value" id="honeyChange24hXrp">â€”</div>
              </div>
              <div class="stat-item">
                <div class="stat-label" style="white-space: nowrap; display: inline-flex; align-items: center; gap: 4px;"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/lufprf.png" alt="XRP" style="height:0.9em; width:auto; display:inline-block;">XRP 24H VOLUME</div>
                <div class="stat-value" id="honeyVolumeXrp">â€”</div>
              </div>
              <div class="stat-item">
                <div class="stat-label" style="white-space: nowrap; display: inline-flex; align-items: center; gap: 4px;"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/lufprf.png" alt="XRP" style="height:0.9em; width:auto; display:inline-block;">XRP MARKET CAP</div>
                <div class="stat-value" id="honeyMcapXrp">â€”</div>
              </div>
            </div>
          </div>

          <!-- Liquidity Pool -->
          <div class="honey-card">
            <h3 class="honey-card-title">ðŸ’§ Liquidity Pool</h3>
            <div class="stats-list">
              <div class="stat-item">
                <div class="stat-label" style="white-space: nowrap; display: inline-flex; align-items: center; gap: 4px;"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/esp426.png" alt="BEAR" style="height:0.9em; width:auto; display:inline-block;">BEAR Liquidity</div>
                <div class="stat-value" id="liquidityBear">â€”</div>
              </div>
              <div class="stat-item">
                <div class="stat-label" style="white-space: nowrap; display: inline-flex; align-items: center; gap: 4px;"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/lufprf.png" alt="XRP" style="height:0.9em; width:auto; display:inline-block;">XRP Liquidity</div>
                <div class="stat-value" id="liquidityXrp">â€”</div>
              </div>
              <div class="stat-item">
                <div class="stat-label" style="white-space: nowrap;">ðŸ’µ USD Value</div>
                <div class="stat-value" id="liquidityUsd">â€”</div>
              </div>
              <div class="stat-item">
                <div class="stat-label" style="white-space: nowrap;">ðŸ“Š Liq/MCap Ratio</div>
                <div class="stat-value" id="liquidityMcapRatio">â€”</div>
              </div>
            </div>
          </div>
      </div>

      <style>
        @media (max-width: 1024px) {
          .stats-grid-bottom {
            grid-template-columns: 1fr !important;
          }
        }
        @media (max-width: 768px) {
          .stats-grid-bottom {
            grid-template-columns: 1fr !important;
          }
        }
      </style>
    </div>
  </section>

  <!-- BEAR HONEY POINTS -->
  <section class="dark" id="honey-points">
    <div class="wrap reveal">
      <h2 class="h2"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;"> BEAR HONEY POINTS</h2>
      <p style="text-align:center;margin:-6px 0 32px;opacity:0.9;">earn honey points by raiding, playing games, having your meme voted as the "meme of the week" and other fun giveaways!</p>

      <div class="honey-points-grid">
        <!-- My Points Card -->
        <div class="honey-card my-points-card">
            <h3 class="honey-card-title"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;"> My Honey Points</h3>
            <div id="myPointsContent">
              <!-- Total Points Hero -->
              <div class="points-hero">
                <div class="points-hero-value" id="totalHoneyPoints">0</div>
                <div class="points-hero-label">TOTAL HONEY POINTS EARNED</div>
              </div>

              <!-- Points Breakdown -->
              <div class="points-breakdown">
                <div class="points-breakdown-item">
                  <div class="points-breakdown-icon">ðŸª–</div>
                  <div class="points-breakdown-content">
                    <div class="points-breakdown-label">Honey Earned from Raiding</div>
                    <div class="points-breakdown-value" id="raidingPoints">0 PTS</div>
                  </div>
                </div>

                <div class="points-breakdown-item">
                  <div class="points-breakdown-icon">ðŸŽ®</div>
                  <div class="points-breakdown-content">
                    <div class="points-breakdown-label">Honey Earned from Games</div>
                    <div class="points-breakdown-value" id="gamesPoints">0 PTS</div>
                  </div>
                </div>
              </div>

              <!-- Daily Game Progress -->
              <div class="daily-game-progress">
                <div class="daily-progress-header">
                  <span class="daily-progress-title">ðŸ•¹ï¸ðŸƒ Today's Game Progress</span>
                  <span class="daily-progress-count" id="dailyGameCount">0/20</span>
                </div>
                <div class="daily-progress-bar-container">
                  <div class="daily-progress-bar" id="dailyProgressBar" style="width: 0%"></div>
                </div>
                <div class="daily-progress-info">
                  <span class="daily-progress-points" id="dailyGamePoints">0 pts earned today</span>
                  <span class="daily-progress-remaining" id="dailyGamesRemaining">20 mins left</span>
                </div>
              </div>

              <!-- Your Rank -->
              <div class="points-rank">
                <span>Your Rank: <strong id="myRank">â€”</strong></span>
              </div>
            </div>
          </div>

        <!-- Leaderboard -->
        <div class="honey-card leaderboard-card">
          <h3 class="honey-card-title">ðŸ† Top Honey Earners</h3>
          <div class="leaderboard" id="honeyLeaderboard">
            <div class="leaderboard-loading">Loading leaderboard...</div>
          </div>
        </div>

        <!-- Current Raids -->
        <div class="honey-card raids-card">
          <button class="admin-raid-btn" id="adminRaidBtn" style="display:none;" onclick="window.location.href='/admin-raids.html'">ðŸŽ¯ START RAID</button>
          <button class="raids-toggle-btn" id="raidsToggleBtn">Show Previous Raids</button>
          <h3 class="honey-card-title" id="raidsTitle">ðŸ» ðŸª– Current Raids</h3>
          <div id="raidsContent">
            <div class="raids-list" id="currentRaidsList">
              <div class="raids-empty">Loading raids...</div>
            </div>
            <div class="raids-list" id="previousRaidsList" style="display:none;">
              <div class="raids-empty">Loading previous raids...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- BEARCADE -->
  <section class="alt" id="bearcade">
    <div class="wrap reveal">
      <h2 class="h2">BEARCADE</h2>
      <p style="text-align:center;margin:-6px 0 24px;">PLAY GAMES AND EARN HONEY POINTS! PLAY ANY OF THE 3 BELOW <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;"> ðŸŽ®</p>

      <div class="arcade" role="group" aria-label="Arcade machines (3)">
        <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/llxd86.png" alt="Three retro arcade machines with honey walls and neon trim" width="1100" height="650" loading="eager" decoding="async">
        <a class="hotspot" href="https://flappy-bear-five.vercel.app/" rel="noopener noreferrer" style="left:7%; top:10%; width:27%; height:84%;" aria-label="Open Flappy Bear">Flappy Bear</a>
        <a class="hotspot" href="https://bear-jumpventure1.vercel.app/" rel="noopener noreferrer" style="left:37%; top:10%; width:26%; height:84%;" aria-label="Open Bear Ninja">Bear Ninja</a>
        <a class="hotspot" href="https://bear-jumpventure.vercel.app/" rel="noopener noreferrer" style="left:66.5%; top:10%; width:27%; height:84%;" aria-label="Open Bear Jumpventure">Bear Jumpventure</a>
      </div>
    </div>
  </section>

  <!-- LEADERBOARDS -->
  <section class="dark" id="leaderboards">
    <div class="wrap reveal">
      <h2 class="h2">ðŸ† LEADERBOARDS ðŸ†</h2>
      <p style="text-align:center;margin:-6px 0 32px;">Top players across all BEAR games â€” wallet-verified high scores!</p>

      <div class="grid-3" style="gap:24px;">

        <!-- Flappy BEAR Leaderboard -->
        <div class="leaderboard-card">
          <h3 class="h3" style="text-align:center; margin-bottom:16px;">
            <span style="color:var(--gold);">FLAPPY</span> BEAR
          </h3>
          <div id="leaderboard-flappy" class="leaderboard-list">
            <div class="loading">Loading scores...</div>
          </div>
        </div>

        <!-- BEAR Ninja Leaderboard -->
        <div class="leaderboard-card">
          <h3 class="h3" style="text-align:center; margin-bottom:16px;">
            BEAR <span style="color:var(--gold);">NINJA</span>
          </h3>
          <div id="leaderboard-slice" class="leaderboard-list">
            <div class="loading">Loading scores...</div>
          </div>
        </div>

        <!-- BEAR Jump Leaderboard -->
        <div class="leaderboard-card">
          <h3 class="h3" style="text-align:center; margin-bottom:16px;">
            BEAR <span style="color:var(--gold);">JUMP</span>
          </h3>
          <div id="leaderboard-jumpventure" class="leaderboard-list">
            <div class="loading">Loading scores...</div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- BEARABLEGUY123 -->
  <section class="dark" id="bg123">
    <div class="wrap reveal">
      <h2 class="h2">BEARABLEGUY123</h2>
      <p class="center on-dark" style="opacity:.9;margin:-6px 0 20px;">Since 2018, Bearableguy posted riddles in images with a red masked bear. The community uncovered hints like â€œ589.â€</p>

      <div class="card" role="region" aria-roledescription="carousel" aria-label="Bearableguy image gallery" aria-live="polite">
        <div class="carousel" id="carousel">
          <!-- LEFT ARROW -->
          <button class="carousel-arrow carousel-arrow-left" id="carouselPrev" aria-label="Previous slide">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          <!-- RIGHT ARROW -->
          <button class="carousel-arrow carousel-arrow-right" id="carouselNext" aria-label="Next slide">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          <div class="viewport" id="viewport" tabindex="0" aria-label="Carousel viewport (use left and right arrow keys)">
            <div class="slides" id="slides">
              <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/f6k3b1.jpg" alt="BG123 poster 1" width="1600" height="900" loading="lazy" decoding="async">
              <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/18vwoq.jpg" alt="BG123 poster 2" width="1600" height="900" loading="lazy" decoding="async">
              <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/ruozs3.jpg" alt="BG123 poster 3" width="1600" height="900" loading="lazy" decoding="async">
              <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/ha4uwj.jpg" alt="BG123 poster 4" width="1600" height="900" loading="lazy" decoding="async">
              <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/n0le0t.jpg" alt="BG123 poster 5" width="1600" height="900" loading="lazy" decoding="async">
              <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/wbin3t.jpg" alt="BG123 poster 6" width="1600" height="900" loading="lazy" decoding="async">
              <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/lrtbxe.png" alt="BG123 poster 7" width="1600" height="900" loading="lazy" decoding="async">
            </div>
          </div>
        </div>
        <div class="dots" id="dots" role="tablist" aria-label="Choose slide"></div>
      </div>
    </div>
  </section>

  <!-- NFTs -->
  <section class="alt" id="nfts">
    <div class="wrap reveal">
      <h2 class="h2">BEAR NFTs</h2>
      <p style="text-align:center;margin:-6px 0 24px;">The BEAR community has collectible NFTs for profile pictures â€” the <strong>Ultra Rare Collection</strong> and the <strong>Pixel Collection</strong>.</p>

      <div class="grid-2">
        <div class="card">
          <h3 class="h3">ULTRA RARE BEARS</h3>
          <p style="text-align:center;opacity:.95;">The BEAR Ultra Rare collection was the first mint and consists of 667 NFTs.</p>
          <div class="spacer"></div>
          <a class="nft-media" href="https://xrp.cafe/collection/bearxrpl" target="_blank" rel="noopener">
            <img src="https://cdn.xrp.cafe/362e53289fd2-49f8-b070-4a3a6f95617272729975700c-46ba-a056-0aaf34028496f5a507b1d5a4-4adc-ad01-8d8b6ecd631d.webp" alt="Ultra Rare Bear preview" width="1200" height="1200" loading="lazy" decoding="async">
          </a>
          <div class="center" style="margin-top:16px;">
            <a class="btn gold" href="https://xrp.cafe/collection/bearxrpl" target="_blank" rel="noopener">Ultra Collection</a>
          </div>
        </div>

        <div class="card">
          <h3 class="h3">PIXEL BEARS</h3>
          <p style="text-align:center;opacity:.95;">There are 5880 Pixel BEARS to provide a profile picture for every $BEAR maxi.</p>
          <div class="spacer"></div>
          <a class="nft-media" href="https://xrp.cafe/collection/bear-pixel-collection" target="_blank" rel="noopener">
            <video src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/babbn1.mp4" playsinline muted autoplay loop poster="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/babbn1.jpg"></video>
          </a>
          <div class="center" style="margin-top:16px;">
            <a class="btn gold" href="https://xrp.cafe/collection/bear-pixel-collection" target="_blank" rel="noopener">Pixel Collection</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- COMMUNITY -->
  <section class="dark" id="community">
    <div class="wrap reveal">
      <h2 class="h2">COMMUNITY</h2>

    <div class="community-banner" role="img" aria-label="$BEAR community montage with honey lighting">
        <img class="bg" src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/kgs8as.jpg" alt="" width="2000" height="1000" loading="lazy" decoding="async">
        <div class="overlay">
          <p class="on-dark" style="text-align:center;margin:0 0 8px;">Come meet the $BEAR fam in the official communities!</p>
          <div class="pair">
            <a class="btn gold" href="https://x.com/bearxrpl" target="_blank" rel="noopener">Join us on X</a>
            <a class="btn gold" href="https://discord.com/invite/atGTNuzqH6" target="_blank" rel="noopener">Join Discord</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 5D MEMES -->
  <section class="alt" id="memes">
    <div class="wrap reveal">
      <h2 class="h2">5D MEMES</h2>
      <p style="text-align:center;margin:-6px 0 18px;color:var(--gold-ink)">Live stream from Kick</p>

      <div class="card">
        <div class="square" id="kickWrap">
          <!-- Lazy-loaded Kick embed with placeholder -->
          <button class="placeholder btn ghost" id="kickPlaceholder" aria-label="Load live Kick stream">
            â–¶ Load live Kick stream
          </button>
        </div>
        <div class="center" style="margin-top:14px;">
          <a class="btn ghost" href="https://kick.com/bearxrpl" target="_blank" rel="noopener">Open on Kick</a>
        </div>
      </div>
    </div>
  </section>

  <!-- NETWORK -->
  <section class="dark" id="network">
    <div class="wrap reveal">
      <h2 class="h2">NETWORK</h2>
      <p class="on-dark" style="text-align:center;margin:-6px 0 24px;">Buy $BEAR here</p>

      <div class="grid-2">
        <a class="tile" href="https://firstledger.net/token/rBEARGUAsyu7tUw53rufQzFdWmJHpJEqFW/4245415200000000000000000000000000000000" target="_blank" rel="noopener">
          <div class="face"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/du61x3.jpg" alt="First Ledger" width="300" height="64" loading="lazy" decoding="async"></div>
          <span class="lbl">First Ledger</span>
        </a>
        <a class="tile" href="https://xmagnetic.org/dex/BEAR+rBEARGUAsyu7tUw53rufQzFdWmJHpJEqFW_XRP+XRP?network=mainnet" target="_blank" rel="noopener">
          <div class="face"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/m9ck1m.png" alt="Magnetic DEX" width="300" height="64" loading="lazy" decoding="async"></div>
          <span class="lbl">Magnetic DEX</span>
        </a>
        <a class="tile" href="https://xpmarket.com/token/BEAR-rBEARGUAsyu7tUw53rufQzFdWmJHpJEqFW" target="_blank" rel="noopener">
          <div class="face"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/1dw0sy.png" alt="XPMarket" width="220" height="64" loading="lazy" decoding="async"></div>
          <span class="lbl">XPMarket</span>
        </a>
      </div>
    </div>
  </section>

  <footer class="dark">
    <div class="wrap center" style="gap:14px;flex-wrap:wrap;">
      <span class="on-dark" style="opacity:.9;">Â© BEAR Park â€” Defend the castle ðŸ°</span>
      <a class="btn ghost" href="#top">Back to Top</a>
    </div>
  </footer>

  <!-- Buy Drawer -->
  <aside id="buyDrawer" class="drawer" aria-hidden="true">
    <div class="drawer-head">
      <h3 class="h3" style="margin:0;"><span style="color:var(--gold);">BEAR</span> <span style="color:#fff;">HUB</span></h3>
      <button class="drawer-close-btn" data-close-drawer aria-label="Close BEAR HUB">
        &times;
      </button>
    </div>
    <div class="drawer-body">
      <!-- MY $BEAR PORTFOLIO -->
      <div id="portfolioSection" class="portfolio-card" style="display:none;">
        <h4 style="margin:0 0 16px 0; font-size:18px; font-weight:900; color:var(--gold); text-transform:uppercase; letter-spacing:0.5px;">ðŸ’¼ My $BEAR Portfolio</h4>
        <div class="portfolio-stats">
          <div class="stat-row" style="margin-bottom:16px;">
            <span class="stat-label" style="font-size:15px; display:inline-flex; align-items:center; gap:6px; white-space:nowrap;">
              <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/esp426.png" alt="BEAR" width="18" height="18" style="display:inline-block;"> Total BEAR:
            </span>
            <span id="portfolioBearAmount" class="stat-value" style="font-size:24px; font-weight:900;">â€”</span>
          </div>
          <div class="stat-row" style="margin-bottom:12px;">
            <span class="stat-label" style="font-size:15px; white-space:nowrap;">ðŸ’µ USD Value:</span>
            <span id="portfolioUsdValue" class="stat-value" style="font-size:20px; font-weight:900;">â€”</span>
          </div>
          <div class="stat-row">
            <span class="stat-label" style="font-size:15px; display:inline-flex; align-items:center; gap:4px; white-space:nowrap;"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/lufprf.png" alt="XRP" width="18" height="18" style="display:inline-block;">XRP Value:</span>
            <span id="portfolioXrpValue" class="stat-value" style="font-size:20px; font-weight:900;">â€”</span>
          </div>
        </div>
        <div class="wallet-address" style="margin-top:16px; padding:10px; background:rgba(0,0,0,0.4); border-radius:8px; border:1px solid rgba(237,183,35,0.2); font-size:13px; font-family:monospace; word-break:break-all; text-align:center; color:rgba(255,255,255,0.8);">
          <span id="connectedWalletAddress">â€”</span>
        </div>
      </div>

      <!-- USER PROFILE CUSTOMIZATION -->
      <div id="profileSection" class="profile-card" style="display:none;">
        <div id="profileSetupSection">
          <h4 style="margin:0 0 16px 0; font-size:18px; font-weight:900; color:var(--gold); text-transform:uppercase; letter-spacing:0.5px;">ðŸ‘¤ Your Profile</h4>

          <!-- Helpful instruction banner -->
          <div id="profileInstructions" style="background:linear-gradient(135deg, rgba(237,183,35,0.2), rgba(237,183,35,0.1)); padding:16px; border-radius:12px; border:2px solid var(--gold); margin-bottom:20px; text-align:center; transition:all 0.5s ease;">
            <div style="font-size:16px; font-weight:900; color:var(--gold); margin-bottom:8px;">ðŸ‘‹ SET UP YOUR PROFILE!</div>
            <div style="font-size:14px; line-height:1.6; color:rgba(255,255,255,0.9);">
              1ï¸âƒ£ Enter your username below<br>
              2ï¸âƒ£ Scroll down and pick an NFT from your collection<br>
              3ï¸âƒ£ Click "Save Profile" when done!
            </div>
          </div>

        <div style="background:rgba(0,0,0,0.3); padding:20px; border-radius:12px; border:2px solid rgba(237,183,35,0.2); margin-bottom:16px;">
          <div style="margin-bottom:20px;">
            <label style="display:block; font-size:16px; font-weight:900; margin-bottom:10px; color:var(--gold);">âœï¸ Display Name</label>
            <input type="text" id="profileUsername" placeholder="Enter your username here..." maxlength="20" style="width:100%; padding:16px; background:rgba(0,0,0,0.5); border:3px solid rgba(237,183,35,0.5); border-radius:12px; color:#fff; font-size:18px; font-family:inherit; font-weight:700; transition:all 0.3s;">
          </div>

          <div>
            <label style="display:block; font-size:16px; font-weight:900; margin-bottom:10px; color:var(--gold);">ðŸ–¼ï¸ Profile Avatar</label>
            <div id="profileAvatarSelector" style="background:rgba(0,0,0,0.5); padding:16px; border-radius:12px; border:3px solid rgba(237,183,35,0.5); min-height:90px; display:flex; align-items:center; justify-content:center;">
              <div style="text-align:center; font-size:15px; font-weight:700; color:rgba(237,183,35,0.8);">
                ðŸ‘‡ Scroll down and click an NFT to select it ðŸ‘‡
              </div>
            </div>
            <input type="hidden" id="profileAvatarNFT" value="">
          </div>
        </div>

        <button id="saveProfileBtn" class="btn gold" style="width:100%; font-size:20px; padding:20px; font-weight:900; letter-spacing:1px; background:linear-gradient(135deg, #edb723, #f4a623); box-shadow:0 6px 20px rgba(237,183,35,0.5);">ðŸ’¾ SAVE PROFILE</button>
        </div>
      </div>

      <!-- NFT VIEWING SECTION -->
      <div id="nftSection" style="display:none; flex-shrink:0; display:flex; flex-direction:column;">
        <h4 style="margin:0 0 16px 0; font-size:18px; font-weight:900; color:var(--gold); text-transform:uppercase; letter-spacing:0.5px;">ðŸ–¼ï¸ Your NFTs</h4>

        <!-- Helpful instruction for NFT selection -->
        <div id="nftInstructions" style="background:linear-gradient(135deg, rgba(237,183,35,0.15), rgba(237,183,35,0.05)); padding:14px; border-radius:10px; border:2px solid rgba(237,183,35,0.4); margin-bottom:16px; text-align:center; transition:all 0.5s ease;">
          <div style="font-size:15px; font-weight:900; color:var(--gold);">
            ðŸ‘† SCROLL UP to see your selected avatar<br>
            ðŸ‘‡ CLICK any NFT below to use it as your profile picture!
          </div>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:18px;">
          <button id="viewPixelBearsBtn" class="btn gold" style="font-size:15px; padding:14px; font-weight:900;">ðŸ» Pixel Bears</button>
          <button id="viewUltraRaresBtn" class="btn gold" style="font-size:15px; padding:14px; font-weight:900;">ðŸ’Ž Ultra Rares</button>
        </div>

        <div id="nftGrid" style="display:none; max-height:600px; overflow-y:auto; background:rgba(0,0,0,0.3); padding:10px; border-radius:10px; border:2px solid rgba(237,183,35,0.2); margin-bottom:20px;">
          <div id="nftGridContent" style="display:grid; grid-template-columns:repeat(2, 1fr); gap:10px;">
            <!-- NFTs will be loaded here -->
          </div>
        </div>

        <div id="nftLoading" style="display:none; text-align:center; padding:20px; opacity:0.6;">
          Loading NFTs...
        </div>

        <div id="nftEmpty" style="display:none; text-align:center; padding:20px; opacity:0.6; font-size:12px;">
          No NFTs found in your wallet
        </div>
      </div>

      <!-- Disconnect button at bottom of drawer -->
      <div id="drawerDisconnectContainer"></div>
    </div>
  </aside>


  <style>
    /* ðŸ»ðŸ™ï¸ BEAR CITY INHABITANTS SYSTEM ðŸ™ï¸ðŸ» */
    #bearCityContainer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1; /* Behind UI but visible */
      overflow: visible;
    }

    .city-bear {
      position: absolute;
      width: 60px;
      height: auto;
      opacity: 1;
      filter: drop-shadow(2px 3px 6px rgba(0, 0, 0, 0.3));
      will-change: transform;
      transition: transform 0.1s linear;
      pointer-events: auto;
      cursor: pointer;
      z-index: 1;
    }

    .city-bear:hover {
      filter: drop-shadow(0 0 15px rgba(237, 183, 35, 0.8));
      transform: scale(1.15) !important;
    }

    .city-bear.walking-left {
      transform: scaleX(-1);
    }

    .city-bear.jumping {
      animation: bearJump 0.6s ease-out;
    }

    .city-bear.dancing {
      animation: bearDance 1s ease-in-out infinite;
    }

    .city-bear.waving {
      animation: bearWave 1.5s ease-in-out infinite;
    }

    @keyframes bearJump {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-80px) scale(1.1) rotate(10deg); }
    }

    @keyframes bearDance {
      0%, 100% { transform: rotate(0deg) scale(1); }
      25% { transform: rotate(-15deg) scale(1.1); }
      50% { transform: rotate(0deg) scale(1.15); }
      75% { transform: rotate(15deg) scale(1.1); }
    }

    @keyframes bearWave {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-20deg); }
      75% { transform: rotate(20deg); }
    }

    @keyframes bearBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    /* MOBILE OPTIMIZATIONS */
    @media (max-width: 768px) {
      .city-bear {
        width: 40px;
      }
    }
  </style>

  <script>
    // ðŸ»ðŸ™ï¸ðŸ’¥ BEAR CITY INHABITANTS - LIVING ECOSYSTEM ðŸ’¥ðŸ™ï¸ðŸ»
    (function() {
      const bearImages = [
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/a8yk6m.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/k3yx6x.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/2la74d.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/zkxfrs.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/sv9big.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/scs5nr.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/su97n8.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/rbz4k3.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/mglkoj.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/un18dl.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/0ftro9.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/s5w7wg.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/a2pgvw.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/ecqtzu.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/ku1n1u.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/yrf4b7.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/dj9a9s.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/l5xrps.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/r6myzr.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/kbjcbv.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/2weeov.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/ijhbbj.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/6t4s3b.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/09oxkp.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/y72z5w.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/6a7p84.png',
        'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/qwh0mg.png'
      ];

      const container = document.getElementById('bearCityContainer');
      if (!container) return;

      const hero = document.querySelector('.hero');
      if (!hero) return;

      let cityBears = [];
      let containerWidth = hero.offsetWidth;
      let containerHeight = hero.offsetHeight;

      // Ground level - bears stay in bottom 60% (40% from top to 100%)
      const groundStart = containerHeight * 0.4;
      const groundEnd = containerHeight * 0.95;

      // ðŸ ðŸ’§ NO-WALK ZONES - Bears avoid water only!
      const noWalkZones = [
        // ðŸ’§ðŸ’§ðŸ’§ WATER ZONE - Bottom portion only
        {
          left: 0,
          right: containerWidth * 0.35,  // 35% from left
          top: containerHeight * 0.60,   // Start at 60% from top (increased by 5%)
          bottom: containerHeight,       // To the bottom
          name: 'WATER ZONE - ABSOLUTE NO ENTRY'
        }
      ];

      // Check if position is in any no-walk zone
      function isInNoWalkZone(x, y) {
        for (let zone of noWalkZones) {
          if (x >= zone.left && x <= zone.right && y >= zone.top && y <= zone.bottom) {
            return zone;
          }
        }
        return null;
      }

      // BEAR CLASS - Each bear is a living entity
      class CityBear {
        constructor(imageSrc, index) {
          this.element = document.createElement('img');
          this.element.src = imageSrc;
          this.element.className = 'city-bear';
          this.element.loading = 'lazy';

          // Random starting position on the ground (NOT in water!)
          do {
            this.x = Math.random() * (containerWidth - 80);
            this.y = groundStart + Math.random() * (groundEnd - groundStart);
          } while (isInNoWalkZone(this.x, this.y));

          this.speed = (0.3 + Math.random() * 1.2) * 0.75; // pixels per frame (25% slower)
          this.direction = Math.random() > 0.5 ? 1 : -1; // 1 = right, -1 = left
          this.state = 'walking'; // walking, standing, dancing, jumping
          this.stateTimer = Math.random() * 300;
          this.isActive = true;
          this.imageSrc = imageSrc;

          // Position the bear
          this.element.style.left = this.x + 'px';
          this.element.style.top = this.y + 'px';

          if (this.direction < 0) {
            this.element.classList.add('walking-left');
          }

          // Handle broken images - remove them
          this.element.onerror = () => {
            console.warn('ðŸ» âŒ Broken bear image removed: ' + imageSrc);
            this.element.remove();
            this.isActive = false;
          };

          // Click interaction
          this.element.addEventListener('click', () => this.onClick());

          container.appendChild(this.element);
        }

        onClick() {
          const actions = ['jumping', 'dancing', 'waving'];
          const action = actions[Math.floor(Math.random() * actions.length)];

          this.element.classList.remove('jumping', 'dancing', 'waving');
          this.element.classList.add(action);

          setTimeout(() => {
            this.element.classList.remove(action);
          }, action === 'dancing' ? 3000 : action === 'waving' ? 4500 : 600);

          console.log('ðŸ» Bear is ' + action + '!');
        }

        update() {
          if (!this.isActive) return; // Skip if bear is removed

          this.stateTimer--;

          // Randomly change states
          if (this.stateTimer <= 0) {
            const rand = Math.random();
            if (rand > 0.7) {
              this.state = 'standing';
              this.stateTimer = 60 + Math.random() * 120;
            } else if (rand > 0.5) {
              this.state = 'dancing';
              this.element.classList.add('dancing');
              this.stateTimer = 180 + Math.random() * 120;
              setTimeout(() => this.element.classList.remove('dancing'), this.stateTimer * 16);
            } else {
              this.state = 'walking';
              this.stateTimer = 180 + Math.random() * 300;
              // Randomly change direction
              if (Math.random() > 0.7) {
                this.direction *= -1;
                if (this.direction < 0) {
                  this.element.classList.add('walking-left');
                } else {
                  this.element.classList.remove('walking-left');
                }
              }
            }
          }

          // Move if walking
          if (this.state === 'walking') {
            this.move();
          }
        }

        move() {
          const nextX = this.x + this.speed * this.direction;

          // Check if next position would be in a no-walk zone
          const blockedZone = isInNoWalkZone(nextX, this.y);
          if (blockedZone) {
            // Don't walk into buildings or water! Turn around!
            this.direction *= -1;
            if (this.direction < 0) {
              this.element.classList.add('walking-left');
            } else {
              this.element.classList.remove('walking-left');
            }
            console.log('ðŸ»ðŸ  Bear avoided ' + blockedZone.name + '!');
          } else {
            this.x = nextX;
          }

          // Screen boundaries - mostly bounce, but 10% chance to walk off and despawn
          if (this.x < 0) {
            if (Math.random() < 0.1) {
              // 10% chance - let them walk off to despawn
              if (this.x < -100) {
                console.log('ðŸ»ðŸ‘‹ Bear walked off LEFT - despawning...');
                this.despawn();
                return;
              }
            } else {
              // 90% chance - bounce back
              this.x = 10;
              this.direction = 1;
              this.element.classList.remove('walking-left');
            }
          } else if (this.x >= containerWidth - 80) {
            if (Math.random() < 0.1) {
              // 10% chance - let them walk off to despawn
              if (this.x > containerWidth + 100) {
                console.log('ðŸ»ðŸ‘‹ Bear walked off RIGHT - despawning...');
                this.despawn();
                return;
              }
            } else {
              // 90% chance - bounce back
              this.x = containerWidth - 80;
              this.direction = -1;
              this.element.classList.add('walking-left');
            }
          }

          // Update position
          this.element.style.left = this.x + 'px';
        }

        despawn() {
          if (this.element && this.element.parentNode) {
            this.element.remove();
          }
          this.isActive = false;

          // Remove from cityBears array
          const index = cityBears.indexOf(this);
          if (index > -1) {
            cityBears.splice(index, 1);
          }

          // Return image to available pool
          availableBearImages.push(this.imageSrc);
        }
      }

      // Available bear images pool
      let availableBearImages = [...bearImages];

      // Get max bears based on screen size
      function getMaxBears() {
        const width = window.innerWidth;
        if (width < 768) return 5;        // Mobile: 5 bears
        if (width < 1024) return 10;      // Tablet: 10 bears
        if (width < 1440) return 15;      // Small desktop: 15 bears
        if (width < 1920) return 20;      // Desktop: 20 bears
        return 27;                        // Ultrawide: all 27 bears
      }

      // Spawn a new bear from off-screen
      function spawnRandomBear() {
        if (cityBears.length >= getMaxBears()) return;
        if (availableBearImages.length === 0) {
          availableBearImages = [...bearImages]; // Refill pool
        }

        // Pick random bear image
        const randomIndex = Math.floor(Math.random() * availableBearImages.length);
        const imageSrc = availableBearImages[randomIndex];
        availableBearImages.splice(randomIndex, 1);

        const bear = new CityBear(imageSrc, cityBears.length);

        // Pick safe Y position that's NOT in water zone
        // Spawn across the full ground area (40% to 95%) but avoid water zone
        const groundStart = containerHeight * 0.4;
        const groundEnd = containerHeight * 0.95;

        // Try to find a safe Y position (not in water zone)
        let attempts = 0;
        do {
          bear.y = groundStart + Math.random() * (groundEnd - groundStart);
          attempts++;
        } while (isInNoWalkZone(containerWidth * 0.5, bear.y) && attempts < 20);

        bear.element.style.top = bear.y + 'px';

        // Spawn off-screen (left or right)
        // IMPORTANT: Don't spawn from left if it would make them walk through water zone
        const waterZoneEnd = containerWidth * 0.35; // Water zone ends at 35%
        const canSpawnFromLeft = bear.y < (containerHeight * 0.60); // Only if Y is above water zone

        const spawnFromLeft = canSpawnFromLeft && (Math.random() > 0.5);
        if (spawnFromLeft) {
          bear.x = -80;
          bear.direction = 1; // Walk right
          bear.element.classList.remove('walking-left');
        } else {
          bear.x = containerWidth + 80;
          bear.direction = -1; // Walk left
          bear.element.classList.add('walking-left');
        }
        bear.state = 'walking';
        bear.element.style.left = bear.x + 'px';

        cityBears.push(bear);
        console.log('ðŸ»âœ¨ New bear spawned from ' + (spawnFromLeft ? 'LEFT' : 'RIGHT') + ' at safe Y position! Total: ' + cityBears.length);
      }

      // Initialize with responsive number of bears
      function initializeBears() {
        const maxBears = getMaxBears();
        console.log('ðŸ»ðŸ™ï¸ Initializing BEAR CITY with ' + maxBears + ' inhabitants for screen size ' + window.innerWidth + 'px');

        for (let i = 0; i < maxBears; i++) {
          setTimeout(() => {
            spawnRandomBear();
          }, i * 300); // Stagger initial spawning
        }

        console.log('ðŸ»âœ¨ BEAR CITY is spawning!');
      }

      // Spawn new bears periodically
      setInterval(() => {
        if (cityBears.length < getMaxBears()) {
          spawnRandomBear();
        }
      }, 8000); // Try to spawn every 8 seconds

      // ANIMATION LOOP
      function animate() {
        cityBears.forEach(bear => bear.update());
        requestAnimationFrame(animate);
      }

      // HANDLE RESIZE
      function handleResize() {
        containerWidth = hero.offsetWidth;
        containerHeight = hero.offsetHeight;

        // Update water zone boundary only
        noWalkZones[0] = { // ðŸ’§ðŸ’§ðŸ’§ WATER ZONE - Bottom portion only
          left: 0,
          right: containerWidth * 0.35,
          top: containerHeight * 0.60,   // Start at 60% from top (increased by 5%)
          bottom: containerHeight,
          name: 'WATER ZONE - ABSOLUTE NO ENTRY'
        };

        // Adjust bear count based on new screen size
        const maxBears = getMaxBears();
        if (cityBears.length > maxBears) {
          // Too many bears - remove excess
          const excess = cityBears.length - maxBears;
          console.log('ðŸ»ðŸ“‰ Screen got smaller - removing ' + excess + ' bears');
          for (let i = 0; i < excess; i++) {
            if (cityBears.length > 0) {
              const bear = cityBears[cityBears.length - 1];
              bear.despawn();
            }
          }
        }

      }

      window.addEventListener('resize', handleResize);

      // START THE CITY
      handleResize(); // Initialize zones
      initializeBears();
      animate();

      console.log('ðŸ»ðŸ™ï¸ðŸ’¥ BEAR CITY IS ALIVE! ðŸ’¥ðŸ™ï¸ðŸ»');
    })();
  </script>

  <script>
    // ðŸŽ¨ðŸ’¥ðŸ”¥ EPIC 3D LAYERED PARALLAX SIGN WITH JESTER BEAR ðŸ”¥ðŸ’¥ðŸŽ¨
    (function() {
      const woodenSign = document.getElementById('woodenSign');
      const woodenSignContainer = document.getElementById('woodenSignContainer');
      const signParallaxWrapper = document.getElementById('signParallaxWrapper');
      const signLayers = document.querySelectorAll('.sign-layer');

      if (!woodenSign || !woodenSignContainer || !signParallaxWrapper) return;

      let time = 0;
      let clickCount = 0;
      let clickTimer = null;

      // Spring physics for smooth movement
      let currentX = 0, currentY = 0;
      let velocityX = 0, velocityY = 0;
      let targetX = 0, targetY = 0;

      // 3D rotation
      let currentRotX = 0, currentRotY = 0, currentRotZ = 0;
      let targetRotX = 0, targetRotY = 0, targetRotZ = 0;

      // Scale and intensity
      let currentScale = 1;
      let targetScale = 1;
      let mouseDistance = 1;
      let isNearMouse = false;

      // EPIC SPRING PHYSICS ANIMATION
      function animate() {
        time += 0.003;

        // Idle floating when not interacting
        const idleFloatY = Math.sin(time) * 8;
        const idleFloatX = Math.cos(time * 0.6) * 6;
        const idleRotZ = Math.sin(time * 0.5) * 2;

        // Spring physics for smooth magnetic following
        const springStrength = 0.05;
        const damping = 0.85;

        velocityX += (targetX - currentX) * springStrength;
        velocityY += (targetY - currentY) * springStrength;
        velocityX *= damping;
        velocityY *= damping;
        currentX += velocityX;
        currentY += velocityY;

        // Smooth rotation interpolation
        currentRotX += (targetRotX - currentRotX) * 0.15;
        currentRotY += (targetRotY - currentRotY) * 0.15;
        currentRotZ += (targetRotZ - currentRotZ) * 0.15;

        // Smooth scale
        currentScale += (targetScale - currentScale) * 0.1;

        // Apply transforms to wrapper with combined idle + interactive movement
        const finalX = currentX + idleFloatX;
        const finalY = currentY + idleFloatY;
        const finalRotZ = currentRotZ + idleRotZ;

        signParallaxWrapper.style.transform = `
          translate(${finalX}px, ${finalY}px)
          rotateX(${currentRotX}deg)
          rotateY(${currentRotY}deg)
          rotateZ(${finalRotZ}deg)
          scale(${currentScale})
        `;

        // Apply layered parallax to each layer based on depth
        signLayers.forEach((layer) => {
          const depth = parseFloat(layer.getAttribute('data-depth')) || 1;
          const isDepthLayer = layer.classList.contains('sign-depth-layer');

          // Each layer moves at different speed/intensity
          const layerX = currentX * depth;
          const layerY = currentY * depth;
          const layerRotY = currentRotY * depth * 0.5;
          const layerRotX = currentRotX * depth * 0.5;

          // SUBTLE glow intensity based on mouse proximity
          const glowIntensity = 8 + (1 - mouseDistance) * 12; // Much more subtle
          const brightness = 1 + (1 - mouseDistance) * 0.1 * depth; // Very subtle brightness

          // FADE IN depth layers ONLY when mouse is near
          if (isDepthLayer) {
            const maxOpacity = depth === 0.2 ? 0.2 : depth === 0.4 ? 0.3 : 0;
            const targetOpacity = isNearMouse ? maxOpacity * (1 - mouseDistance) : 0;
            layer.style.opacity = targetOpacity;
          }

          // Add SUBTLE dynamic lighting to main sign
          if (layer === woodenSign) {
            layer.style.filter = `
              drop-shadow(0 ${glowIntensity}px ${glowIntensity * 2}px rgba(0, 0, 0, 0.5))
              drop-shadow(0 0 ${glowIntensity}px rgba(139, 69, 19, ${0.2 + (1 - mouseDistance) * 0.1}))
              brightness(${brightness})
            `;
          }
        });

        requestAnimationFrame(animate);
      }

      // MAGNETIC MOUSE TRACKING WITH EXTREME PARALLAX
      let mouseUpdateTicking = false;
      document.addEventListener('mousemove', (e) => {
        if (mouseUpdateTicking) return;
        mouseUpdateTicking = true;

        requestAnimationFrame(() => {
          const rect = signParallaxWrapper.getBoundingClientRect();
          const signCenterX = rect.left + rect.width / 2;
          const signCenterY = rect.top + rect.height / 2;

          // Calculate distance from mouse to sign center
          const deltaX = e.clientX - signCenterX;
          const deltaY = e.clientY - signCenterY;
          const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
          const maxDistance = 800; // Magnetic attraction radius

          // Normalize distance (0 = at center, 1 = far away)
          mouseDistance = Math.min(distance / maxDistance, 1);
          isNearMouse = distance < maxDistance;

          if (isNearMouse) {
            // MAGNETIC PULL - sign follows mouse
            const pullStrength = (1 - mouseDistance) * 60; // Stronger when closer
            targetX = (deltaX / maxDistance) * pullStrength;
            targetY = (deltaY / maxDistance) * pullStrength;

            // EXTREME 3D ROTATION based on mouse position
            targetRotY = (deltaX / rect.width) * 25; // More extreme tilt
            targetRotX = -(deltaY / rect.height) * 25;
            targetRotZ = (deltaX / rect.width) * 8; // Add Z rotation for more depth

            // SCALE UP when mouse is near
            targetScale = 1 + (1 - mouseDistance) * 0.15;
          } else {
            // Return to idle state
            targetX = 0;
            targetY = 0;
            targetRotX = 0;
            targetRotY = 0;
            targetRotZ = 0;
            targetScale = 1;
          }

          mouseUpdateTicking = false;
        });
      });

      // JESTER BEAR EASTER EGG - Click 5 times with PLAYFUL animations!
      woodenSign.addEventListener('click', () => {
        clickCount++;

        // Reset timer
        if (clickTimer) clearTimeout(clickTimer);
        clickTimer = setTimeout(() => {
          clickCount = 0;
        }, 2000);

        // PLAYFUL BUBBLY CLICK ANIMATIONS - each click gets progressively more excited!
        const bounceAmount = 1.05 + (clickCount * 0.02); // Grows slightly with each click
        const rotateAmount = 3 + (clickCount * 2); // Wiggles more with each click

        // Quick bubble bounce
        targetScale = bounceAmount;
        setTimeout(() => targetScale = isNearMouse ? 1.05 : 1, 150);

        // Playful wiggle alternating directions
        targetRotZ = clickCount % 2 === 0 ? rotateAmount : -rotateAmount;
        setTimeout(() => targetRotZ = 0, 200);

        // Subtle Y bounce
        targetY = targetY - 10;
        setTimeout(() => targetY = 0, 200);

        // JESTER BEAR APPEARS ON 5th CLICK!
        if (clickCount === 5) {
          spawnJesterBear();
          clickCount = 0;
          // BIG CELEBRATION BOUNCE
          targetScale = 1.2;
          targetRotZ = 15;
          setTimeout(() => {
            targetScale = 1;
            targetRotZ = -15;
          }, 150);
          setTimeout(() => {
            targetRotZ = 0;
          }, 300);
          console.log('ðŸ¤¡ðŸ» JESTER BEAR HAS BEEN SUMMONED! ðŸ»ðŸ¤¡');
        }
      });

      // SPAWN JESTER BEAR RUNNING ACROSS SCREEN
      function spawnJesterBear() {
        const jester = document.createElement('img');
        jester.src = 'https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/sv9big.png';
        jester.style.position = 'fixed';
        jester.style.bottom = '20%';
        jester.style.left = '-150px';
        jester.style.width = '120px';
        jester.style.height = 'auto';
        jester.style.zIndex = '99999';
        jester.style.pointerEvents = 'none';
        jester.style.filter = 'drop-shadow(0 10px 30px rgba(0,0,0,0.5))';
        jester.style.transition = 'left 3s linear, transform 3s ease-in-out';
        jester.style.animation = 'jesterRun 3s linear';

        document.body.appendChild(jester);

        // Animate across screen with bounce
        setTimeout(() => {
          jester.style.left = window.innerWidth + 'px';
          jester.style.transform = 'scaleX(-1)'; // Flip to face right
        }, 50);

        // Remove after animation
        setTimeout(() => {
          jester.remove();
        }, 3200);
      }

      // SCROLL PARALLAX
      let scrollTicking = false;
      window.addEventListener('scroll', () => {
        if (scrollTicking) return;
        scrollTicking = true;

        requestAnimationFrame(() => {
          const scrollY = window.scrollY || window.pageYOffset;
          const maxScroll = 1600;
          const scrollProgress = Math.min(scrollY / maxScroll, 1);

          const moveY = scrollProgress * -100;
          const moveX = Math.sin(scrollProgress * Math.PI * 2) * 50;
          const rotateAmount = scrollProgress * 360;
          const scaleAmount = 1 + scrollProgress * 1;
          const opacity = Math.max(0, 1 - scrollProgress * 1.2);

          woodenSignContainer.style.transform = `translate(-50%, calc(-50% + ${moveY}px)) translateX(${moveX}px) rotate(${rotateAmount}deg) scale(${scaleAmount})`;
          woodenSignContainer.style.opacity = opacity;

          scrollTicking = false;
        });
      });

      // START ANIMATION
      animate();

      console.log('ðŸŽ¨ðŸ’¥ EPIC 3D PARALLAX SIGN IS ALIVE! Move your mouse near it! Click 5 times for JESTER BEAR! ðŸ’¥ðŸŽ¨');
    })();
  </script>

  <style>
    @keyframes signGoNuts {
      0% { transform: scale(1) rotate(0deg); }
      10% { transform: scale(1.25) rotate(10deg); }
      20% { transform: scale(0.9) rotate(-10deg); }
      30% { transform: scale(1.15) rotate(8deg); }
      40% { transform: scale(0.95) rotate(-8deg); }
      50% { transform: scale(1.2) rotate(12deg); }
      60% { transform: scale(0.92) rotate(-5deg); }
      70% { transform: scale(1.1) rotate(5deg); }
      80% { transform: scale(0.97) rotate(-3deg); }
      90% { transform: scale(1.05) rotate(2deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    #woodenSign {
      cursor: pointer;
      transition: filter 0.3s ease, transform 0.3s ease;
      will-change: transform, filter;
    }

    #woodenSignContainer {
      will-change: transform, opacity;
      pointer-events: auto;
    }

    /* Responsive sizing */
    @media (max-width: 768px) {
      #signParallaxWrapper {
        width: 280px !important;
      }
      #woodenSignContainer {
        top: 35% !important;
      }
    }
  </style>

  <!-- Structured data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "BEAR Park",
    "url": "https://bearpark.xyz/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://bearpark.xyz/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>

  <script>
  // === API CONFIGURATION ===
  const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
    ? 'http://localhost:3000'
    : '';

  // === HERO CHARACTER SCROLL ANIMATION ===
  (function initCharacterAnimation(){
    const character = document.getElementById('heroCharacter');
    if (!character) return;

    let ticking = false;

    function updateCharacterPosition() {
      const scrollY = window.scrollY || window.pageYOffset;
      const heroSection = document.querySelector('.hero');
      const overviewSection = document.getElementById('bear-overview');

      if (!heroSection || !overviewSection) return;

      const heroHeight = heroSection.offsetHeight;

      // Calculate how much to slide the bear down based on scroll
      // When scrollY = 0: bear at 50% (initial position from CSS)
      // When scrollY = heroHeight: bear at 150% (fully slid down behind banner)
      const scrollRatio = Math.min(scrollY / heroHeight, 1);
      const slideAmount = 50 + (scrollRatio * 100); // From 50% to 150%

      character.style.transform = `translateY(${slideAmount}%)`;

      // Optional: slight fade as it slides down
      const opacity = Math.max(0.5, 1 - (scrollRatio * 0.5));
      character.style.opacity = opacity;

      ticking = false;
    }

    function requestTick() {
      if (!ticking) {
        window.requestAnimationFrame(updateCharacterPosition);
        ticking = true;
      }
    }

    // Initial position
    updateCharacterPosition();

    // Listen to scroll events
    window.addEventListener('scroll', requestTick, { passive: true });
    window.addEventListener('resize', updateCharacterPosition);
  })();

  // === AUTHENTICATION CHECK - Prevent bypass ===
  (function checkAuth(){
    const isAuthenticated = localStorage.getItem('bearpark_auth');
    const authenticatedWallet = localStorage.getItem('bearpark_wallet');

    // If not authenticated, redirect to login page
    if(isAuthenticated !== 'true' || !authenticatedWallet){
      window.location.href = 'index.html';
      return;
    }

    // Optional: Display wallet address in console for debugging
    console.log('Authenticated wallet:', authenticatedWallet);

    // Add logout button inside drawer
    const logoutBtn = document.createElement('button');
    logoutBtn.className = 'drawer-disconnect-btn';
    logoutBtn.innerHTML = '<span>disconnect</span>';
    logoutBtn.setAttribute('aria-label', 'Disconnect wallet and logout');
    logoutBtn.addEventListener('click', function(){
      if(confirm('Are you sure you want to disconnect your wallet?')){
        localStorage.removeItem('bearpark_auth');
        localStorage.removeItem('bearpark_wallet');
        window.location.href = 'index.html';
      }
    });
    const disconnectContainer = document.getElementById('drawerDisconnectContainer');
    if(disconnectContainer){
      disconnectContainer.appendChild(logoutBtn);
    }
  })();

  document.documentElement.classList.remove('no-js');

  /* Input modality hint */
  document.addEventListener('mousedown',()=>document.body.classList.add('using-mouse'));
  document.addEventListener('keydown',()=>document.body.classList.remove('using-mouse'));

  /* ===== Scroll reveal ===== */
  const io=new IntersectionObserver((entries)=>entries.forEach(e=>{
    if(e.isIntersecting){
      e.target.classList.add('in'); io.unobserve(e.target);
    }
  }),{threshold:.15});
  document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

  /* ===== Sticky nav scroll progress + scrollspy ===== */
  (function(){
    const progress = document.getElementById('progress');
    const links = Array.from(document.querySelectorAll('.links a'));
    const sections = links.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);

    function spy(){
      const de=document.documentElement;
      const scrollTop = de.scrollTop || document.body.scrollTop;
      const scrollHeight = de.scrollHeight - de.clientHeight;
      const pct = scrollHeight ? scrollTop / scrollHeight : 0;
      if(progress) progress.style.transform = `scaleX(${pct})`;

      let activeIndex = sections.findIndex((sec, i) => {
        const next = sections[i+1];
        const top = sec.offsetTop - 120;
        const bottom = next ? next.offsetTop - 120 : Infinity;
        return scrollTop >= top && scrollTop < bottom;
      });
      links.forEach((a,i)=> a.setAttribute('aria-current', i===activeIndex ? 'true' : 'false'));
    }
    document.addEventListener('scroll', spy, {passive:true});
    window.addEventListener('resize', spy);
    spy();
  })();

  /* ===== Hero parallax ===== */
  (function(){
    const plate=document.getElementById('heroPlate');
    if(!plate) return;
    if (matchMedia('(prefers-reduced-motion: reduce)').matches) return;

    function tilt(x,y){
      const rX = (y-0.5)*10;
      const rY = (x-0.5)*-10;
      plate.style.transform = `perspective(800px) rotateX(${rX}deg) rotateY(${rY}deg) translateZ(0)`;
    }
    function reset(){ plate.style.transform='perspective(800px) rotateX(0) rotateY(0)'; }

    window.addEventListener('mousemove',e=>{
      const r=plate.getBoundingClientRect();
      tilt((e.clientX-r.left)/r.width,(e.clientY-r.top)/r.height);
    });
    window.addEventListener('mouseleave',reset);
  })();

  /* ===== Magnetic buttons (skip on touch) ===== */
  (function(){
    if (matchMedia('(pointer: coarse)').matches) return;
    const strength = 14;
    const maxShift = 10;

    document.querySelectorAll('.btn').forEach(btn=>{
      let raf = null;
      function onMove(e){
        if (raf) cancelAnimationFrame(raf);
        raf = requestAnimationFrame(()=>{
          const rect = btn.getBoundingClientRect();
          const cx = rect.left + rect.width/2;
          const cy = rect.top + rect.height/2;
          const dx = Math.max(-maxShift, Math.min(maxShift, (e.clientX - cx)/strength));
          const dy = Math.max(-maxShift, Math.min(maxShift, (e.clientY - cy)/strength));
          btn.style.transform = `translate(${dx}px, ${dy}px)`;
        });
      }
      btn.addEventListener('mousemove', onMove);
      btn.addEventListener('mouseleave', ()=>{
        if (raf) cancelAnimationFrame(raf);
        btn.style.transform = 'translate(0,0)';
      });
    });
  })();

  /* ===== Carousel: a11y + keys + swipe + zoom/pan ===== */
  (function(){
    const slides = document.getElementById('slides');
    const viewport = document.getElementById('viewport');
    const prevBtn = document.getElementById('carouselPrev');
    const nextBtn = document.getElementById('carouselNext');
    if(!slides || !viewport) return;

    const imgs = slides.querySelectorAll('img');
    const dotsWrap = document.getElementById('dots');

    const Z_MIN = 1, Z_MAX = 4;
    let idx=0, n=imgs.length, timer=null, userPaused=false;
    let isDrag=false, startX=0, deltaX=0, dragged=false;
    let scale=1, panX=0, panY=0, pinchStartDist=0, startScale=1, lastX=0, lastY=0;
    let zoomGesture=false;

    imgs.forEach((_,i)=>{
      const b=document.createElement('button');
      b.type='button';
      b.className='dot'+(i===0?' active':'');
      b.setAttribute('role','tab');
      b.setAttribute('aria-selected', i===0 ? 'true' : 'false');
      b.setAttribute('aria-label', `Show slide ${i+1} of ${n}`);
      b.addEventListener('click', ()=>go(i,true));
      dotsWrap.appendChild(b);
    });
    const dots=[...dotsWrap.children];

    function applyZoom(){ imgs[idx].style.transform = `translate(${panX}px, ${panY}px) scale(${scale})`; }
    function resetZoom(all=false){
      scale=1; panX=0; panY=0;
      (all?imgs:[imgs[idx]]).forEach(i=>{
        i.style.transition='transform .2s ease';
        i.style.transform='scale(1)';
        setTimeout(()=>i.style.transition='',200);
      });
    }
    function clampPan(){
      const vw=viewport.clientWidth, vh=viewport.clientHeight;
      const maxX=(vw*(scale-1))/2, maxY=(vh*(scale-1))/2;
      panX=Math.max(-maxX,Math.min(maxX,panX));
      panY=Math.max(-maxY,Math.min(maxY,panY));
    }
    function go(i, user){
      resetZoom(true);
      idx=(i+n)%n;
      slides.style.transition='transform .7s var(--ease-spring)';
      slides.style.transform=`translateX(-${idx*100}%)`;
      dots.forEach((d,k)=>{
        const active = k===idx;
        d.classList.toggle('active',active);
        d.setAttribute('aria-selected', active ? 'true' : 'false');
      });
      viewport.setAttribute('aria-label', `Carousel viewport â€” slide ${idx+1} of ${n}`);
      if(user && !userPaused) restart();
    }
    function next(){ go(idx+1,false) }
    function restart(){
      clearInterval(timer);
      timer=setInterval(()=>{ if(!userPaused && scale===1) next(); },4000);
    }

    // Arrow button navigation
    if(prevBtn) {
      prevBtn.addEventListener('click', (e)=>{
        e.stopPropagation();
        go(idx-1, true);
      });
    }
    if(nextBtn) {
      nextBtn.addEventListener('click', (e)=>{
        e.stopPropagation();
        go(idx+1, true);
      });
    }

    viewport.addEventListener('mousedown',e=>{
      isDrag=true; dragged=false; startX=e.clientX; lastX=e.clientX; lastY=e.clientY;
      viewport.classList.add('grabbing'); clearInterval(timer);
    });
    window.addEventListener('mousemove',e=>{
      if(!isDrag) return;
      if(scale>1){
        const dx=e.clientX-lastX, dy=e.clientY-lastY;
        lastX=e.clientX; lastY=e.clientY; panX+=dx; panY+=dy; clampPan(); applyZoom(); dragged=true; return;
      }
      deltaX=e.clientX-startX;
      slides.style.transition='none';
      slides.style.transform=`translateX(${ -idx*100 + (deltaX/viewport.clientWidth)*100 }%)`;
      if(Math.abs(deltaX)>3) dragged=true;
    });
    window.addEventListener('mouseup',()=>{
      if(!isDrag) return;
      isDrag=false; viewport.classList.remove('grabbing');
      if(scale>1){ if(!userPaused) restart(); return; }
      const threshold = viewport.clientWidth*0.12;
      if(Math.abs(deltaX)>threshold){ go(idx + (deltaX<0?1:-1), true); } else { go(idx,false); }
      if(!userPaused) restart();
    });

    viewport.addEventListener('click',()=>{
      if(dragged || scale>1 || zoomGesture) return;
      userPaused=!userPaused;
      if(userPaused) clearInterval(timer); else restart();
    });
    viewport.addEventListener('keydown',e=>{
      if(e.key==='ArrowRight'){ go(idx+1,true); }
      else if(e.key==='ArrowLeft'){ go(idx-1,true); }
      else if(e.key===' '){ userPaused=!userPaused; if(userPaused) clearInterval(timer); else restart(); e.preventDefault(); }
    });

    viewport.addEventListener('touchstart',e=>{
      if(e.touches.length===2){
        zoomGesture=true; clearInterval(timer);
        const [a,b]=e.touches; pinchStartDist=Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY); startScale=scale;
      } else if(e.touches.length===1){
        dragged=false; startX=e.touches[0].clientX; lastX=e.touches[0].clientX; lastY=e.touches[0].clientY;
      }
    },{passive:false});

    viewport.addEventListener('touchmove',e=>{
      if(zoomGesture && e.touches.length===2){
        e.preventDefault();
        const [a,b]=e.touches; const dist=Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY);
        scale=Math.max(Z_MIN,Math.min(Z_MAX, startScale * (dist/pinchStartDist)));
        clampPan(); applyZoom();
      } else if(scale>1 && e.touches.length===1){
        e.preventDefault();
        const t=e.touches[0]; const dx=t.clientX-lastX, dy=t.clientY-lastY;
        lastX=t.clientX; lastY=t.clientY; panX+=dx; panY+=dy; clampPan(); applyZoom(); dragged=true;
      } else if(scale===1 && e.touches.length===1){
        const x=e.touches[0].clientX; deltaX=x-startX;
        slides.style.transition='none';
        slides.style.transform=`translateX(${ -idx*100 + (deltaX/viewport.clientWidth)*100 }%)`;
      }
    },{passive:false});

    viewport.addEventListener('touchend',e=>{
      if(zoomGesture && e.touches.length<2){
        zoomGesture=false;
        if(scale<=1.01){ scale=1; panX=0; panY=0; applyZoom(); }
        restart(); return;
      }
      if(scale>1){ restart(); return; }
      const threshold = viewport.clientWidth*0.12;
      if(Math.abs(deltaX)>threshold){ go(idx + (deltaX<0?1:-1), true); } else { go(idx,false); }
    });

    viewport.addEventListener('wheel',e=>{
      e.preventDefault(); clearInterval(timer);
      const rect=viewport.getBoundingClientRect();
      const cx=e.clientX-rect.left - rect.width/2;
      const cy=e.clientY-rect.top - rect.height/2;
      const prevScale=scale;
      scale = Math.max(Z_MIN, Math.min(Z_MAX, scale * (e.deltaY>0 ? 0.9 : 1.1)));
      panX = (panX + cx) * (scale/prevScale) - cx;
      panY = (panY + cy) * (scale/prevScale) - cy;
      clampPan(); applyZoom();
    },{passive:false});

    go(0,false);
    restart();
    window.addEventListener('visibilitychange',()=>document.hidden?clearInterval(timer):(!userPaused&&restart()));
  })();

  /* ===== Lazy load Kick iframe ===== */
  function loadKick(){
    const wrap=document.getElementById('kickWrap');
    if(!wrap || wrap.dataset.loaded) return;
    const iframe=document.createElement('iframe');
    iframe.src='https://player.kick.com/bearxrpl?autoplay=true&muted=true';
    iframe.allow='autoplay; encrypted-media; picture-in-picture';
    iframe.title='Kick Stream';
    wrap.innerHTML='';
    wrap.appendChild(iframe);
    wrap.dataset.loaded='1';
  }
  const kickBtn=document.getElementById('kickPlaceholder');
  if(kickBtn){
    kickBtn.addEventListener('click', loadKick);
    const obs=new IntersectionObserver((es,o)=>{
      es.forEach(e=>{ if(e.isIntersecting){ loadKick(); o.disconnect(); } });
    },{rootMargin:'200px'});
    obs.observe(kickBtn);
  }

  /* ===== Ensure all imgs lazy/async if not set ===== */
  document.querySelectorAll('img:not([loading])').forEach(img=>{ img.loading='lazy'; img.decoding='async'; });

  /* ===== Drawer + Prices (consolidated) ===== */
  (function(){
    const PAIR_ID = '4245415200000000000000000000000000000000.rbearguasyu7tuw53rufqzfdwmjhpjeqfw_xrp';
    const DS_URL = `https://api.dexscreener.com/latest/dex/pairs/xrpl/${PAIR_ID}`;

    /* FAB + drawer wiring */
    const fab=document.createElement('button');
    fab.className='fab-buy';
    fab.innerHTML='<span class="txt">BEAR HUB</span>';
    fab.setAttribute('aria-controls','buyDrawer');
    fab.setAttribute('aria-expanded','false');
    fab.setAttribute('aria-label','Open BEAR HUB panel');
    document.body.appendChild(fab);

    const scrim=document.createElement('div');
    scrim.className='drawer-scrim';
    scrim.hidden=true;
    document.body.appendChild(scrim);

    const drawer=document.getElementById('buyDrawer');
    const closeBtn=drawer.querySelector('[data-close-drawer]');

    function openDrawer(){
      drawer.classList.add('open'); scrim.hidden=false;
      fab.setAttribute('aria-expanded','true'); drawer.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
      loadPortfolioData(); // Load wallet portfolio data
      initializeProfileAndNFTs(); // Load profile data and NFTs

      // Hide instruction boxes if user has completed first-time setup OR already has a profile
      const setupComplete = localStorage.getItem('bearpark_profile_setup_complete') === 'true';

      // Check if user already has a profile
      const walletAddress = localStorage.getItem('bearpark_wallet');
      let hasProfile = false;
      if (walletAddress) {
        const profileKey = `bearpark_profile_${walletAddress}`;
        const localProfile = localStorage.getItem(profileKey);
        if (localProfile) {
          try {
            const profile = JSON.parse(localProfile);
            hasProfile = profile.display_name && (profile.avatar_nft || profile.avatar_url);
          } catch (e) {
            hasProfile = false;
          }
        }
      }

      if (setupComplete || hasProfile) {
        setTimeout(() => {
          const profileInstructionsBanner = document.getElementById('profileInstructions');
          const nftInstructionsBanner = document.getElementById('nftInstructions');
          if (profileInstructionsBanner) {
            profileInstructionsBanner.style.display = 'none';
          }
          if (nftInstructionsBanner) {
            nftInstructionsBanner.style.display = 'none';
          }
        }, 100); // Small delay to ensure elements are rendered
      }
    }
    function closeDrawer(){
      drawer.classList.remove('open'); scrim.hidden=true;
      fab.setAttribute('aria-expanded','false'); drawer.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
    }

    function openProfileSetup(){
      const walletAddress = localStorage.getItem('bearpark_wallet');
      if (!walletAddress) {
        openDrawer();
        return;
      }

      // Check if profile is already set
      const profileKey = `bearpark_profile_${walletAddress}`;
      const localProfile = localStorage.getItem(profileKey);

      let hasProfile = false;
      if (localProfile) {
        try {
          const profile = JSON.parse(localProfile);
          // Profile is considered "set" if it has both display_name and avatar
          hasProfile = profile.display_name && (profile.avatar_nft || profile.avatar_url);
        } catch (e) {
          hasProfile = false;
        }
      }

      // Check if user has completed first-time setup OR already has a profile (hide instruction boxes)
      const setupComplete = localStorage.getItem('bearpark_profile_setup_complete') === 'true';
      if (setupComplete || hasProfile) {
        // Hide instruction boxes immediately for returning users
        const profileInstructionsBanner = document.getElementById('profileInstructions');
        const nftInstructionsBanner = document.getElementById('nftInstructions');
        if (profileInstructionsBanner) {
          profileInstructionsBanner.style.display = 'none';
        }
        if (nftInstructionsBanner) {
          nftInstructionsBanner.style.display = 'none';
        }
      }

      if (!hasProfile) {
        console.log('ðŸ» Opening profile setup for new user...');
        // Open drawer and scroll to profile section
        openDrawer();
        setTimeout(() => {
          const profileSection = document.getElementById('profileSection');
          const drawerBody = drawer.querySelector('.drawer-body');

          console.log('ðŸ» Drawer opened, scrolling to profile section...', { profileSection, drawerBody });

          if (profileSection && drawerBody) {
            drawerBody.scrollTo({
              top: profileSection.offsetTop - 20,
              behavior: 'smooth'
            });

            // Add pulsing highlight effect to make it obvious
            profileSection.classList.add('profile-highlight-pulse');

            // Remove highlight after 5 seconds
            setTimeout(() => {
              profileSection.classList.remove('profile-highlight-pulse');
            }, 5000);

            console.log('âœ… Profile section highlighted and scrolled into view!');
          } else {
            console.error('âŒ Could not find profileSection or drawerBody elements!');
          }
        }, 600); // Wait longer for drawer to fully open and render
      } else {
        // Show "BEAR Space coming soon" popup
        showBearSpaceTeaser();
      }
    }

    // Make function globally accessible for inline onclick handler
    window.openProfileSetup = openProfileSetup;

    // Attach click handler to welcome button
    const welcomeBtn = document.getElementById('welcomeBtn');
    if (welcomeBtn) {
      welcomeBtn.addEventListener('click', function() {
        console.log('ðŸ» Welcome button clicked!');
        openProfileSetup();
      });
      console.log('âœ… Welcome button click handler attached successfully');
    } else {
      console.error('âŒ Could not find welcomeBtn element!');
    }

    function showBearSpaceTeaser(){
      // Create popup element
      const popup = document.createElement('div');
      popup.className = 'bear-space-popup';
      popup.innerHTML = `
        <div class="bear-space-popup-content">
          <div class="bear-space-icon">ðŸ»ðŸš€</div>
          <div class="bear-space-title">BEAR SPACE</div>
          <div class="bear-space-subtitle">Coming Soon</div>
          <div class="bear-space-description">Your personal BEAR universe is being prepared...</div>
        </div>
      `;

      // Add to body
      document.body.appendChild(popup);

      // Trigger animation
      setTimeout(() => popup.classList.add('show'), 10);

      // Auto-remove after 3 seconds
      setTimeout(() => {
        popup.classList.remove('show');
        setTimeout(() => popup.remove(), 300);
      }, 3000);

      // Click to dismiss
      popup.addEventListener('click', () => {
        popup.classList.remove('show');
        setTimeout(() => popup.remove(), 300);
      });
    }

    function showSuccessPopup(message, emoji = 'ðŸŽ‰') {
      // Create bubbly success popup
      const popup = document.createElement('div');
      popup.className = 'bear-success-popup';
      popup.innerHTML = `
        <div class="bear-success-popup-content">
          <div class="bear-success-icon">${emoji}</div>
          <div class="bear-success-title">BEARISH SUCCESS!</div>
          <div class="bear-success-message">${message}</div>
          <div class="bear-success-sub">TO THE MOON! ðŸš€ðŸ»</div>
        </div>
      `;

      // Add to body
      document.body.appendChild(popup);

      // Trigger animation
      setTimeout(() => popup.classList.add('show'), 10);

      // Auto-remove after 4 seconds
      setTimeout(() => {
        popup.classList.remove('show');
        setTimeout(() => popup.remove(), 500);
      }, 4000);

      // Click to dismiss
      popup.addEventListener('click', () => {
        popup.classList.remove('show');
        setTimeout(() => popup.remove(), 500);
      });
    }

    // ===== CONFETTI CELEBRATION SYSTEM ðŸŽ‰ =====
    function createConfetti(options = {}) {
      const {
        x = window.innerWidth / 2,
        y = window.innerHeight / 2,
        count = 50,
        spread = 360,
        colors = ['#edb723', '#680cd9', '#feb501', '#07ae08', '#d75c46', '#fff']
      } = options;

      const confettiContainer = document.createElement('div');
      confettiContainer.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9999;
      `;
      document.body.appendChild(confettiContainer);

      for (let i = 0; i < count; i++) {
        const confetti = document.createElement('div');
        const color = colors[Math.floor(Math.random() * colors.length)];
        const size = Math.random() * 10 + 5;
        const angle = (spread / count) * i + (Math.random() - 0.5) * 30;
        const velocity = Math.random() * 300 + 200;
        const rotation = Math.random() * 360;
        const rotationSpeed = (Math.random() - 0.5) * 720;

        confetti.style.cssText = `
          position: absolute;
          left: ${x}px;
          top: ${y}px;
          width: ${size}px;
          height: ${size}px;
          background: ${color};
          opacity: 1;
          transform: rotate(${rotation}deg);
          border-radius: ${Math.random() > 0.5 ? '50%' : '2px'};
        `;

        confettiContainer.appendChild(confetti);

        const rad = (angle * Math.PI) / 180;
        const vx = Math.cos(rad) * velocity;
        const vy = Math.sin(rad) * velocity - 100;

        let posX = x;
        let posY = y;
        let velX = vx;
        let velY = vy;
        let rot = rotation;
        let opacity = 1;
        let startTime = Date.now();

        function animate() {
          const elapsed = (Date.now() - startTime) / 1000;
          if (elapsed > 3 || opacity <= 0) {
            confetti.remove();
            return;
          }

          velY += 500 * 0.016; // gravity
          velX *= 0.99; // air resistance
          posX += velX * 0.016;
          posY += velY * 0.016;
          rot += rotationSpeed * 0.016;
          opacity = Math.max(0, 1 - elapsed / 3);

          confetti.style.transform = `translate(${posX - x}px, ${posY - y}px) rotate(${rot}deg)`;
          confetti.style.opacity = opacity;

          requestAnimationFrame(animate);
        }

        requestAnimationFrame(animate);
      }

      setTimeout(() => confettiContainer.remove(), 3500);
    }

    // Confetti presets
    window.celebrateRaidWin = function() {
      createConfetti({ count: 100, spread: 360, y: window.innerHeight * 0.4 });
      setTimeout(() => createConfetti({ count: 50, spread: 180, y: window.innerHeight * 0.3 }), 200);
    };

    window.celebrateGameWin = function() {
      createConfetti({ count: 80, spread: 120, y: window.innerHeight * 0.5 });
    };

    window.celebrateAchievement = function() {
      createConfetti({ count: 60, spread: 90 });
    };

    window.celebrateProfileSave = function() {
      createConfetti({ count: 40, spread: 60, colors: ['#edb723', '#fff', '#680cd9'] });
    };

    // ===== ANIMATED COUNTER SYSTEM ðŸ”¢ =====
    function animateCounter(element, start, end, duration = 1000, suffix = '') {
      if (!element) return;

      const startTime = Date.now();
      const range = end - start;

      function update() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);

        // Ease out cubic
        const easeProgress = 1 - Math.pow(1 - progress, 3);
        const current = Math.floor(start + range * easeProgress);

        element.textContent = current.toLocaleString() + suffix;
        element.style.transform = `scale(${1 + (1 - progress) * 0.2})`;

        if (progress < 1) {
          requestAnimationFrame(update);
        } else {
          element.style.transform = 'scale(1)';
        }
      }

      element.style.transition = 'transform 0.3s ease';
      requestAnimationFrame(update);
    }

    window.animateCounter = animateCounter;

    // Expose functions to global scope for onclick handlers
    window.openProfileSetup = openProfileSetup;
    window.showBearSpaceTeaser = showBearSpaceTeaser;

    fab.addEventListener('click', openDrawer);
    closeBtn.addEventListener('click', closeDrawer);
    scrim.addEventListener('click', closeDrawer);
    window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeDrawer(); });

    const navBuy=document.querySelector('.nav-cta a[href="#network"]');
    if(navBuy){
      navBuy.addEventListener('click', (e)=>{ e.preventDefault(); openDrawer(); });
    }

    /* Build big duo metric lines (XRP first) */
    const priceCard = document.querySelector('.price-card');
    const metric = priceCard?.querySelector('.metric');
    const legacyUsdEl = document.getElementById('priceUsd');
    const volUsdEl = document.getElementById('vol24');
    const mcapUsdEl = document.getElementById('mcapUsd'); // NEW

    if (metric && !document.getElementById('bearXrpBig')) {
      metric.classList.add('duo');
      if (legacyUsdEl) legacyUsdEl.style.display='none';
      const usdSmall = legacyUsdEl && legacyUsdEl.nextElementSibling?.tagName==='SMALL' ? legacyUsdEl.nextElementSibling : null;
      if (usdSmall) usdSmall.style.display='none';

      const wrap=document.createElement('div');
      wrap.innerHTML =
        `<div class="line"><span class="label" style="white-space: nowrap; display: inline-flex; align-items: center; gap: 4px;"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/esp426.png" alt="BEAR" style="height:0.9em; width:auto; display:inline-block;">BEAR / <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/lufprf.png" alt="XRP" style="height:0.9em; width:auto; display:inline-block;">XRP</span><span id="bearXrpBig" class="price">â€”</span></div>
         <div class="line"><span class="label" style="white-space: nowrap; display: inline-flex; align-items: center; gap: 4px;"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/esp426.png" alt="BEAR" style="height:0.9em; width:auto; display:inline-block;">BEAR / ðŸ’µ USD</span><span id="bearUsdBig" class="price">â€”</span></div>`;
      metric.prepend(wrap);

      const st=document.createElement('style');
      st.textContent=
        `.price-card .metric.duo{flex-direction:column;align-items:flex-start;gap:.4rem}
         .price-card .metric .line{display:flex;align-items:baseline;gap:.6rem;flex-wrap:wrap}
         .price-card .metric .label{color:var(--gold);font-weight:900;letter-spacing:.3px}
         .price-card .metric .price{color:#fff;font-weight:900}`;
      document.head.appendChild(st);
    }

    function $id(id){ return document.getElementById(id); }
    const fmt = (n, min=2, max=8) => Number(n).toLocaleString(undefined,{minimumFractionDigits:min, maximumFractionDigits:max});
    const fmt0 = (n) => Number(n).toLocaleString(undefined,{maximumFractionDigits:0});

    async function fetchDex(){
      const r=await fetch(DS_URL,{cache:'no-store'});
      if(!r.ok) throw new Error('Price API HTTP '+r.status);
      const j=await r.json();
      const p=j?.pairs?.[0];
      if(!p) throw new Error('Pair not found');
      return {
        priceNative: Number(p.priceNative),
        priceUsd: p.priceUsd!=null?Number(p.priceUsd):NaN,
        vol24Usd: Number(p.volume?.h24 ?? p.volume24h ?? 0),
        // NEW: Prefer marketCap; fallback to fdv
        mcapUsd: Number((p.marketCap ?? p.fdv) ?? NaN),
        // Add liquidity data
        liquidityUsd: Number(p.liquidity?.usd ?? 0),
        // Add 24h price change
        priceChange24h: Number(p.priceChange?.h24 ?? 0)
      };
    }

    // Fetch XRP/USD price
    async function fetchXrpPrice(){
      try {
        const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd', {cache:'no-store'});
        if (!r.ok) return 2.5; // fallback
        const j = await r.json();
        return Number(j?.ripple?.usd ?? 2.5);
      } catch {
        return 2.5; // fallback
      }
    }

    async function updatePrices(){
      try{
        const {priceNative, priceUsd, vol24Usd, mcapUsd, liquidityUsd, priceChange24h} = await fetchDex();
        const xrpPrice = await fetchXrpPrice();
        const xrpLine = $id('bearXrpBig');
        const usdLine = $id('bearUsdBig');

        if (Number.isFinite(priceNative) && xrpLine){
          const d = priceNative >= 1 ? {min:3,max:6} : {min:4,max:8};
          xrpLine.textContent = fmt(priceNative, d.min, d.max);
        }
        const usdVal = Number.isFinite(priceUsd) ? priceUsd : NaN;
        if (Number.isFinite(usdVal) && usdLine){
          usdLine.textContent = fmt(usdVal, 5, 8);
        }
        if (volUsdEl){
          const vol = Number.isFinite(vol24Usd) ? vol24Usd : NaN;
          if (Number.isFinite(vol)) volUsdEl.textContent = '$' + fmt0(vol);
        }
        // NEW: Market Cap update
        if (mcapUsdEl && Number.isFinite(mcapUsd)){
          mcapUsdEl.textContent = '$' + fmt0(mcapUsd);
        }

        if (legacyUsdEl && legacyUsdEl.textContent.trim()==='â€”' && Number.isFinite(usdVal)){
          legacyUsdEl.textContent = fmt(usdVal, 5, 8);
        }

        // Update Honey Points section
        updateHoneyPrices(priceNative, priceUsd, vol24Usd, mcapUsd, liquidityUsd, priceChange24h, xrpPrice);
      }catch(err){
        console.debug('Price update failed', err);
      }
    }

    function updateHoneyPrices(priceNative, priceUsd, vol24Usd, mcapUsd, liquidityUsd, priceChange24h, xrpPrice){
      // Update price stats
      const honeyPriceXrp = $id('honeyPriceXrp');
      const honeyPriceUsd = $id('honeyPriceUsd');
      const honeyVolume = $id('honeyVolume');
      const honeyVolumeXrp = $id('honeyVolumeXrp');
      const honeyMcap = $id('honeyMcap');
      const honeyMcapXrp = $id('honeyMcapXrp');
      const honeyChange24h = $id('honeyChange24h');
      const honeyChange24hXrp = $id('honeyChange24hXrp');
      const liquidityBear = $id('liquidityBear');
      const liquidityXrp = $id('liquidityXrp');
      const liquidityUsdEl = $id('liquidityUsd');
      const liquidityMcapRatio = $id('liquidityMcapRatio');

      if (honeyPriceXrp && Number.isFinite(priceNative)){
        const d = priceNative >= 1 ? {min:3,max:6} : {min:4,max:8};
        honeyPriceXrp.textContent = fmt(priceNative, d.min, d.max) + ' XRP';
      }

      if (honeyPriceUsd && Number.isFinite(priceUsd)){
        honeyPriceUsd.textContent = '$' + fmt(priceUsd, 5, 8);
      }

      if (honeyVolume && Number.isFinite(vol24Usd)){
        honeyVolume.textContent = '$' + fmt0(vol24Usd);
      }

      // Calculate XRP 24h volume
      if (honeyVolumeXrp && Number.isFinite(vol24Usd) && Number.isFinite(xrpPrice)){
        const vol24Xrp = vol24Usd / xrpPrice;
        honeyVolumeXrp.textContent = fmt0(vol24Xrp) + ' XRP';
      }

      if (honeyMcap && Number.isFinite(mcapUsd)){
        honeyMcap.textContent = '$' + fmt0(mcapUsd);
      }

      // Calculate XRP market cap
      if (honeyMcapXrp && Number.isFinite(mcapUsd) && Number.isFinite(xrpPrice)){
        const mcapXrp = mcapUsd / xrpPrice;
        honeyMcapXrp.textContent = fmt0(mcapXrp) + ' XRP';
      }

      // Update 24h change with color coding (same for both USD and XRP)
      if (honeyChange24h && Number.isFinite(priceChange24h)){
        const sign = priceChange24h >= 0 ? '+' : '';
        honeyChange24h.textContent = sign + priceChange24h.toFixed(2) + '%';
        honeyChange24h.style.color = priceChange24h >= 0 ? '#4ade80' : '#f87171';
      }

      // Update XRP 24h change (same percentage as USD)
      if (honeyChange24hXrp && Number.isFinite(priceChange24h)){
        const sign = priceChange24h >= 0 ? '+' : '';
        honeyChange24hXrp.textContent = sign + priceChange24h.toFixed(2) + '%';
        honeyChange24hXrp.style.color = priceChange24h >= 0 ? '#4ade80' : '#f87171';
      }

      // Calculate liquidity values
      if (liquidityUsdEl && Number.isFinite(liquidityUsd)){
        liquidityUsdEl.textContent = '$' + fmt0(liquidityUsd);
      }

      // Calculate BEAR liquidity (half of total liquidity USD / BEAR price)
      if (liquidityBear && Number.isFinite(liquidityUsd) && Number.isFinite(priceUsd)){
        const bearLiq = (liquidityUsd / 2) / priceUsd;
        liquidityBear.textContent = fmt0(bearLiq) + ' BEAR';
      }

      // Calculate XRP liquidity using real XRP price
      if (liquidityXrp && Number.isFinite(liquidityUsd) && Number.isFinite(xrpPrice)){
        // Assume roughly half of liquidity is in XRP
        const xrpLiq = (liquidityUsd / 2) / xrpPrice;
        liquidityXrp.textContent = fmt0(xrpLiq) + ' XRP';
      }

      // Calculate Liquidity to Market Cap Ratio
      if (liquidityMcapRatio && Number.isFinite(liquidityUsd) && Number.isFinite(mcapUsd) && mcapUsd > 0){
        const ratio = (liquidityUsd / mcapUsd) * 100;
        liquidityMcapRatio.textContent = ratio.toFixed(2) + '%';
      }
    }
    updatePrices();
    setInterval(updatePrices, 60000);
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) updatePrices(); });

    /* ===== Chart Loading Detection ===== */
    const chartIframe = document.getElementById('dexscreener-embed');
    const chartError = document.getElementById('chart-error');

    if (chartIframe && chartError) {
      // Check if iframe loaded after 10 seconds
      setTimeout(() => {
        try {
          // Try to access iframe - if it fails, it might be blocked
          const iframeDoc = chartIframe.contentDocument || chartIframe.contentWindow.document;
          if (!iframeDoc || iframeDoc.readyState !== 'complete') {
            console.warn('Chart iframe may not have loaded properly');
          }
        } catch (e) {
          // CORS error is expected and means it's loading from external source (good)
          // Do nothing - this is normal for cross-origin iframes
        }
      }, 10000);

      // Handle iframe errors
      chartIframe.onerror = () => {
        console.error('Chart iframe failed to load');
        chartIframe.style.display = 'none';
        chartError.style.display = 'flex';
      };
    }

    /* ===== Portfolio & Points Functions ===== */
    async function loadPortfolioData() {
      const walletAddress = localStorage.getItem('bearpark_wallet');
      const isAuthenticated = localStorage.getItem('bearpark_auth') === 'true';

      const portfolioSection = document.getElementById('portfolioSection');
      const connectedWalletAddress = document.getElementById('connectedWalletAddress');

      if (!isAuthenticated || !walletAddress) {
        portfolioSection.style.display = 'none';
        return;
      }

      // Show portfolio section
      portfolioSection.style.display = 'block';
      connectedWalletAddress.textContent = walletAddress;

      // Check if xrpl library is loaded
      if (typeof xrpl === 'undefined') {
        console.error('[Portfolio] XRPL library not loaded!');
        document.getElementById('portfolioBearAmount').textContent = 'Error: Library not loaded';
        return;
      }

      try {
        // Set loading states
        document.getElementById('portfolioBearAmount').textContent = 'Loading...';
        document.getElementById('portfolioUsdValue').textContent = 'Loading...';
        document.getElementById('portfolioXrpValue').textContent = 'Loading...';

        // Connect to XRPL with fallback nodes
        const xrplNodes = [
          'wss://xrplcluster.com',
          'wss://s1.ripple.com',
          'wss://s2.ripple.com'
        ];

        let client = null;
        let lastError = null;

        for (const node of xrplNodes) {
          try {
            client = new xrpl.Client(node);
            await client.connect();
            break;
          } catch (err) {
            lastError = err;
            if (client) {
              try { await client.disconnect(); } catch(e) {}
            }
            client = null;
          }
        }

        if (!client) {
          console.error('[Portfolio] Unable to connect to any XRPL node');
          throw new Error('Unable to connect to XRPL nodes');
        }

        // Get $BEAR balance
        const accountLines = await client.request({
          command: 'account_lines',
          account: walletAddress,
          ledger_index: 'validated'
        });

        const BEAR_ISSUER = 'rBEARGUAsyu7tUw53rufQzFdWmJHpJEqFW';
        const BEAR_CURRENCY = 'BEAR';
        const BEAR_CURRENCY_HEX = '4245415200000000000000000000000000000000'; // "BEAR" in hex

        const bearLine = accountLines.result.lines.find(line =>
          line.account === BEAR_ISSUER &&
          (line.currency === BEAR_CURRENCY || line.currency === BEAR_CURRENCY_HEX)
        );

        const bearBalance = bearLine ? parseFloat(bearLine.balance) : 0;

        // Update BEAR amount immediately
        document.getElementById('portfolioBearAmount').textContent = bearBalance.toLocaleString('en-US', { maximumFractionDigits: 2 });

        // Fetch fresh price data from API
        try {
          const {priceNative, priceUsd} = await fetchDex();

          // Calculate values
          const usdValue = bearBalance * priceUsd;
          const xrpValue = bearBalance * priceNative;

          // Update UI with calculated values
          if (priceUsd > 0) {
            document.getElementById('portfolioUsdValue').textContent = '$' + usdValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
          } else {
            document.getElementById('portfolioUsdValue').textContent = 'Loading...';
          }

          if (priceNative > 0) {
            document.getElementById('portfolioXrpValue').textContent = xrpValue.toLocaleString('en-US', { maximumFractionDigits: 4 }) + ' XRP';
          } else {
            document.getElementById('portfolioXrpValue').textContent = 'Loading...';
          }
        } catch (priceErr) {
          console.error('[Portfolio] Error fetching prices:', priceErr);
          document.getElementById('portfolioUsdValue').textContent = 'N/A';
          document.getElementById('portfolioXrpValue').textContent = 'N/A';
        }

        await client.disconnect();

      } catch (err) {
        console.error('[Portfolio] ERROR loading portfolio:', err);
        console.error('[Portfolio] Error stack:', err.stack);
        document.getElementById('portfolioBearAmount').textContent = 'Error: ' + err.message;
        document.getElementById('portfolioUsdValue').textContent = 'Error';
        document.getElementById('portfolioXrpValue').textContent = 'Error';
      }

      // Load points data (will be implemented with backend)
      loadPointsData(walletAddress);
    }

    async function loadPointsData(walletAddress) {
      try {
        const response = await fetch(`${API_BASE_URL}/api/points/${walletAddress}`);
        if (!response.ok) {
          console.debug('Points API not available');
          return;
        }
        const data = await response.json();

        if (data.twitter_connected) {
          // Show connected state (with defensive checks)
          const pointsConnected = document.getElementById('pointsConnected');
          const pointsNotConnected = document.getElementById('pointsNotConnected');
          const totalPoints = document.getElementById('totalPoints');
          const connectedTwitter = document.getElementById('connectedTwitter');

          if (pointsConnected) pointsConnected.style.display = 'block';
          if (pointsNotConnected) pointsNotConnected.style.display = 'none';
          if (totalPoints) totalPoints.textContent = data.total_points;
          if (connectedTwitter) connectedTwitter.textContent = data.twitter_username;

          // Load activity (with defensive checks)
          const activityList = document.getElementById('activityList');
          if (activityList) {
            if (data.recent_activity && data.recent_activity.length > 0) {
              activityList.innerHTML = data.recent_activity.map(activity => {
                const date = new Date(activity.created_at);
                const timeAgo = getTimeAgo(date);
                const points = activity.points_change > 0 ? `+${activity.points_change}` : activity.points_change;
                return `
                  <div style="display:flex; justify-content:space-between; padding:8px; background:rgba(255,255,255,0.05); border-radius:6px; margin-bottom:6px;">
                    <span style="font-size:12px;">${activity.description || activity.transaction_type}</span>
                    <span style="color:var(--gold); font-weight:900; font-size:12px;">${points} pts</span>
                  </div>
                `;
              }).join('');
            } else {
              activityList.innerHTML = '<div style="opacity:0.6; padding:12px; text-align:center;">No recent activity</div>';
            }
          }

          // Load active raids
          loadActiveRaids();
        } else {
          // Show not connected state (with defensive checks)
          const pointsConnected = document.getElementById('pointsConnected');
          const pointsNotConnected = document.getElementById('pointsNotConnected');
          if (pointsConnected) pointsConnected.style.display = 'none';
          if (pointsNotConnected) pointsNotConnected.style.display = 'block';
        }
      } catch (err) {
        console.error('Error loading points:', err);
        // Show not connected state on error (with defensive checks)
        const pointsConnected = document.getElementById('pointsConnected');
        const pointsNotConnected = document.getElementById('pointsNotConnected');
        if (pointsConnected) pointsConnected.style.display = 'none';
        if (pointsNotConnected) pointsNotConnected.style.display = 'block';
      }
    }

    async function loadActiveRaids() {
      try {
        const response = await fetch('/api/raids/active');
        const data = await response.json();

        const activeRaidsSection = document.getElementById('activeRaids');
        const raidInfo = document.getElementById('raidInfo');
        const viewRaidBtn = document.getElementById('viewRaidBtn');

        if (data.success && data.raids && data.raids.length > 0) {
          const raid = data.raids[0]; // Show first active raid
          activeRaidsSection.style.display = 'block';

          raidInfo.innerHTML = `
            <div style="font-weight:900; margin-bottom:4px;">${raid.raid_title}</div>
            <div style="opacity:0.8; font-size:12px;">Target: ${raid.target_account}</div>
            <div style="opacity:0.8; font-size:12px;">Reward: ${raid.points_per_participation} points</div>
          `;

          viewRaidBtn.onclick = () => {
            window.open(raid.raid_url, '_blank');
          };
        } else {
          activeRaidsSection.style.display = 'none';
        }
      } catch (err) {
        console.error('Error loading raids:', err);
        document.getElementById('activeRaids').style.display = 'none';
      }
    }

    /* ===== Honey Points Section Functions ===== */
    async function loadHoneyPoints() {
      const walletAddress = localStorage.getItem('bearpark_wallet');
      const isAuthenticated = localStorage.getItem('bearpark_auth') === 'true';

      // âŒ REMOVED CRITICAL SECURITY EXPLOIT: Never trust localStorage!
      // âŒ Old code would sync LOCAL points to backend if local > backend - HUGE EXPLOIT!
      // âœ… Backend database is the ONLY source of truth

      // Show loading state
      const navHoneyPoints = document.getElementById('navHoneyPoints');
      if (navHoneyPoints) {
        navHoneyPoints.textContent = 'Loading...';
      }

      // Fetch ONLY from backend - never trust localStorage
      try {
        const response = await fetch(`${API_BASE_URL}/api/points/${walletAddress}`);
        if (response.ok) {
          const data = await response.json();

          const backendTotal = data.total_points || 0;
          const backendRaiding = data.raiding_points || 0;
          const backendGames = data.games_points || 0;

          // ALWAYS use backend data - NEVER localStorage
          updatePointsDisplay(backendTotal, backendRaiding, backendGames);
          if (navHoneyPoints) navHoneyPoints.textContent = backendTotal.toFixed(1) + ' PTS';

          // Update header welcome points
          const welcomePoints = document.getElementById('welcomePoints');
          if (welcomePoints) {
            welcomePoints.innerHTML = `HONEY <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;">: ${backendTotal.toFixed(1)} PTS`;
          }

          // âŒ REMOVED localStorage caching - backend is ONLY source of truth
        }

        // Load leaderboard to get rank
        loadHoneyLeaderboard(walletAddress);
      } catch (err) {
        console.error('Backend not available:', err);
        // âŒ NO localStorage fallback - if backend is down, show offline state
        updatePointsDisplay(0, 0, 0);
        if (navHoneyPoints) navHoneyPoints.textContent = 'Offline';
      }
    }

    /* ===== Daily Game Progress ===== */
    async function loadDailyGameProgress() {
      const walletAddress = localStorage.getItem('bearpark_wallet');
      if (!walletAddress) return;

      try {
        // Fetch daily game status from ALL games and sum them up
        const response = await fetch(`${API_BASE_URL}/api/games/daily-status/${walletAddress}/all-games`);

        if (!response.ok) {
          console.debug('Daily game status not available');
          return;
        }

        const data = await response.json();

        if (data.success) {
          const minutesToday = data.minutes_today || 0;
          const maxMinutes = data.max_minutes || 20;
          const remainingMinutes = typeof data.remaining_minutes === 'number' ? data.remaining_minutes : 20;
          const pointsToday = data.points_earned_today || 0;

          // Update UI
          document.getElementById('dailyGameCount').textContent = `${minutesToday.toFixed(1)}/${maxMinutes}`;
          document.getElementById('dailyGamePoints').textContent = `${pointsToday.toFixed(1)} pts earned today`;

          // Show countdown timer when limit reached
          if (remainingMinutes === 0) {
            updateGameResetCountdown();
            startGameResetCountdown(); // Start the interval to update every second
          } else {
            document.getElementById('dailyGamesRemaining').textContent = `${remainingMinutes.toFixed(1)} mins left`;
            document.getElementById('dailyGamesRemaining').style.color = '#ffffff';
          }

          // Update progress bar
          const progressPercent = (minutesToday / maxMinutes) * 100;
          const progressBar = document.getElementById('dailyProgressBar');
          progressBar.style.width = progressPercent + '%';

          // Change color when limit reached
          if (remainingMinutes === 0) {
            progressBar.style.background = 'linear-gradient(90deg, #ff6b6b 0%, #ee5a6f 50%, #ff6b6b 100%)';
            document.getElementById('dailyGamesRemaining').style.color = '#ff6b6b';
          }
        }
      } catch (err) {
        console.debug('Error loading daily game progress:', err);
      }
    }

    // TEST MODE: Set to true to simulate 10 seconds before reset
    window.TEST_COUNTDOWN_MODE = false;

    // Update countdown timer to next UTC midnight
    function updateGameResetCountdown() {
      const now = new Date();
      const tomorrow = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate() + 1, 0, 0, 0));

      // TEST MODE: Simulate being 10 seconds before midnight
      let diff = window.TEST_COUNTDOWN_MODE ? 10000 : (tomorrow - now);

      // Decrease test countdown each second
      if (window.TEST_COUNTDOWN_MODE && window.testCountdownSeconds !== undefined) {
        window.testCountdownSeconds--;
        if (window.testCountdownSeconds <= 0) {
          // Reset happened! Clear daily games in database
          console.log('ðŸ”„ TEST: Countdown reached 0! Resetting daily games...');
          window.TEST_COUNTDOWN_MODE = false;

          // Clear today's game plays from database
          const walletAddress = localStorage.getItem('bearpark_wallet');
          if (walletAddress) {
            fetch(`${API_BASE_URL}/api/games/reset-daily/${walletAddress}`, {
              method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
              console.log('âœ… Daily games reset:', data);
              // Reload game progress and points to show reset
              loadDailyGameProgress();
              loadHoneyPoints();
              const wallet = localStorage.getItem('bearpark_wallet');
              if (wallet) loadHoneyLeaderboard(wallet);
            })
            .catch(err => console.error('Error resetting daily games:', err));
          }
          return;
        }
        diff = window.testCountdownSeconds * 1000;
      } else if (window.TEST_COUNTDOWN_MODE) {
        window.testCountdownSeconds = 10;
        diff = 10000;
      }

      const hours = Math.floor(diff / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);

      const remainingEl = document.getElementById('dailyGamesRemaining');
      if (remainingEl) {
        remainingEl.textContent = `Resets in ${hours}h ${minutes}m ${seconds}s`;

        // Dynamic color based on time remaining
        const totalHours = diff / (1000 * 60 * 60);
        let color;

        if (totalHours > 18) {
          color = '#50fa7b'; // Green - lots of time
        } else if (totalHours > 12) {
          color = '#9aff6e'; // Yellow-green
        } else if (totalHours > 6) {
          color = '#f1fa8c'; // Yellow
        } else if (totalHours > 3) {
          color = '#ffb86c'; // Orange
        } else if (totalHours > 1) {
          color = '#ff8c42'; // Dark orange
        } else {
          color = '#ff6b6b'; // Red - almost reset!
        }

        remainingEl.style.color = color;
        remainingEl.style.textShadow = `0 0 10px ${color}`;
      }
    }

    // Start countdown interval when page loads
    let countdownInterval;
    function startGameResetCountdown() {
      if (countdownInterval) clearInterval(countdownInterval);
      countdownInterval = setInterval(() => {
        const remainingEl = document.getElementById('dailyGamesRemaining');
        if (remainingEl && remainingEl.textContent.includes('Resets in')) {
          updateGameResetCountdown();
        }
      }, 1000);
    }

    function updatePointsDisplay(total, raiding, games, animate = false) {
      const totalEl = document.getElementById('totalHoneyPoints');
      const raidingEl = document.getElementById('raidingPoints');
      const gamesEl = document.getElementById('gamesPoints');

      if (totalEl) {
        if (animate) {
          const oldValue = parseFloat(totalEl.textContent) || 0;
          animateCounter(totalEl, oldValue, total, 800, '');
        } else {
          totalEl.textContent = total.toFixed(1);
        }
      }
      if (raidingEl) raidingEl.textContent = raiding.toFixed(1) + ' PTS';
      if (gamesEl) gamesEl.textContent = games.toFixed(1) + ' PTS';
    }

    async function loadHoneyLeaderboard(currentWallet = null) {
      const leaderboardEl = document.getElementById('honeyLeaderboard');
      if (!leaderboardEl) return;

      try {
        // Include wallet address in request to get rank
        const url = currentWallet
          ? `${API_BASE_URL}/api/leaderboard?limit=15&wallet=${currentWallet}`
          : `${API_BASE_URL}/api/leaderboard?limit=15`;

        const response = await fetch(url);
        if (!response.ok) {
          console.debug('Leaderboard API not available');
          leaderboardEl.innerHTML = '<div class="leaderboard-empty">Leaderboard coming soon!</div>';
          return;
        }
        const data = await response.json();

        // Update user's rank from backend response
        if (currentWallet && data.userRank) {
          const myRankEl = document.getElementById('myRank');
          if (myRankEl) myRankEl.textContent = `#${data.userRank}`;
        }

        if (data.success && data.leaderboard && data.leaderboard.length > 0) {
          leaderboardEl.innerHTML = data.leaderboard.map((entry, index) => {
            const rank = index + 1;
            const isCurrentUser = currentWallet && entry.wallet_address === currentWallet;
            const rankClass = rank <= 3 ? `rank-${rank}` : '';
            const trophy = rank === 1 ? 'ðŸ¥‡' : rank === 2 ? 'ðŸ¥ˆ' : rank === 3 ? 'ðŸ¥‰' : rank;

            // Use custom display name or show abbreviated wallet
            const displayName = entry.display_name || `${entry.wallet_address.substring(0, 6)}...${entry.wallet_address.substring(entry.wallet_address.length - 4)}`;

            // Show avatar if available
            let avatarHTML = '';
            if (entry.avatar_nft) {
              try {
                const avatarData = JSON.parse(entry.avatar_nft);
                const avatarUrl = avatarData.imageUrl || avatarData.fallbackImageUrl;
                if (avatarUrl) {
                  avatarHTML = `<img src="${avatarUrl}"
                       style="width:40px; height:40px; border-radius:50%; border:2px solid var(--gold); object-fit:cover; margin-right:8px;"
                       alt="${displayName} avatar"
                       onerror="this.style.display='none'">`;
                }
              } catch (e) {
                // If not JSON, try using it directly as NFT ID
                avatarHTML = `<img src="https://nft.xrpl-labs.com/${entry.avatar_nft}"
                     style="width:40px; height:40px; border-radius:50%; border:2px solid var(--gold); object-fit:cover; margin-right:8px;"
                     alt="${displayName} avatar"
                     onerror="this.style.display='none'">`;
              }
            }

            return `
              <div class="leaderboard-item ${rankClass}" style="display:flex; align-items:center; gap:12px;">
                <div class="leaderboard-rank ${rank <= 3 ? 'top-3' : ''}">${trophy}</div>
                ${avatarHTML}
                <div class="leaderboard-user" style="flex:1; min-width:0;">
                  <div class="leaderboard-username">${displayName}</div>
                  <div class="leaderboard-wallet">${entry.wallet_address.substring(0, 8)}...${entry.wallet_address.substring(entry.wallet_address.length - 6)}</div>
                </div>
                <div class="leaderboard-points">${entry.total_points.toLocaleString()} <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;"></div>
              </div>
            `;
          }).join('');
        } else {
          leaderboardEl.innerHTML = '<div class="leaderboard-loading">No leaderboard data yet. Start playing to earn points!</div>';
        }
      } catch (err) {
        console.error('Error loading leaderboard:', err);
        leaderboardEl.innerHTML = '<div class="leaderboard-loading">Failed to load leaderboard</div>';
      }
    }

    // Initialize honey points section
    loadHoneyPoints();
    loadDailyGameProgress();
    const walletAddress = localStorage.getItem('bearpark_wallet');
    loadHoneyLeaderboard(walletAddress);
    loadRaids();
    startGameResetCountdown();

    // Listen for game points being awarded to refresh progress widget
    window.addEventListener('gamePointsAwarded', () => {
      loadDailyGameProgress();
      loadHoneyPoints(); // Also refresh total points
    });

    // Refresh data when page becomes visible (e.g., returning from game page)
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) {
        console.log('Page became visible - refreshing honey points data');
        loadDailyGameProgress();
        loadHoneyPoints();
        const wallet = localStorage.getItem('bearpark_wallet');
        if (wallet) loadHoneyLeaderboard(wallet);
      }
    });

    // Also refresh when window gains focus
    window.addEventListener('focus', () => {
      console.log('Window gained focus - refreshing honey points data');
      loadDailyGameProgress();
      loadHoneyPoints();
    });

    // Show admin button if user is admin
    const ADMIN_WALLET = 'rKkkYMCvC63HEgxjQHmayKADaxYqnsMUkT';
    if (walletAddress === ADMIN_WALLET) {
      const adminBtn = document.getElementById('adminRaidBtn');
      if (adminBtn) {
        adminBtn.style.display = 'block';
      }
    }

    // Refresh leaderboard and raids every 2 minutes (reduced from 30s to save bandwidth)
    // Only refresh when tab is visible to prevent unnecessary API calls
    setInterval(() => {
      if (document.hidden) return; // Skip if tab is not visible
      const walletAddress = localStorage.getItem('bearpark_wallet');
      loadHoneyLeaderboard(walletAddress);
      if (!showingPreviousRaids) {
        loadRaids(); // Only refresh if showing current raids
      }
    }, 120000); // 2 minutes instead of 30 seconds

    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      if (seconds < 60) return 'just now';
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return `${minutes}m ago`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours}h ago`;
      const days = Math.floor(hours / 24);
      return `${days}d ago`;
    }

    // Twitter integration removed - points now earned through games and raids only

    /* ===== Raids System ===== */
    let raidTimerIntervals = [];
    let showingPreviousRaids = false;
    let currentRaidsData = {}; // Store raid data by ID for easy access
    let processingRaids = new Set(); // Track which raids are currently being processed
    let pendingDeepLinkRaidId = null; // Track if we're handling a deep link

    /* ===== Deep Link Handling for Discord Raid Links ===== */
    function checkRaidDeepLink() {
      const urlParams = new URLSearchParams(window.location.search);
      const raidId = urlParams.get('raid');
      if (raidId) {
        return parseInt(raidId, 10);
      }
      return null;
    }

    function showRaidToast(message, type = 'info') {
      // Remove existing toast if any
      const existingToast = document.querySelector('.raid-toast');
      if (existingToast) existingToast.remove();

      const toast = document.createElement('div');
      toast.className = `raid-toast raid-toast-${type}`;
      toast.innerHTML = message;
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 16px 24px;
        border-radius: 12px;
        font-weight: 700;
        font-size: 16px;
        z-index: 10000;
        animation: slideDown 0.3s ease;
        max-width: 90%;
        text-align: center;
        ${type === 'error' ? 'background: linear-gradient(135deg, #ff4444, #cc0000); color: white; border: 2px solid #ff6666;' : ''}
        ${type === 'success' ? 'background: linear-gradient(135deg, #07ae08, #05850f); color: white; border: 2px solid #0bd00b;' : ''}
        ${type === 'info' ? 'background: linear-gradient(135deg, #680cd9, #feb501); color: white; border: 2px solid #feb501;' : ''}
      `;
      document.body.appendChild(toast);

      // Auto-remove after 4 seconds
      setTimeout(() => {
        toast.style.animation = 'slideUp 0.3s ease';
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }

    function handleRaidDeepLink(raidId) {
      const walletAddress = localStorage.getItem('bearpark_wallet');

      // Wait for raids to be rendered
      setTimeout(() => {
        const raidCard = document.querySelector(`.raid-item[data-raid-id="${raidId}"]`);

        if (!raidCard) {
          // Raid not found - might be expired or invalid
          showRaidToast('Raid not found or has expired', 'error');
          // Clean URL
          window.history.replaceState({}, document.title, window.location.pathname);
          return;
        }

        // Check if already completed
        const completedRaids = JSON.parse(localStorage.getItem(`completed_raids_${walletAddress}`) || '[]');
        if (completedRaids.includes(raidId)) {
          showRaidToast('You already completed this raid!', 'info');
          window.history.replaceState({}, document.title, window.location.pathname);
          return;
        }

        // Check if wallet connected
        if (!walletAddress) {
          showRaidToast('Connect your wallet first to earn honey points!', 'error');
          // Still scroll to section
          document.getElementById('honey-points').scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
          // Highlight the raid card
          raidCard.style.boxShadow = '0 0 30px var(--stripe-yellow)';
          setTimeout(() => raidCard.style.boxShadow = '', 3000);
          window.history.replaceState({}, document.title, window.location.pathname);
          return;
        }

        // Scroll to honey-points section
        document.getElementById('honey-points').scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });

        // Wait for scroll to complete, then trigger the raid
        setTimeout(() => {
          const raidBtn = raidCard.querySelector('.raid-btn');
          if (raidBtn && !raidBtn.disabled && raidBtn.style.pointerEvents !== 'none') {
            // Highlight briefly then click
            raidCard.style.boxShadow = '0 0 30px var(--stripe-yellow)';
            setTimeout(() => {
              raidBtn.click();
              raidCard.style.boxShadow = '';
            }, 500);
          }
        }, 800);

        // Clean URL to prevent re-trigger on refresh
        window.history.replaceState({}, document.title, window.location.pathname);
      }, 600); // Wait for DOM to render
    }

    async function loadRaids() {
      const walletAddress = localStorage.getItem('bearpark_wallet');

      // Check for deep link on first load
      if (pendingDeepLinkRaidId === null) {
        pendingDeepLinkRaidId = checkRaidDeepLink();
      }

      try {
        const response = await fetch(`${API_BASE_URL}/api/raids/current`);
        if (!response.ok) {
          console.debug('Raids API not available');
          displayMockRaids(); // Show mock data for now
          // Handle deep link even with mock data
          if (pendingDeepLinkRaidId) {
            handleRaidDeepLink(pendingDeepLinkRaidId);
            pendingDeepLinkRaidId = false; // Mark as handled
          }
          return;
        }
        const data = await response.json();

        if (data.success && data.raids) {
          displayCurrentRaids(data.raids, walletAddress);
          // Handle deep link after raids are displayed
          if (pendingDeepLinkRaidId) {
            handleRaidDeepLink(pendingDeepLinkRaidId);
            pendingDeepLinkRaidId = false; // Mark as handled
          }
        }
      } catch (err) {
        console.error('Error loading raids:', err);
        displayMockRaids(); // Show mock data on error
      }
    }

    function displayMockRaids() {
      // Mock raid data for demonstration
      const mockRaids = [
        {
          id: 101,
          description: "Like and retweet the latest @BearXRPL announcement about the new BEAR SLICE game! ðŸŽ®<img src='https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png' alt='honey' style='height:1em; width:auto; vertical-align:middle; display:inline-block;'>",
          twitter_url: "https://x.com/BearXRPL/status/1986706939775181224",
          reward: 20,
          expires_at: new Date(Date.now() + 18 * 60 * 60 * 1000).toISOString(), // 18 hours from now
          profile_name: "BearXRPL",
          profile_handle: "@BearXRPL",
          profile_emoji: "ðŸ»"
        },
        {
          id: 102,
          description: "Join the BEAR community space happening NOW! Come discuss the future of BEARpark ðŸ»",
          twitter_url: "https://twitter.com/i/spaces/1234567890",
          reward: 20,
          expires_at: new Date(Date.now() + 3 * 60 * 60 * 1000).toISOString(), // 3 hours from now
          profile_name: "BearXRPL",
          profile_handle: "@BearXRPL",
          profile_emoji: "ðŸ»"
        }
      ];

      displayCurrentRaids(mockRaids, localStorage.getItem('bearpark_wallet'));
    }

    function displayCurrentRaids(raids, walletAddress) {
      const currentList = document.getElementById('currentRaidsList');
      if (!currentList) return;

      // Clear existing timers
      raidTimerIntervals.forEach(interval => clearInterval(interval));
      raidTimerIntervals = [];

      if (!raids || raids.length === 0) {
        currentList.innerHTML = '<div class="raids-empty">No active raids right now. Check back soon! <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;"></div>';
        return;
      }

      // Store raids data for later use
      raids.forEach(raid => {
        currentRaidsData[raid.id] = raid;
      });

      // Get completed raids from localStorage
      const completedRaids = JSON.parse(localStorage.getItem(`completed_raids_${walletAddress}`) || '[]');

      // SECURITY: Save processing raid cards BEFORE rebuilding to preserve countdown state
      // We save the actual DOM elements (not clones) to preserve event handlers and intervals
      const processingCards = [];
      processingRaids.forEach(raidId => {
        const card = currentList.querySelector(`.raid-item[data-raid-id="${raidId}"]`);
        if (card) {
          card.remove(); // Remove from DOM temporarily
          processingCards.push(card); // Save reference to actual element
        }
      });

      // OPTIMIZATION: Save existing raid cards with loaded tweets to prevent reload
      const existingCards = {};
      Array.from(currentList.querySelectorAll('.raid-item')).forEach(card => {
        const raidId = parseInt(card.getAttribute('data-raid-id'));
        const preview = card.querySelector('.raid-tweet-preview');
        // Only save cards that have loaded tweet previews
        if (preview && (preview.querySelector('.twitter-tweet') || preview.querySelector('.raid-tweet-click-overlay'))) {
          card.remove(); // Remove from DOM temporarily
          existingCards[raidId] = card;
        }
      });

      currentList.innerHTML = raids.map(raid => {
        const isCompleted = completedRaids.includes(raid.id);
        const isProcessing = processingRaids.has(raid.id); // Check if currently processing
        const expiresAt = new Date(raid.expires_at);
        const now = new Date();
        const isExpired = expiresAt < now;

        // SECURITY: Don't re-render raids that are completed OR currently processing
        // Re-rendering processing raids would destroy the countdown state and UI references
        if (isCompleted || isProcessing) {
          return ''; // Don't render these raids
        }

        // OPTIMIZATION: Don't re-render raids with loaded tweet previews
        if (existingCards[raid.id]) {
          return ''; // Will be restored from saved element
        }

        return `
          <div class="raid-item ${isExpired ? 'expired' : ''}" data-raid-id="${raid.id}">
            ${raid.profile_name ? `
              <div class="raid-profile-header">
                <div class="raid-profile-emoji">${raid.profile_emoji || 'ðŸ»'}</div>
                <div class="raid-profile-info">
                  <div class="raid-profile-name">${raid.profile_name}</div>
                  <div class="raid-profile-handle">${raid.profile_handle || ''}</div>
                </div>
              </div>
            ` : ''}
            <div class="raid-header">
              <span class="raid-timer ${isExpired ? 'expired' : ''}" id="timer-${raid.id}">
                ${isExpired ? 'EXPIRED' : 'Calculating...'}
              </span>
            </div>
            <div class="raid-description">${raid.description}</div>
            <div class="raid-tweet-preview" id="tweet-preview-${raid.id}">
              <div class="raid-preview-loading">Loading tweet preview...</div>
            </div>
            <div class="raid-footer">
              <span class="raid-reward"><img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;"> HONEY EARNED FROM RAID: ${raid.reward}</span>
              <a href="javascript:void(0)"
                 class="raid-btn"
                 data-twitter-url="${raid.twitter_url}"
                 onclick="trackRaidClick(${raid.id}, event)"
                 ${isExpired ? 'style="pointer-events:none;opacity:0.5;"' : ''}>
                ${isExpired ? 'EXPIRED' : 'RAID NOW'}
              </a>
            </div>
          </div>
        `;
      }).join('');

      // OPTIMIZATION: Restore existing cards with loaded previews (appended at the end)
      raids.forEach(raid => {
        if (existingCards[raid.id]) {
          currentList.appendChild(existingCards[raid.id]);
          // Restart timer for this existing card
          if (new Date(raid.expires_at) > new Date()) {
            startRaidTimer(raid.id, raid.expires_at);
          }
        }
      });

      // Start countdown timers and load tweet previews for NEW raids only
      raids.forEach(raid => {
        // Skip if this is an existing card we just restored
        if (existingCards[raid.id]) {
          return; // Already has timer and preview
        }

        if (new Date(raid.expires_at) > new Date()) {
          startRaidTimer(raid.id, raid.expires_at);
        }
        // Load tweet preview only for new raids
        if (!completedRaids.includes(raid.id) && !processingRaids.has(raid.id)) {
          loadTweetPreview(raid.id, raid.twitter_url);
        }
      });

      // SECURITY: Re-append saved processing cards to preserve countdown state
      processingCards.forEach(card => {
        currentList.prepend(card); // Add at the beginning to keep them visible
      });
    }

    async function loadTweetPreview(raidId, twitterUrl) {
      const previewEl = document.getElementById(`tweet-preview-${raidId}`);
      if (!previewEl) return;

      // Check if preview is already loaded (not just the loading message)
      if (previewEl.querySelector('.twitter-tweet') || previewEl.querySelector('.raid-tweet-click-overlay')) {
        console.log(`Tweet preview already loaded for raid ${raidId}, skipping reload`);
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/api/twitter/oembed?url=${encodeURIComponent(twitterUrl)}`);
        const data = await response.json();

        if (data.success && data.embed && data.embed.html) {
          // Just display the full Twitter embed HTML
          previewEl.innerHTML = data.embed.html;

          // Add click overlay on top of the embed
          const overlay = document.createElement('div');
          overlay.className = 'raid-tweet-click-overlay';
          overlay.onclick = (e) => {
            e.preventDefault();
            e.stopPropagation();
            // Find the raid button and click it
            const raidBtn = document.querySelector(`.raid-item[data-raid-id="${raidId}"] .raid-btn`);
            if (raidBtn && !raidBtn.disabled) {
              console.log('Tweet preview clicked, triggering raid button');
              raidBtn.click();
            }
          };
          previewEl.appendChild(overlay);

          // Load Twitter widgets script if not already loaded
          if (!window.twttr) {
            const script = document.createElement('script');
            script.src = 'https://platform.twitter.com/widgets.js';
            script.async = true;
            document.body.appendChild(script);
          } else {
            // Reload widgets for this element
            window.twttr.widgets.load(previewEl);
          }
        } else {
          previewEl.innerHTML = '<div class="raid-preview-error">Preview unavailable</div>';
        }
      } catch (error) {
        console.error('Error loading tweet preview:', error);
        previewEl.innerHTML = '<div class="raid-preview-error">Preview unavailable</div>';
      }
    }

    function startRaidTimer(raidId, expiresAt) {
      const timerEl = document.getElementById(`timer-${raidId}`);
      if (!timerEl) return;

      const updateTimer = () => {
        const now = new Date().getTime();
        const end = new Date(expiresAt).getTime();
        const distance = end - now;

        if (distance < 0) {
          timerEl.textContent = 'EXPIRED';
          timerEl.classList.add('expired');
          return;
        }

        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        timerEl.textContent = `â° ${hours}h ${minutes}m ${seconds}s left`;
      };

      updateTimer(); // Update immediately
      const interval = setInterval(updateTimer, 1000);
      raidTimerIntervals.push(interval);
    }

    // Make function globally accessible
    window.trackRaidClick = function(raidId, event) {
      console.log('trackRaidClick called with raidId:', raidId);

      const walletAddress = localStorage.getItem('bearpark_wallet');
      if (!walletAddress) {
        console.log('No wallet address found');
        return true; // Allow link to open
      }

      // SECURITY: Check if already completed
      const completedRaids = JSON.parse(localStorage.getItem(`completed_raids_${walletAddress}`) || '[]');
      if (completedRaids.includes(raidId)) {
        console.log('âŒ SECURITY: Raid already completed!');
        return false; // Don't allow reopening
      }

      // SECURITY: Check if already being processed
      if (processingRaids.has(raidId)) {
        console.log('âŒ SECURITY: Raid already being processed!');
        return false; // Prevent duplicate processing
      }

      // SECURITY: Mark as being processed IMMEDIATELY
      processingRaids.add(raidId);

      // SECURITY: Capture raid reward IMMEDIATELY before any async operations
      // This ensures we have the correct reward value even if raids refresh during countdown
      const raidData = currentRaidsData[raidId];
      const pointsAwarded = raidData?.reward || 20;
      console.log(`ðŸŽ¯ Raid reward captured: ${pointsAwarded} points for raid ${raidId}`);

      // Get the raid card and button
      const raidCard = document.querySelector(`.raid-item[data-raid-id="${raidId}"]`);
      const raidBtn = event ? event.currentTarget : document.querySelector(`.raid-item[data-raid-id="${raidId}"] .raid-btn`);

      console.log('raidCard:', raidCard);
      console.log('raidBtn:', raidBtn);

      if (!raidCard || !raidBtn) {
        console.error('Could not find raid card or button');
        processingRaids.delete(raidId); // Clean up
        return true; // Allow link to open
      }

      // Open Twitter URL in browser (bypass Windows X app handler)
      let twitterUrl = raidBtn.getAttribute('data-twitter-url') || raidData?.twitter_url;
      if (twitterUrl) {
        twitterUrl = twitterUrl.replace('https://x.com/', 'https://twitter.com/');

        // Workaround for Windows opening X app: open blank tab first, then navigate
        const newTab = window.open('about:blank', '_blank');
        if (newTab) {
          // Small delay to ensure tab is ready, then navigate
          setTimeout(() => {
            newTab.location.href = twitterUrl;
          }, 100);
        }
      }

      // SECURITY: Prevent ANY re-rendering of this raid
      raidCard.setAttribute('data-processing', 'true');
      raidCard.style.pointerEvents = 'none'; // Disable entire card

      // SECURITY: Disable button immediately and make changes PERMANENT
      raidBtn.style.pointerEvents = 'none';
      raidBtn.style.opacity = '0.5';
      raidBtn.style.cursor = 'not-allowed';
      raidBtn.onclick = null; // Remove click handler entirely

      // Add completing state
      raidCard.classList.add('completing');
      raidBtn.classList.add('completing');

      // Start 60-second countdown
      let secondsLeft = 60;
      raidBtn.textContent = `COMPLETING... â³ ${secondsLeft}s`;

      // Store original button content to prevent overwrites
      const processingText = `COMPLETING... â³`;

      const countdownInterval = setInterval(() => {
        secondsLeft--;
        if (secondsLeft > 0) {
          // SECURITY: Force button text to stay as countdown - CANNOT be overwritten
          raidBtn.textContent = `COMPLETING... â³ ${secondsLeft}s`;
          raidBtn.style.pointerEvents = 'none'; // Re-enforce every second
          raidBtn.onclick = null; // Re-enforce every second
        } else {
          // Countdown finished - mark as completed and fade out
          clearInterval(countdownInterval);

          // SECURITY: Double-check not already completed
          const currentCompleted = JSON.parse(localStorage.getItem(`completed_raids_${walletAddress}`) || '[]');
          if (currentCompleted.includes(raidId)) {
            console.log('âŒ SECURITY: Raid was already completed during countdown!');
            processingRaids.delete(raidId);
            return;
          }

          // Mark raid as completed in localStorage
          currentCompleted.push(raidId);
          localStorage.setItem(`completed_raids_${walletAddress}`, JSON.stringify(currentCompleted));

          // Save full raid data for previous raids section
          const completedRaidsData = JSON.parse(localStorage.getItem(`completed_raids_data_${walletAddress}`) || '[]');

          // Use the raidData and pointsAwarded we captured at the start
          if (raidData && !completedRaidsData.find(r => r.id === raidId)) {
            completedRaidsData.push({
              ...raidData,
              completed_at: new Date().toISOString()
            });
            localStorage.setItem(`completed_raids_data_${walletAddress}`, JSON.stringify(completedRaidsData));
          }

          // âŒ REMOVED localStorage updates - backend is ONLY source of truth
          // Points are awarded in backend via API call, UI will refresh from backend

          console.log(`âœ… Points awarded via backend! +${pointsAwarded}`);

          // Reload points from backend to get accurate balance
          loadHoneyPoints();

          // Update navigation bar honey points AND welcome button
          updateWelcomeButton();

          const navHoneyPoints = document.getElementById('navHoneyPoints');
          if (navHoneyPoints) {
            navHoneyPoints.textContent = currentPoints.total.toFixed(1) + ' PTS';
          }

          // Send to backend to sync points (will fail gracefully if API not ready)
          fetch('/api/raids/complete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              wallet_address: walletAddress,
              raid_id: raidId,
              completed_at: new Date().toISOString(),
              points_awarded: pointsAwarded
            })
          })
          .then(response => response.json())
          .then(data => {
            console.log('Raid completion synced with backend:', data);
            // Reload honey points and leaderboard to ensure UI is in sync with backend
            loadHoneyPoints();
            loadDailyGameProgress();
            loadHoneyLeaderboard(walletAddress);
          })
          .catch(err => console.log('Backend sync pending - points stored locally:', err));

          // Show completed state briefly
          raidBtn.textContent = `âœ“ COMPLETED +${pointsAwarded} PTS`;
          raidBtn.classList.remove('completing');
          raidCard.classList.remove('completing');
          raidCard.classList.add('completed');

          // SECURITY: Remove from processing set
          processingRaids.delete(raidId);

          // Fade out and remove after animation
          setTimeout(() => {
            raidCard.classList.add('fade-out');

            // Remove from DOM after animation completes
            setTimeout(() => {
              raidCard.remove();

              // Check if there are no more raids
              const currentList = document.getElementById('currentRaidsList');
              if (currentList && currentList.children.length === 0) {
                currentList.innerHTML = '<div class="raids-empty">No active raids right now. Check back soon! <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;"></div>';
              }
            }, 1000);
          }, 1500);
        }
      }, 1000);

      return true; // Allow link to open in new tab
    };

    async function loadPreviousRaids() {
      const walletAddress = localStorage.getItem('bearpark_wallet');
      const previousList = document.getElementById('previousRaidsList');
      if (!previousList) return;

      // Load from localStorage
      const completedRaidsData = JSON.parse(localStorage.getItem(`completed_raids_data_${walletAddress}`) || '[]');

      if (completedRaidsData.length > 0) {
        previousList.innerHTML = completedRaidsData.map(raid => {
          return `
            <div class="raid-item completed">
              ${raid.profile_name ? `
                <div class="raid-profile-header">
                  <div class="raid-profile-emoji">${raid.profile_emoji || 'ðŸ»'}</div>
                  <div class="raid-profile-info">
                    <div class="raid-profile-name">${raid.profile_name}</div>
                    <div class="raid-profile-handle">${raid.profile_handle || ''}</div>
                  </div>
                </div>
              ` : ''}
              <div class="raid-header">
                <span class="raid-timer expired">âœ“ COMPLETED</span>
              </div>
              <div class="raid-description">${raid.description}</div>
              <div class="raid-footer">
                <span class="raid-reward">âœ“ Earned ${raid.reward} PTS <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;"></span>
                <a href="${raid.twitter_url}" target="_blank" rel="noopener noreferrer" class="raid-btn" style="pointer-events:all;opacity:1;">
                  VIEW POST
                </a>
              </div>
            </div>
          `;
        }).join('');
      } else {
        previousList.innerHTML = '<div class="raids-empty">No previous raids yet! Complete some raids to see them here. <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;"></div>';
      }

      // Try to sync with backend (optional)
      try {
        const response = await fetch(`/api/raids/previous?wallet=${walletAddress}`);
        if (response.ok) {
          const data = await response.json();
          // Could merge backend data here if needed
        }
      } catch (err) {
        console.debug('Backend not available - using local data');
      }
    }

    // Toggle between current and previous raids
    document.getElementById('raidsToggleBtn')?.addEventListener('click', function() {
      const currentList = document.getElementById('currentRaidsList');
      const previousList = document.getElementById('previousRaidsList');
      const raidsTitle = document.getElementById('raidsTitle');

      showingPreviousRaids = !showingPreviousRaids;

      if (showingPreviousRaids) {
        currentList.style.display = 'none';
        previousList.style.display = 'flex';
        this.textContent = 'Show Current Raids';
        if (raidsTitle) raidsTitle.textContent = 'ðŸ“œ Previous Raids';
        loadPreviousRaids();
      } else {
        currentList.style.display = 'flex';
        previousList.style.display = 'none';
        this.textContent = 'Show Previous Raids';
        if (raidsTitle) raidsTitle.textContent = 'ðŸ» ðŸª– Current Raids';
      }
    });

    /* ===== NFT & Profile Management ===== */
    const PIXEL_BEARS_ISSUER = 'rBEARbo4Prn33894evmvYcAf9yAQjp4VJF';
    const PIXEL_BEARS_TAXON = 1;
    const ULTRA_RARES_ISSUER = 'rBEARbo4Prn33894evmvYcAf9yAQjp4VJF';
    const ULTRA_RARES_TAXON = 2;

    let currentNFTs = [];
    let selectedAvatarNFT = null;
    let nftImageCache = {}; // Store NFT images and metadata

    // Helper function to convert hex string to regular string
    function hexToString(hex) {
      const hexString = hex.startsWith('0x') ? hex.slice(2) : hex;
      let str = '';
      for (let i = 0; i < hexString.length; i += 2) {
        const charCode = parseInt(hexString.substr(i, 2), 16);
        if (charCode) str += String.fromCharCode(charCode);
      }
      return str;
    }

    // Show profile and NFT sections when authenticated
    async function initializeProfileAndNFTs() {
      const walletAddress = localStorage.getItem('bearpark_wallet');
      const isAuthenticated = localStorage.getItem('bearpark_auth') === 'true';

      if (!isAuthenticated || !walletAddress) {
        document.getElementById('profileSection').style.display = 'none';
        document.getElementById('nftSection').style.display = 'none';
        return;
      }

      // Show sections
      document.getElementById('profileSection').style.display = 'block';
      document.getElementById('nftSection').style.display = 'block';

      // Load existing profile data
      let profileLoaded = false;

      // Try to load from backend first
      try {
        const response = await fetch(`${API_BASE_URL}/api/profile/${walletAddress}`);
        if (response.ok) {
          const data = await response.json();

          if (data.success && data.profile) {
            document.getElementById('profileUsername').value = data.profile.display_name || '';
            if (data.profile.avatar_nft) {
              selectedAvatarNFT = data.profile.avatar_nft;
              document.getElementById('profileAvatarNFT').value = data.profile.avatar_nft;
              // Display selected avatar
              displaySelectedAvatar(data.profile.avatar_nft);
            }
            profileLoaded = true;
          }
        }
      } catch (err) {
        console.debug('Backend profile not available, checking localStorage:', err.message);
      }

      // Fallback to localStorage if backend didn't load
      if (!profileLoaded) {
        const profileKey = `bearpark_profile_${walletAddress}`;
        const localProfile = localStorage.getItem(profileKey);
        if (localProfile) {
          try {
            const profile = JSON.parse(localProfile);
            document.getElementById('profileUsername').value = profile.display_name || '';
            if (profile.avatar_nft) {
              selectedAvatarNFT = profile.avatar_nft;
              document.getElementById('profileAvatarNFT').value = profile.avatar_nft;
              // Display selected avatar
              displaySelectedAvatar(profile.avatar_nft);
            }
            console.log('âœ… Loaded profile from localStorage');
          } catch (e) {
            console.error('Error parsing local profile:', e);
          }
        }
      }
    }

    function displaySelectedAvatar(nftIdOrData) {
      const selector = document.getElementById('profileAvatarSelector');
      let imageData;

      // Handle both NFT ID string and JSON avatar data
      if (typeof nftIdOrData === 'string') {
        // Try to parse as JSON first (from database)
        try {
          imageData = JSON.parse(nftIdOrData);
        } catch (e) {
          // If not JSON, it's an NFT ID - look it up in cache
          imageData = nftImageCache[nftIdOrData];
        }
      } else {
        // Already an object
        imageData = nftIdOrData;
      }

      if (imageData && imageData.imageUrl) {
        // Build fallback chain: animated -> fallback image -> error placeholder
        const fallbackSrc = imageData.fallbackImageUrl || 'data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27100%27 height=%27100%27%3E%3Crect fill=%27%23333%27 width=%27100%27 height=%27100%27/%3E%3Ctext fill=%27%23edb723%27 x=%2750%25%27 y=%2750%25%27 text-anchor=%27middle%27 dy=%27.3em%27%3ENFT%3C/text%3E%3C/svg%3E';

        // Use img element for all content types
        // Browsers handle GIFs natively, and can show video thumbnails
        selector.innerHTML = `
          <img src="${imageData.imageUrl}"
               style="width:100%; max-width:120px; border-radius:8px; border:2px solid var(--gold);"
               alt="Selected avatar"
               crossorigin="anonymous"
               onerror="if(this.src!=='${fallbackSrc.replace(/'/g, "\\'")}'){console.log('[Avatar] Trying fallback image');this.src='${fallbackSrc.replace(/'/g, "\\'")}';}">
        `;
      } else {
        selector.innerHTML = `
          <div style="width:100%; max-width:120px; aspect-ratio:1; background:rgba(237,183,35,0.1); border-radius:8px; border:2px solid var(--gold); display:flex; align-items:center; justify-content:center; color:var(--gold);">
            Loading...
          </div>
        `;
      }
    }

    // Load NFTs from wallet
    async function loadNFTs(taxon, type) {
      const walletAddress = localStorage.getItem('bearpark_wallet');
      if (!walletAddress) return;

      const nftLoading = document.getElementById('nftLoading');
      const nftGrid = document.getElementById('nftGrid');
      const nftEmpty = document.getElementById('nftEmpty');
      const nftGridContent = document.getElementById('nftGridContent');

      // Show loading
      nftLoading.style.display = 'block';
      nftGrid.style.display = 'none';
      nftEmpty.style.display = 'none';

      try {
        // Connect to XRPL
        if (typeof xrpl === 'undefined') {
          console.error('XRPL library not loaded');
          alert('Error: XRPL library not loaded');
          nftLoading.style.display = 'none';
          return;
        }

        const client = new xrpl.Client('wss://xrplcluster.com');
        await client.connect();

        // Get ALL account NFTs with pagination
        let allNFTs = [];
        let marker = undefined;
        let pageCount = 0;
        const maxPages = 20; // Safety limit

        console.log('[NFT] Fetching all NFTs from wallet (with pagination)...');

        do {
          const nftRequest = {
            command: 'account_nfts',
            account: walletAddress,
            ledger_index: 'validated',
            limit: 400 // Maximum per page
          };

          if (marker) {
            nftRequest.marker = marker;
          }

          const nfts = await client.request(nftRequest);

          if (nfts.result.account_nfts && nfts.result.account_nfts.length > 0) {
            allNFTs = allNFTs.concat(nfts.result.account_nfts);
            console.log(`[NFT] Page ${pageCount + 1}: Found ${nfts.result.account_nfts.length} NFTs`);
          }

          marker = nfts.result.marker;
          pageCount++;

        } while (marker && pageCount < maxPages);

        console.log(`[NFT] Total NFTs found across ${pageCount} page(s):`, allNFTs.length);

        // Log each NFT for debugging
        allNFTs.forEach((nft, i) => {
          const nftTaxon = parseInt(nft.NFTokenID.substring(48, 56), 16);
          console.log(`[NFT ${i}] Issuer:`, nft.Issuer, 'Taxon:', nftTaxon, 'ID:', nft.NFTokenID);
        });

        // Filter NFTs by issuer AND URI pattern
        const targetIssuer = 'rBEARbo4Prn33894evmvYcAf9yAQjp4VJF';
        const filteredNFTs = allNFTs.filter(nft => {
          const issuerMatch = nft.Issuer === targetIssuer;
          if (!issuerMatch) return false;

          // Check URI to distinguish Pixel Bears from Ultra Rares
          if (nft.URI) {
            const uriString = hexToString(nft.URI);
            const isPixelBear = uriString.includes('Pixel BEAR') || uriString.includes('Pixel%20BEAR');

            // If looking for Pixel Bears (taxon 1), include Pixel Bears
            // If looking for Ultra Rares (taxon 2), exclude Pixel Bears
            const typeMatch = (taxon === PIXEL_BEARS_TAXON) ? isPixelBear : !isPixelBear;

            console.log('[NFT Filter]', nft.NFTokenID, 'Issuer:', issuerMatch, 'Type:', isPixelBear ? 'Pixel BEAR' : 'Ultra Rare', 'Match:', typeMatch);
            return typeMatch;
          }

          return false;
        });

        console.log('[NFT] Filtered NFTs:', filteredNFTs.length);

        currentNFTs = filteredNFTs;

        if (filteredNFTs.length === 0) {
          nftLoading.style.display = 'none';
          nftEmpty.style.display = 'block';
          nftEmpty.textContent = `No ${type} found in your wallet. Total NFTs: ${allNFTs.length}`;
          return;
        }

        // Display NFTs with loading placeholders
        nftGridContent.innerHTML = filteredNFTs.map(nft => `
          <div class="nft-item" data-nft-id="${nft.NFTokenID}"
               style="position:relative; border-radius:12px; overflow:hidden; border:3px solid rgba(237,183,35,0.3); background:linear-gradient(135deg, rgba(0,0,0,0.8), rgba(20,20,20,0.9)); transition:all 0.3s ease; box-shadow:0 4px 15px rgba(0,0,0,0.5);"
               onmouseover="this.style.transform='translateY(-5px) scale(1.02)'; this.style.borderColor='var(--gold)'; this.style.boxShadow='0 8px 25px rgba(237,183,35,0.4)';"
               onmouseout="this.style.transform=''; this.style.borderColor='rgba(237,183,35,0.3)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.5)';">
            <div style="width:100%; aspect-ratio:1; position:relative; background:rgba(237,183,35,0.05);">
              <img src="" data-nft-id="${nft.NFTokenID}" class="nft-image-loading"
                   style="width:100%; height:100%; display:block; object-fit:contain; image-rendering:pixelated;"
                   loading="lazy"
                   alt="${type} NFT">
              <a href="https://xrp.cafe/nft/${nft.NFTokenID}" target="_blank" rel="noopener noreferrer"
                 style="position:absolute; top:8px; left:8px; width:32px; height:32px; border-radius:50%; background:#fff; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 8px rgba(0,0,0,0.3); transition:all 0.2s; z-index:10; border:3px solid transparent; background-image: linear-gradient(#fff, #fff), var(--tri-gradient); background-origin: padding-box, border-box; background-clip: padding-box, border-box;"
                 onmouseover="this.style.transform='scale(1.15)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.5)';"
                 onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.3)';"
                 title="View on XRP.cafe">
                <img src="https://avatars.githubusercontent.com/u/109316848?s=280&v=4"
                     alt="XRP.cafe"
                     style="width:20px; height:20px; border-radius:50%; object-fit:cover;">
              </a>
              <div class="loading-overlay" data-nft-id="${nft.NFTokenID}" style="position:absolute; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; color:var(--gold); font-size:14px; font-weight:900; backdrop-filter:blur(4px);">
                Loading...
              </div>
            </div>
            <div class="nft-info" data-nft-id="${nft.NFTokenID}" style="padding:12px; background:rgba(0,0,0,0.6); backdrop-filter:blur(10px); display:none;">
              <div style="text-align:center; margin-bottom:8px;">
                <div style="color:var(--gold); font-weight:900; font-size:14px; margin-bottom:4px;">Loading...</div>
                <div style="color:rgba(255,255,255,0.7); font-size:11px;">Please wait...</div>
              </div>
            </div>
            <div style="padding:8px; background:rgba(0,0,0,0.8); backdrop-filter:blur(10px);">
              <button class="nft-select-btn" data-nft-id="${nft.NFTokenID}"
                      style="font-size:12px; padding:10px; background:#5D3FD3; color:#fff; border:3px solid transparent; border-radius:20px; font-weight:900; cursor:pointer; width:100%; transition:all 0.2s; text-transform:uppercase; letter-spacing:1px; box-shadow:0 4px 0 #000,0 4px 12px rgba(0,0,0,0.8); background-image:linear-gradient(#5D3FD3, #5D3FD3), var(--tri-gradient); background-origin:padding-box, border-box; background-clip:padding-box, border-box;"
                      onmouseover="this.style.backgroundImage='linear-gradient(#6D4FE3, #6D4FE3), var(--tri-gradient)'; this.style.transform='translateY(-2px)';"
                      onmouseout="this.style.backgroundImage='linear-gradient(#5D3FD3, #5D3FD3), var(--tri-gradient)'; this.style.transform='translateY(0)';">
                Select Avatar
              </button>
              <button class="nft-save-btn" data-nft-id="${nft.NFTokenID}"
                      style="font-size:11px; padding:8px; background:#07ae08; color:#fff; border:3px solid transparent; border-radius:20px; font-weight:900; cursor:pointer; margin-top:6px; width:100%; transition:all 0.2s; text-transform:uppercase; letter-spacing:0.5px; box-shadow:0 4px 0 #000,0 4px 12px rgba(0,0,0,0.8); background-image:linear-gradient(#07ae08, #07ae08), var(--tri-gradient); background-origin:padding-box, border-box; background-clip:padding-box, border-box;"
                      onmouseover="this.style.backgroundImage='linear-gradient(#08d509, #08d509), var(--tri-gradient)'; this.style.transform='translateY(-2px)';"
                      onmouseout="this.style.backgroundImage='linear-gradient(#07ae08, #07ae08), var(--tri-gradient)'; this.style.transform='translateY(0)';">
                Save Image
              </button>
            </div>
          </div>
        `).join('');

        // Disconnect client - we have all the data we need
        await client.disconnect();
        console.log('[NFT] Client disconnected');

        // Load NFT images from metadata JSON files
        const imageLoadPromises = filteredNFTs.map(async (nft) => {
          try {
            // Check if NFT has a URI field (hex-encoded)
            if (!nft.URI) {
              console.log('[NFT Image] No URI found for', nft.NFTokenID);
              return;
            }

            // Convert hex URI to string
            const uriString = hexToString(nft.URI);
            console.log('[NFT Image] NFT:', nft.NFTokenID, 'URI:', uriString);

            // Convert IPFS URI to HTTP gateway URL
            let metadataUrl = '';
            if (uriString.startsWith('ipfs://')) {
              const ipfsPath = uriString.replace('ipfs://', '');
              // Split path and encode each component to handle spaces and special chars
              const pathParts = ipfsPath.split('/');
              const encodedPath = pathParts.map(part => encodeURIComponent(part)).join('/');
              metadataUrl = `https://ipfs.io/ipfs/${encodedPath}`;
            } else if (uriString.startsWith('http')) {
              metadataUrl = uriString;
            } else if (uriString.length > 0) {
              // Might be just the IPFS hash without prefix
              const pathParts = uriString.split('/');
              const encodedPath = pathParts.map(part => encodeURIComponent(part)).join('/');
              metadataUrl = `https://ipfs.io/ipfs/${encodedPath}`;
            }

            if (!metadataUrl) {
              console.log('[NFT Image] Could not construct metadata URL for', nft.NFTokenID);
              return;
            }

            // Fetch the metadata JSON
            console.log('[NFT Image] Fetching metadata from:', metadataUrl);
            const metadataResponse = await fetch(metadataUrl);

            if (!metadataResponse.ok) {
              throw new Error(`Failed to fetch metadata: ${metadataResponse.status} ${metadataResponse.statusText}`);
            }

            const metadata = await metadataResponse.json();

            if (!metadata) {
              throw new Error('Metadata is empty or invalid');
            }

            // Extract image URL from metadata (check image, animation, or image_url fields)
            // Ultra Rare Bears use the "animation" field for their animated images
            // Store both animation and static image if available for fallback
            const isAnimated = !!metadata.animation;
            let imageUrl = metadata.animation || metadata.image || metadata.image_url || '';
            let fallbackImageUrl = null;

            // If there's an animation, also get the static image as fallback
            if (metadata.animation && metadata.image) {
              fallbackImageUrl = metadata.image;
            }

            // Helper to convert IPFS URL to HTTP gateway with multiple fallback gateways
            const convertIpfsUrl = (url, gatewayIndex = 0) => {
              if (url && url.startsWith('ipfs://')) {
                const ipfsPath = url.replace('ipfs://', '');
                const pathParts = ipfsPath.split('/');
                const encodedPath = pathParts.map(part => encodeURIComponent(part)).join('/');

                // Multiple IPFS gateways for redundancy (using working gateways only)
                const gateways = [
                  'https://ipfs.io/ipfs/',
                  'https://gateway.ipfs.io/ipfs/',
                  'https://gateway.pinata.cloud/ipfs/',
                  'https://dweb.link/ipfs/'
                ];

                return `${gateways[gatewayIndex % gateways.length]}${encodedPath}`;
              }
              return url;
            };

            imageUrl = convertIpfsUrl(imageUrl);
            fallbackImageUrl = convertIpfsUrl(fallbackImageUrl);

            console.log('[NFT Image]', isAnimated ? 'Animation' : 'Image', 'URL for', nft.NFTokenID, ':', imageUrl);
            if (fallbackImageUrl) {
              console.log('[NFT Image] Fallback URL:', fallbackImageUrl);
            }

            // Extract BEAR number and rarity from metadata
            const bearName = metadata.name || 'Unknown BEAR';

            // Extract bear number from name (e.g., "BEAR #36" -> 36)
            const bearNumberMatch = bearName.match(/#(\d+)/);
            const bearNumber = bearNumberMatch ? parseInt(bearNumberMatch[1]) : null;

            // Hardcoded rarity mapping for Ultra Rare Bears
            // This data is not stored in the NFT metadata
            const ultraRareRarityMap = {
              9: 10,
              12: 12,
              14: 14,
              18: 18,
              36: 37,
              451: 273
            };

            let rarityNumber = '';
            if (bearNumber && ultraRareRarityMap[bearNumber]) {
              rarityNumber = `#${ultraRareRarityMap[bearNumber]}`;
              console.log('[NFT Image] Mapped rarity for', bearName, ':', rarityNumber);
            } else {
              console.log('[NFT Image] No rarity mapping found for', bearName);
              rarityNumber = '';
            }

            console.log('[NFT Image] Extracted:', bearName, 'Rarity:', rarityNumber);

            // Store in cache
            nftImageCache[nft.NFTokenID] = {
              imageUrl,
              fallbackImageUrl,
              metadata,
              bearName,
              rarityNumber,
              isAnimated
            };

            // Update media element (use img for all content types for reliability)
            const imgElement = document.querySelector(`img.nft-image-loading[data-nft-id="${nft.NFTokenID}"]`);
            if (imgElement && imageUrl) {
              // Set up timeout for slow-loading animated content
              let loadTimeout = null;
              let hasLoaded = false;

              // Set up error handler to try fallback image if animated content fails
              if (fallbackImageUrl && isAnimated) {
                // Timeout after 8 seconds for animated content
                loadTimeout = setTimeout(() => {
                  if (!hasLoaded && imgElement.src !== fallbackImageUrl) {
                    console.log('[NFT Image] Animated content loading too slow, using static fallback for', nft.NFTokenID);
                    imgElement.src = fallbackImageUrl;
                  }
                }, 8000);

                imgElement.onerror = function() {
                  clearTimeout(loadTimeout);
                  if (this.src !== fallbackImageUrl) {
                    console.log('[NFT Image] Animated content failed, trying static fallback for', nft.NFTokenID);
                    this.src = fallbackImageUrl;
                  }
                };

                imgElement.onload = function() {
                  hasLoaded = true;
                  clearTimeout(loadTimeout);
                  console.log('[NFT Image] Successfully loaded image for', nft.NFTokenID);
                };
              }

              imgElement.src = imageUrl;
              imgElement.classList.remove('nft-image-loading');
              console.log('[NFT Image] Successfully set image URL:', imageUrl);

              // Remove loading overlay after image loads
              const loadingOverlay = document.querySelector(`.loading-overlay[data-nft-id="${nft.NFTokenID}"]`);
              if (loadingOverlay) {
                // Wait for image to load before removing overlay
                if (imgElement.complete) {
                  loadingOverlay.remove();
                } else {
                  const removeOverlay = () => {
                    loadingOverlay.remove();
                    imgElement.removeEventListener('load', removeOverlay);
                    imgElement.removeEventListener('error', removeOverlay);
                  };
                  imgElement.addEventListener('load', removeOverlay);
                  imgElement.addEventListener('error', removeOverlay);
                }
              }

              // Update NFT info section
              const infoSection = document.querySelector(`.nft-info[data-nft-id="${nft.NFTokenID}"]`);
              if (infoSection) {
                infoSection.style.display = 'block';
                infoSection.innerHTML = `
                  <div style="text-align:center; margin-bottom:0;">
                    <div style="color:var(--gold); font-weight:900; font-size:14px; margin-bottom:2px; text-shadow:0 2px 4px rgba(0,0,0,0.5);">${bearName}</div>
                    <div style="color:rgba(255,255,255,0.8); font-size:12px; font-weight:700;">Rarity ${rarityNumber}</div>
                  </div>
                `;
              }
            }
          } catch (err) {
            console.error('[NFT Image] Failed to load image for', nft.NFTokenID, err);
            // Show error state
            const loadingOverlay = document.querySelector(`.loading-overlay[data-nft-id="${nft.NFTokenID}"]`);
            if (loadingOverlay) {
              loadingOverlay.innerHTML = '<div style="text-align:center;"><div style="font-size:20px; margin-bottom:4px;">âš ï¸</div><div>Failed to load</div></div>';
            }
          }
        });

        // Wait for all images to load
        await Promise.all(imageLoadPromises);
        console.log('[NFT] All images loaded');

        // Wire up NFT buttons
        document.querySelectorAll('.nft-select-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const nftId = btn.getAttribute('data-nft-id');
            selectNFTAsAvatar(nftId);
          });
        });

        document.querySelectorAll('.nft-save-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const nftId = btn.getAttribute('data-nft-id');
            saveNFTImage(nftId);
          });
        });

        nftLoading.style.display = 'none';
        nftGrid.style.display = 'block';

        // Auto-scroll to NFT grid after loading
        setTimeout(() => {
          nftGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);

      } catch (err) {
        console.error('Error loading NFTs:', err);
        nftLoading.style.display = 'none';
        nftEmpty.style.display = 'block';
        nftEmpty.textContent = 'Failed to load NFTs. Please try again.';
      }
    }

    function selectNFTAsAvatar(nftId) {
      selectedAvatarNFT = nftId;
      document.getElementById('profileAvatarNFT').value = nftId;
      displaySelectedAvatar(nftId);
      // Scroll to top of drawer to see avatar
      document.querySelector('#buyDrawer .drawer-body').scrollTop = 0;
    }

    function saveNFTImage(nftId) {
      const imageData = nftImageCache[nftId];
      if (imageData && imageData.imageUrl) {
        const link = document.createElement('a');
        link.href = imageData.imageUrl;
        link.download = `${imageData.bearName || 'BEAR-NFT'}-${nftId.substring(0, 8)}.png`;
        link.target = '_blank';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } else {
        alert('Image not yet loaded. Please wait a moment and try again.');
      }
    }

    // Save profile
    document.getElementById('saveProfileBtn')?.addEventListener('click', async () => {
      const walletAddress = localStorage.getItem('bearpark_wallet');
      if (!walletAddress) return;

      const username = document.getElementById('profileUsername').value.trim();
      const avatarNFT = document.getElementById('profileAvatarNFT').value;

      if (!username) {
        showSuccessPopup('Please enter a display name first!', 'âš ï¸');
        return;
      }

      // Get the full image data from cache
      let avatarData = null;
      let avatarUrl = null;
      if (avatarNFT && nftImageCache[avatarNFT]) {
        // Store the full image data as JSON
        avatarData = JSON.stringify({
          nftId: avatarNFT,
          imageUrl: nftImageCache[avatarNFT].imageUrl,
          fallbackImageUrl: nftImageCache[avatarNFT].fallbackImageUrl,
          bearName: nftImageCache[avatarNFT].bearName,
          isAnimated: nftImageCache[avatarNFT].isAnimated
        });
        avatarUrl = nftImageCache[avatarNFT].imageUrl;
      }

      // IMMEDIATELY save to localStorage (works without backend)
      const profileKey = `bearpark_profile_${walletAddress}`;
      const localProfile = {
        display_name: username,
        avatar_nft: avatarData,
        avatar_url: avatarUrl,
        updated_at: new Date().toISOString()
      };
      localStorage.setItem(profileKey, JSON.stringify(localProfile));
      console.log('âœ… Profile saved locally!', localProfile);

      // Mark that user has completed first-time profile setup
      localStorage.setItem('bearpark_profile_setup_complete', 'true');

      // Hide BOTH instruction banners with fade out effect
      const profileInstructionsBanner = document.getElementById('profileInstructions');
      const nftInstructionsBanner = document.getElementById('nftInstructions');

      if (profileInstructionsBanner) {
        profileInstructionsBanner.style.opacity = '0';
        profileInstructionsBanner.style.transform = 'scale(0.8)';
        setTimeout(() => {
          profileInstructionsBanner.style.display = 'none';
        }, 500);
      }

      if (nftInstructionsBanner) {
        nftInstructionsBanner.style.opacity = '0';
        nftInstructionsBanner.style.transform = 'scale(0.8)';
        setTimeout(() => {
          nftInstructionsBanner.style.display = 'none';
        }, 500);
      }

      // Update welcome button immediately with local data
      updateWelcomeButton();

      // Try to sync with backend (optional)
      try {
        const response = await fetch(`${API_BASE_URL}/api/profile`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            wallet_address: walletAddress,
            display_name: username,
            avatar_nft: avatarData
          })
        });

        if (response.ok) {
          const data = await response.json();
          if (data.success) {
            console.log('âœ… Profile synced with backend!');
            celebrateProfileSave();
            showSuccessPopup('Your profile is looking BEARISH! ðŸ»âœ¨ Your custom username and avatar will appear on the leaderboard!', 'ðŸŽ‰');
            // Refresh leaderboard to show new profile
            loadHoneyLeaderboard(walletAddress);
          } else {
            celebrateProfileSave();
            showSuccessPopup('Profile saved to the moon! ðŸš€ (Backend sync pending but you\'re good to go!)', 'âœ…');
          }
        } else {
          console.log('Backend not available - profile saved locally only');
          celebrateProfileSave();
          showSuccessPopup('You\'re officially a BEAR now! ðŸ»ðŸ’ª Your profile is saved and ready to roar!', 'ðŸŽŠ');
        }
      } catch (error) {
        console.log('Backend not available - profile saved locally only');
        celebrateProfileSave();
        showSuccessPopup('You\'re officially a BEAR now! ðŸ»ðŸ’ª Your profile is saved and ready to roar!', 'ðŸŽŠ');
      }
    });

    // View Pixel Bears button
    document.getElementById('viewPixelBearsBtn')?.addEventListener('click', () => {
      loadNFTs(PIXEL_BEARS_TAXON, 'Pixel Bears');
    });

    // View Ultra Rares button
    document.getElementById('viewUltraRaresBtn')?.addEventListener('click', () => {
      loadNFTs(ULTRA_RARES_TAXON, 'Ultra Rares');
    });

    // Initialize on load
    initializeProfileAndNFTs();

    // ===== TOP NAVIGATION FUNCTIONS =====

    // Toggle hamburger menu
    window.toggleMenu = function() {
      const menuOverlay = document.getElementById('menuOverlay');
      const menuScrim = document.getElementById('menuScrim');

      menuOverlay.classList.toggle('open');
      menuScrim.classList.toggle('open');

      // Prevent body scroll when menu is open
      if (menuOverlay.classList.contains('open')) {
        document.body.style.overflow = 'hidden';
      } else {
        document.body.style.overflow = '';
      }
    };

    // Open profile setup - opens drawer and scrolls to profile section
    window.openProfileSetup = function() {
      const walletAddress = localStorage.getItem('bearpark_wallet');

      if (!walletAddress) {
        // If not authenticated, open drawer to connect wallet first
        document.getElementById('buyDrawer').style.display = 'flex';
        setTimeout(() => {
          document.getElementById('buyDrawer').classList.add('visible');
        }, 10);
        return;
      }

      // Open the drawer
      document.getElementById('buyDrawer').style.display = 'flex';
      setTimeout(() => {
        document.getElementById('buyDrawer').classList.add('visible');

        // Wait for drawer animation, then scroll to profile section
        setTimeout(() => {
          const profileSection = document.getElementById('profileSetupSection');
          if (profileSection) {
            profileSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Highlight the profile section briefly
            profileSection.style.background = 'rgba(237,183,35,0.15)';
            profileSection.style.transition = 'background 0.3s';

            setTimeout(() => {
              profileSection.style.background = '';
            }, 2000);
          }
        }, 400);
      }, 10);
    };

    // Update welcome button with points and username
    async function updateWelcomeButton() {
      const walletAddress = localStorage.getItem('bearpark_wallet');
      const welcomePoints = document.getElementById('welcomePoints');
      const welcomeUsername = document.getElementById('welcomeUsername');
      const navHoneyPoints = document.getElementById('navHoneyPoints');

      if (!walletAddress) {
        welcomePoints.innerHTML = 'HONEY <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;">: 0.0 PTS';
        welcomeUsername.textContent = 'WELCOME BEAR (click me!)';
        if (navHoneyPoints) navHoneyPoints.textContent = '0.0 PTS';
        return;
      }

      // âŒ REMOVED localStorage - show loading state, fetch from backend only
      welcomePoints.innerHTML = `HONEY <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;">: Loading...`;
      if (navHoneyPoints) navHoneyPoints.textContent = 'Loading...';

      // Load username from localStorage
      const profileKey = `bear_profile_${walletAddress}`;
      const localProfile = JSON.parse(localStorage.getItem(profileKey) || '{}');

      if (localProfile.display_name) {
        welcomeUsername.textContent = `WELCOME ${localProfile.display_name.toUpperCase()}`;
      } else {
        welcomeUsername.textContent = 'WELCOME BEAR (click me!)';
      }

      // Update avatar if available
      const welcomeAvatar = document.getElementById('welcomeAvatar');
      if (localProfile.avatar_url) {
        welcomeAvatar.src = localProfile.avatar_url;
        welcomeAvatar.style.display = 'block';
        welcomeAvatar.onerror = function() {
          this.style.display = 'none';
        };
      }

      // Try to sync with backend (optional)
      try {
        const pointsResponse = await fetch(`${API_BASE_URL}/api/points/${walletAddress}`);
        if (pointsResponse.ok) {
          const pointsData = await pointsResponse.json();
          const totalPoints = pointsData.total_points || 0;
          const raidingPoints = pointsData.raiding_points || 0;
          const gamesPoints = pointsData.games_points || 0;

          welcomePoints.innerHTML = `HONEY <img src="https://pub-58cecf0785cc4738a3496a79699fdf1e.r2.dev/images/j89mri.png" alt="honey" style="height:1em; width:auto; vertical-align:middle; display:inline-block;">: ${totalPoints.toFixed(1)} PTS`;
          if (navHoneyPoints) navHoneyPoints.textContent = `${totalPoints.toFixed(1)} PTS`;

          // Update honey points section if it exists
          const totalEl = document.getElementById('totalHoneyPoints');
          const raidingEl = document.getElementById('raidingPoints');
          const gamesEl = document.getElementById('gamesPoints');
          if (totalEl) totalEl.textContent = totalPoints.toFixed(1);
          if (raidingEl) raidingEl.textContent = raidingPoints.toFixed(1) + ' PTS';
          if (gamesEl) gamesEl.textContent = gamesPoints.toFixed(1) + ' PTS';

          // âŒ REMOVED localStorage caching - backend is ONLY source of truth
        }
      } catch (error) {
        console.log('[Welcome] Backend not available - using local points');
      }

      // Try to load profile from backend
      try {
        const profileResponse = await fetch(`${API_BASE_URL}/api/profile/${walletAddress}`);
        if (profileResponse.ok) {
          const profileData = await profileResponse.json();
          if (profileData.success && profileData.profile) {
            const profile = profileData.profile;

            // Update username from backend
            if (profile.display_name) {
              welcomeUsername.textContent = `WELCOME ${profile.display_name.toUpperCase()}`;
              // Save to localStorage
              localProfile.display_name = profile.display_name;
              localStorage.setItem(profileKey, JSON.stringify(localProfile));
            }

            // Update avatar from backend
            if (profile.avatar_nft) {
              try {
                const avatarData = JSON.parse(profile.avatar_nft);
                if (avatarData.imageUrl) {
                  welcomeAvatar.src = avatarData.imageUrl;
                  welcomeAvatar.style.display = 'block';
                  localProfile.avatar_url = avatarData.imageUrl;
                  localStorage.setItem(profileKey, JSON.stringify(localProfile));

                  welcomeAvatar.onerror = function() {
                    if (avatarData.fallbackImageUrl && this.src !== avatarData.fallbackImageUrl) {
                      this.src = avatarData.fallbackImageUrl;
                    } else {
                      this.style.display = 'none';
                    }
                  };
                }
              } catch (e) {
                console.log('[Welcome] Could not parse avatar data');
              }
            }
          }
        }
      } catch (error) {
        console.log('[Welcome] Backend not available - using local profile');
      }
    }

    // Update welcome button when profile is loaded
    updateWelcomeButton();

    // Refresh welcome button when wallet connects
    window.addEventListener('storage', (e) => {
      if (e.key === 'bearpark_wallet') {
        updateWelcomeButton();
      }
    });

    // ===== LEADERBOARDS =====
    async function loadLeaderboards() {
      const games = [
        { id: 'flappy-bear', elementId: 'leaderboard-flappy' },
        { id: 'bear-slice', elementId: 'leaderboard-slice' },
        { id: 'bear-jumpventure', elementId: 'leaderboard-jumpventure' }
      ];

      for (const game of games) {
        try {
          const response = await fetch(`${API_BASE_URL}/api/leaderboard/${game.id}?limit=10`);
          const data = await response.json();

          const container = document.getElementById(game.elementId);
          if (!container) continue;

          if (data.success && data.leaderboard && data.leaderboard.length > 0) {
            container.innerHTML = data.leaderboard.map((entry, index) => {
              const medal = index === 0 ? 'ðŸ¥‡' : (index === 1 ? 'ðŸ¥ˆ' : (index === 2 ? 'ðŸ¥‰' : ''));
              const rankClass = index === 0 ? 'rank-1' : (index === 1 ? 'rank-2' : (index === 2 ? 'rank-3' : ''));
              const displayName = entry.display_name || 'Anonymous';

              // Show avatar if available
              let avatarHTML = '';
              if (entry.avatar_nft) {
                try {
                  const avatarData = JSON.parse(entry.avatar_nft);
                  const avatarUrl = avatarData.imageUrl || avatarData.fallbackImageUrl;
                  if (avatarUrl) {
                    avatarHTML = `<img src="${avatarUrl}"
                         style="width:40px; height:40px; border-radius:50%; border:2px solid var(--gold); object-fit:cover; margin-right:8px;"
                         alt="${displayName} avatar"
                         onerror="this.style.display='none'">`;
                  }
                } catch (e) {
                  // If not JSON, try using it directly as NFT ID
                  avatarHTML = `<img src="https://nft.xrpl-labs.com/${entry.avatar_nft}"
                       style="width:40px; height:40px; border-radius:50%; border:2px solid var(--gold); object-fit:cover; margin-right:8px;"
                       alt="${displayName} avatar"
                       onerror="this.style.display='none'">`;
                }
              }

              return `
                <div class="leaderboard-entry ${rankClass}">
                  <div class="leaderboard-rank">${medal || `#${index + 1}`}</div>
                  <div class="leaderboard-name" style="display:flex; align-items:center;">
                    ${avatarHTML}
                    <div>
                      ${displayName}
                      ${entry.wallet_address ? `<div class="leaderboard-wallet">${entry.wallet_address.substring(0, 8)}...</div>` : ''}
                    </div>
                  </div>
                  <div class="leaderboard-score">${entry.score.toLocaleString()}</div>
                </div>
              `;
            }).join('');
          } else {
            container.innerHTML = '<div class="loading">No scores yet! Be the first!</div>';
          }
        } catch (error) {
          console.error(`Error loading ${game.id} leaderboard:`, error);
          const container = document.getElementById(game.elementId);
          if (container) {
            container.innerHTML = '<div class="loading">Unable to load scores</div>';
          }
        }
      }
    }

    // Load leaderboards on page load
    loadLeaderboards();

    // Refresh leaderboards every 2 minutes (reduced from 30s to save bandwidth)
    // Only refresh when tab is visible
    setInterval(() => {
      if (document.hidden) return;
      loadLeaderboards();
    }, 120000);

  })();
  </script>

  <!-- Emergency FAB Button Fix -->
  <script>
  (function() {
    // Check if FAB already exists
    if (document.querySelector('.fab-buy')) return;

    console.log('Creating emergency FAB button...');

    // Create FAB button
    const fab = document.createElement('button');
    fab.className = 'fab-buy';
    fab.innerHTML = '<span class="txt">BEAR HUB</span>';
    fab.setAttribute('aria-controls', 'buyDrawer');
    fab.setAttribute('aria-expanded', 'false');
    fab.setAttribute('aria-label', 'Open BEAR HUB panel');
    document.body.appendChild(fab);

    // Create scrim
    const scrim = document.createElement('div');
    scrim.className = 'drawer-scrim';
    scrim.hidden = true;
    document.body.appendChild(scrim);

    const drawer = document.getElementById('buyDrawer');
    const closeBtn = drawer ? drawer.querySelector('[data-close-drawer]') : null;

    if (!drawer) {
      console.error('buyDrawer not found!');
      return;
    }

    function openDrawer() {
      drawer.classList.add('open');
      scrim.hidden = false;
      fab.setAttribute('aria-expanded', 'true');
      drawer.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closeDrawer() {
      drawer.classList.remove('open');
      scrim.hidden = true;
      fab.setAttribute('aria-expanded', 'false');
      drawer.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }

    fab.addEventListener('click', openDrawer);
    if (closeBtn) closeBtn.addEventListener('click', closeDrawer);
    scrim.addEventListener('click', closeDrawer);

    console.log('Emergency FAB button created successfully!');
  })();
  </script>
</body>
</html>